diff --git a/include/cdf.h b/include/cdf.h
index a71e207e6..723287d7f 100644
--- a/include/cdf.h
+++ b/include/cdf.h
@@ -23,10 +23,14 @@
 #define MISSING_VALUE_BYTE 99
 #define NO_TIME -1
 #define LON_NAME "lon"
+#define LON_BNDS_NAME "lon_bnds"
 #define LON_STANDARD_NAME "longitude"
 #define LON_LONG_NAME "Longitude"
+#define LON_BNDS_LONG_NAME "Longitude bounds"
 #define LAT_NAME "lat"
+#define LAT_BNDS_NAME "lat_bnds"
 #define LAT_LONG_NAME "Latitude"
+#define LAT_BNDS_LONG_NAME "Latitude bounds"
 #define LAT_STANDARD_NAME "latitude"
 #define TIME_NAME "time"
 #define TIME_STANDARD_NAME "time"
@@ -38,9 +42,12 @@
 #define NULL_NAME "(null)"
 #define PFT_NAME "NamePFT"
 #define DEPTH_NAME "depth"
+#define DEPTH_BNDS_NAME "depth_bnds"
 #define DEPTH_STANDARD_NAME "depth_below_surface"
 #define DEPTH_LONG_NAME "Depth of Vertical Layer Center Below Surface"
-#define BNDS_NAME "depth_bnds"
+#define BNDS_NAME "bnds"
+#define TIME_BNDS_NAME "time_bnds"
+#define TIME_BNDS_LONG_NAME "start and end points of each time step"
 #define BNDS_LONG_NAME "bnds=0 for the top of the layer, and bnds=1 for the bottom of the layer"
 #define CALENDAR "noleap"
 
@@ -50,8 +57,11 @@ typedef struct
 {
   Real lon_min;
   Real lat_min;
+  Real lon_res;
+  Real lat_res;
   int nlon;
   int nlat;
+  Bool rev_lat;
   int *index;
 } Coord_array;
 
@@ -63,6 +73,7 @@ typedef struct cdf
   int varid;
   int time_dim_id,lon_dim_id,lat_dim_id;
   int time_var_id,lon_var_id,lat_var_id;
+  int time_bnds_var_id,lon_bnds_var_id,lat_bnds_var_id;
   int n;
   const Coord_array *index;
   float missing_value;
@@ -193,6 +204,8 @@ extern Bool checkcoord(const size_t *,int,const Coord *,const Climatefile *);
 extern Map *readmap_netcdf(int,const char *);
 extern char *getattr_netcdf(int,int,const char *);
 extern char *getvarname_netcdf(const Climatefile *);
+extern Bool setlatlon(double **,double **,double **,double **,const Coord_array *);
+extern Bool settimeaxis(double **,double **,int,int,int,int,int,Bool,Bool,Bool,const char *);
 
 #ifdef USE_MPI
 extern Bool mpi_write_netcdf(const Netcdf *,void *,MPI_Datatype,int,int,
diff --git a/include/cell.h b/include/cell.h
index 5004d93e3..caf156261 100644
--- a/include/cell.h
+++ b/include/cell.h
@@ -209,7 +209,7 @@ extern Bool readcelldata(Celldata,Cell *,unsigned int *,int,Config *);
 extern void closecelldata(Celldata,const Config *);
 extern Real albedo(Cell *, Real , Real );
 extern void hydrotopes(Cell*);
-extern void update_wetland(Cell *, int, int,const Config *);
+extern void update_wetland(Cell *, int, int,int,const Config *);
 extern void check_glaciated(Cell *,const Config *);
 extern Bool initoutput(Outputfile *,Cell [],int,int,Config *);
 
diff --git a/include/conf.h b/include/conf.h
index aa9ec0d94..f1cf769e9 100644
--- a/include/conf.h
+++ b/include/conf.h
@@ -38,14 +38,6 @@
 #define LIM_IRRIGATION 1
 #define POT_IRRIGATION 2
 #define ALL_IRRIGATION 3
-#define GROUNDWATER_IRRIG 1
-#define NO_GROUNDWATER_IRRIG 0 // Flag to allow for irrigation from groundwater reservoir (sustainable gw irrigation)
-#ifdef IMAGE
-#define AQUIFER_IRRIG 1
-#define NO_AQUIFER_IRRIG 0 //Flag to allow for irrigation from aquifers (according to input map for aquifers)
-#endif
-#define GRASS_FIXED_PFT 1
-#define NO_GRASS_FIXED_PFT 0
 #define LAIMAX_CFT 0
 #define LAIMAX_CONST 1
 #define LAIMAX_PAR 2
@@ -58,10 +50,6 @@
 #define NO_RESIDUE_REMOVE 0
 #define FIXED_RESIDUE_REMOVE 1
 #define READ_RESIDUE_DATA 2
-#define ANOMALY 1
-#define NO_ANOMALY 0
-#define PRESCRIBE_CH4 0
-#define DYNAMIC_CH4 1
 #define BMGR_GREEN 0
 #define BMGR_BROWN 1
 #define RADIATION_LWDOWN 3
diff --git a/include/config.h b/include/config.h
index eaf223e28..145abfaab 100644
--- a/include/config.h
+++ b/include/config.h
@@ -133,6 +133,7 @@ struct config
   int ncult_types;        /**< size of cult_types array */
   int nsoil;              /**< number of soil types */
   Soilpar *soilpar;       /**< Soil parameter array */
+  Hydropar hydropar;      /** Hydrology parameter */
   int ncountries;         /**< number of countries */
   Countrypar *countrypar; /**< country parameter array */
   Outputvar *outputvars;
@@ -177,7 +178,6 @@ struct config
   Bool fix_climate;             /**< fix climate after specified year */
   int fix_climate_year;         /**< year at which climate is fixed */
   int fix_climate_interval[2];  /**< interval for fixed climate */
-  int fix_climate_cycle;        /**< number of years for climate shuffle for fixed climate */
   Bool fix_climate_shuffle;     /**< randomly shuffle climate */
   Bool fix_deposition;          /**< fix deposition after specified year */
   int fix_deposition_year;      /**< year at which deposition is fixed */
@@ -202,8 +202,6 @@ struct config
   int compress;           /**< compress NetCDF output (0: no compression) */
   float missing_value;    /**< Missing value in NetCDF files */
   Variable *outnames;
-  char *hostname;               /**< hostname to send data */
-  int port;                     /**< port of socket connection */
   Bool isanomaly;
   int delta_year;
   Bool with_glacier;
@@ -280,6 +278,7 @@ struct config
   int soilmap_size;
   int grazing;
   int grazing_others;
+  int rice_pft;             /**< PFT index of rice */
   Bool groundwater_irrig;   /**< Irrigation from groundwater reservoir */
 #ifdef IMAGE
   Bool aquifer_irrig;       /**< Aquifer irrigation possible?*/
@@ -308,7 +307,7 @@ struct config
   int totalsize;          /**< size of shared output storage */
   int outputmap[NOUT];    /**< index into output storage */
   int outputsize[NOUT];   /**< number of bands for each output */
-  int natNBP_only;
+  Bool natNBP_only;
 }; /* LPJ configuration */
 
 typedef struct
@@ -348,6 +347,7 @@ extern void fprintincludes(FILE *,const char *,int,char **);
 extern size_t getsize(int,const Config *);
 extern int *fscanlandcovermap(LPJfile *,int *,const char *,int,const Config *);
 extern void createconfig(const Config *);
+extern Bool checkuniqoutput(int,int,const Config *);
 extern void closeconfig(LPJfile *);
 
 /* Definition of macros */
diff --git a/include/discharge.h b/include/discharge.h
index f5f58a658..97f2e5301 100644
--- a/include/discharge.h
+++ b/include/discharge.h
@@ -65,7 +65,6 @@ typedef struct
   Queue queue;            /**< Delay queue */
   Real *tfunct;           /**< pointer to the factors of the cell's transfer function */
   int next;               /**< index to outflow cell */
-  Intcoord runoff2ocean_coord;   /**< i,j index in the global grid of the ocean cell where this cells drains into, or -1,-1 for non-coast-cells */
 } Discharge;
 
 typedef struct wateruse *Wateruse;
diff --git a/include/hydrotope.h b/include/hydrotope.h
index 835122cba..a5d10bfe8 100644
--- a/include/hydrotope.h
+++ b/include/hydrotope.h
@@ -72,14 +72,10 @@ typedef struct
 
 } Hydrotope;
 
-/* Declaration of global variable */
-
-extern Hydropar hydropar;
-
 /* Declaration of functions */
 
-extern Bool fscanhydropar(LPJfile *, Verbosity);
-extern void fprinthydropar(FILE *);
+extern Bool fscanhydropar(LPJfile *,Hydropar *,Verbosity);
+extern void fprinthydropar(FILE *,const Hydropar *);
 extern Bool freadhydrotope(FILE *, Hydrotope *,Bool);
 extern Bool fwritehydrotope(FILE *,const Hydrotope *);
 extern void fprinthydrotope(FILE *,const Hydrotope *);
diff --git a/include/landuse.h b/include/landuse.h
index 52b3fca29..19aa3ab06 100644
--- a/include/landuse.h
+++ b/include/landuse.h
@@ -132,7 +132,7 @@ extern void deforest_for_timber(Cell *,Real,int,Bool,int,Real,int,const Config *
 #endif
 extern void reclaim_land(const Stand *, Stand *,Cell *,Bool,int,const Config *);
 extern void remove_vegetation_copy(Soil *soil,const Stand *,Cell *,Real,Bool,Bool,const Config *);
-extern Bool getlanduse(Landuse,Cell *,int,int,int,const Config *);
+extern Bool getlanduse(Landuse,Cell *,int,int,int,int,const Config *);
 extern void landusechange(Cell *,int,int,Bool,int,const Config *);
 extern Bool setaside(Cell *,Stand *,Bool,Bool,int,int,Bool,Bool,int,const Config *);
 extern void sowingcft(Stocks *,Bool *,Cell *,Bool,Bool,Bool,int,int,int,int,int,Bool,const Config *);
@@ -140,7 +140,7 @@ extern Stocks sowing_season(Cell *,int,int,int,Real,int,const Config *);
 extern Stocks sowing_prescribe(Cell *,int,int,int,int,const Config *);
 extern Stocks sowing(Cell *,Real,int,int,int,int,const Config *);
 extern void deforest(Cell *,Real,Bool,int,Bool,Bool,Bool,int,int,Real,const Config *);
-extern void calc_nir(Stand *,Irrigation *,Real,Real [],Real,Bool);
+extern void calc_nir(Stand *,Irrigation *,Real,Real [],Real,const Config *);
 extern Real rw_irrigation(Stand *,Real,const Real [],Real,const Config *);
 extern void irrig_amount_river(Cell *,const Config *);
 extern void irrig_amount(Stand *,Irrigation *,int,int,int,const Config *);
@@ -163,6 +163,7 @@ extern Bool isirrigevent(const Stand *);
 extern int fertday_biomass(const Cell *,const Config *);
 extern void fertilize_tree(Stand *,Real,Real,int,const Config *);
 extern void setotherstocrop(void);
+extern Bool ispftinstand(const Pftlist *,int);
 extern void output_gbw(Output *,const Stand *,Real,Real,Real,Real,
                        const Real [LASTLAYER],const Real [LASTLAYER],Real,Real,int,
                        Bool,const Config *);
diff --git a/include/lpj.h b/include/lpj.h
index c4fe251a9..674f09df8 100644
--- a/include/lpj.h
+++ b/include/lpj.h
@@ -28,8 +28,6 @@
 #ifndef LPJ_H /* Already included? */
 #define LPJ_H
 
-#define LPJ_VERSION  "6.0.1"
-
 /* Necessary header files */
 
 /* Standard C header files */
@@ -81,9 +79,9 @@ typedef struct config Config; /* forward declaration of stand */
 #include "coupler.h"
 #include "cropdates.h"
 #include "reservoir.h"
-#include "landuse.h"
 #include "errmsg.h"
 #include "pftlist.h"
+#include "landuse.h"
 #include "icefrac.h"
 #include "spitfire.h"
 #include "units.h"
diff --git a/include/soil.h b/include/soil.h
index 6618a7f2f..09a5180d1 100644
--- a/include/soil.h
+++ b/include/soil.h
@@ -99,23 +99,23 @@
 #define K_LITTER_SAT_FROZEN 2.106374   /* thermal conductivity of fully saturated frozen organic material */
 #define K_LITTER_SAT_UNFROZEN 0.554636  /* thermal conudcitivity of fully saturated unfrozen organic material */
 
-#define WC  12               /*12g/mol*/
-#define WO2 32               /*32g/mol*/
-#define WCH4 16
-#define WH2O 18
-#define WCO2 44
-#define O2star 3             /*g/m3*/
+#define WC  12.0             /*12g/mol*/
+#define WO2 32.0             /*32g/mol*/
+#define WCH4 16.0
+#define WH2O 18.0
+#define WCO2 44-0
+#define O2star 3.0           /*g/m3*/
 #define BO2 0.038            /*Bunsen coefficient of oxygen*/
 #define BCH4 0.043           /*Bunsen coefficient of methane  0.043 Khvorostynov etal. 2008*/
-#define Vmax_CH4 10          /*Michaelis-Menten coefficient in mikroM/h =  mikro mol/l/h = 10−3 mol/m3/h  20 original */
-#define km_CH4 5             /*mikroM Michaelis-Menten coefficient in mikroM  convert  to 10−3 mol/m3*/
-#define km_O2 200            /*mikroM Michaelis-Menten coefficient in mikroM  convert  to 10−3 mol/m3 Seger 1998*/
+#define Vmax_CH4 10.0        /*Michaelis-Menten coefficient in mikroM/h =  mikro mol/l/h = 10−3 mol/m3/h  20 original */
+#define km_CH4 5.0           /*mikroM Michaelis-Menten coefficient in mikroM  convert  to 10−3 mol/m3*/
+#define km_O2 200.0          /*mikroM Michaelis-Menten coefficient in mikroM  convert  to 10−3 mol/m3 Seger 1998*/
 #define tau_CH4 12.5 /* life time of methane (yr) */
 #define R_gas 8.314          /* universal gas constant J mol-1 K-1 */
 #define p_s 1.01e5           /* atmospheric pressure (Pa=kg m-1 s-2) */
 #define D_O2_air 1.596e-5    /* free air oxygen diffusivity (m2s-1)*/
 #define D_O2_water 1.6e-9    /* O2 diffusivity in water (m2s-1)*/
-#define eta 2/3              /* tortuosity factor ( 2/3 )*/
+#define eta (2.0/3.0)        /* tortuosity factor ( 2/3 )*/
 #define O2s 0.209            /* atmospheric content of oxygen */
 #define D_CH4_air 1.702e-5   /* free air methane diffusivity (m2s-1)*/
 #define D_CH4_water 2e-9     /* methane diffusivity in water (m2s-1)*/
@@ -233,8 +233,8 @@ typedef struct
   Real NH4[LASTLAYER];           /**< NH4 per soillayer (gN/m2) */
   Real w[NSOILLAYER],            /**< soil water as fraction of whc (fractional water holding capacity) */
     w_fw[NSOILLAYER];            /**< free water or gravitational water (mm), absolute water content between field capacity and saturation */
-  Real O2[LASTLAYER];            /*mass of soil oxygen per soil layer*/
-  Real CH4[LASTLAYER];           /*mass of soil methane per soil layer in gC*/
+  Real O2[LASTLAYER];            /**< mass of soil oxygen per soil layer*/
+  Real CH4[LASTLAYER];           /**< mass of soil methane per soil layer in gC*/
   Real w_evap;                   /**< soil moisture content which is not transpired and can evaporate? correct? */
   Real perc_energy[NSOILLAYER];  /**< energy transfer by percolation (J) */
 #ifdef MICRO_HEATING
@@ -260,7 +260,7 @@ typedef struct
   Real whcs[NSOILLAYER];  /**< absolute water holding capacity (mm), whcs = whc * soildepth */
   Real wpwps[NSOILLAYER]; /**< water at permanent wilting point in mm, depends on soildepth */
   Real ice_depth[NSOILLAYER];   /**< mm */
-  Real icefrac;               /* fraction covered by ice */
+  Real icefrac;                  /**< fraction covered by ice */
   Real ice_fw[NSOILLAYER];       /**< mm */
   Real freeze_depth[NSOILLAYER]; /**< mm */
   Real ice_pwp[NSOILLAYER];      /**< fraction of water below pwp frozen */
diff --git a/include/stand.h b/include/stand.h
index f923ba365..345d23490 100644
--- a/include/stand.h
+++ b/include/stand.h
@@ -73,7 +73,7 @@ extern int delstand(Standlist,int);
 extern void freestandlist(Standlist);
 extern void mixsoil(Stand *,const Stand *,int,int,const Config *);
 extern Bool check_lu(const Standlist ,Real,int,Landusetype,Bool);
-extern void check_stand_fracs2(const Cell *,Real,const char *,int);
+extern void check_stand_fracs2(const Cell *,Real,int,const char *,int);
 extern int findstand(const Standlist, Landusetype, Bool);
 extern int findstandpft(const Standlist,int,Bool);
 extern int findlandusetype(const Standlist,Landusetype);
@@ -101,7 +101,7 @@ extern void freelandcover(Landcover,Bool);
 
 #define getstand(list,index) ((Stand *)getlistitem(list,index))
 #define foreachstand(stand,i,list) for(i=0;i<getlistlen(list) && (stand=getstand(list,i));i++)
-#define check_stand_fracs(cell,lakefrac) check_stand_fracs2(cell,lakefrac,__FUNCTION__,__LINE__)
+#define check_stand_fracs(cell,lakefrac,ncft) check_stand_fracs2(cell,lakefrac,ncft,__FUNCTION__,__LINE__)
 #define isnatural(type) (type==NATURAL || type==WETLAND)
 
 /*
diff --git a/include/types.h b/include/types.h
index 1c33614a6..450e61e09 100644
--- a/include/types.h
+++ b/include/types.h
@@ -143,6 +143,8 @@ extern long long diskfree(const char *);
 extern void fprintintf(FILE *,long long);
 extern void getcounts(int [],int [],int,int,int);
 extern char *getbuilddate(void);
+extern char *gethash(void);
+extern char *getrepo(void);
 extern time_t getfiledate(const char *);
 extern char *stripsuffix(const char *);
 extern Bool hassuffix(const char *,const char *);
@@ -183,6 +185,7 @@ extern LPJfile *parse_json(FILE *,Verbosity);
 extern Bool isdir(const char *);
 extern double mrun(void);
 void mergeattrs(Attr **,int *,const Attr *, int,Bool);
+extern char *getversion(void);
 #ifdef WITH_FPE
 extern void enablefpe(void);
 #endif
diff --git a/src/Makefile b/src/Makefile
index 350fb2f06..3d57eb3e4 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -14,6 +14,8 @@
 
 include ../Makefile.inc
 
+GIT_HASH= $(shell git rev-parse HEAD)
+
 OBJ    = lpjml.$O  
 
 SRC    = lpjml.c
@@ -70,6 +72,10 @@ libs:
 	(cd cpl && $(MAKE))
 	(cd coupler && $(MAKE))
 
+hash:
+	$(RM) $(RMFLAGS) $(EXE)
+	$(MAKE) $(EXE)
+
 clean:
 	(cd climate && $(MAKE) clean)
 	(cd lpj && $(MAKE) clean)
@@ -97,6 +103,6 @@ $(OBJ): $(HDRS)
 	$(CC) $(CFLAGS) -I$(INC) -c $*.c
 
 
-$(EXE): $(LPJLIBS) $(OBJ)
-	$(CC) $(CFLAGS) -I$(INC) -c getbuild.c
+$(EXE): $(LPJLIBS) $(OBJ) getbuild.c
+	$(CC) $(CFLAGS) -I$(INC) -DGIT_HASH=\"$(GIT_HASH)\"  -DGIT_REPO=\"$(GIT_REPO)\" -c getbuild.c
 	$(LINKMAIN) $(LNOPTS)$(EXE) $(OBJ) $(LPJLIBS) $(LIBS) getbuild.$O 
diff --git a/src/crop/harvest_crop.c b/src/crop/harvest_crop.c
index 339eab2fa..c09f0c1f6 100644
--- a/src/crop/harvest_crop.c
+++ b/src/crop/harvest_crop.c
@@ -49,7 +49,7 @@ void harvest_crop(Output *output,      /**< Output data */
     res_onfield = config->residue_treatment==FIXED_RESIDUE_REMOVE ? param.residues_in_soil : 1 ;
   else
     res_onfield=stand->cell->ml.residue_on_field[data->irrigation].crop[pft->par->id-npft];
-  if(!strcmp(pft->par->name,"rice"))
+  if(pft->par->id==config->rice_pft)
     res_onfield=max(res_onfield*2.5,1);
   res_remove = (1-res_onfield);
   stand->soil.litter.item[pft->litter].agtop.leaf.carbon += (crop->ind.leaf.carbon + crop->ind.pool.carbon)*res_onfield;
diff --git a/src/getbuild.c b/src/getbuild.c
index d1462a991..0576d54d3 100644
--- a/src/getbuild.c
+++ b/src/getbuild.c
@@ -13,6 +13,7 @@
 /**************************************************************************************/
 
 #include <stdio.h>
+#include <string.h>
 #include "types.h"
 
 char *getbuilddate(void)
@@ -20,3 +21,15 @@ char *getbuilddate(void)
   static char *s=__DATE__;
   return s;
 } /* of 'getbuilddate' */
+
+char *getrepo(void)
+{
+  static char *s=(strlen(GIT_REPO)==0) ?  "https://github.com/PIK-LPJmL/LPJmL" : GIT_REPO;
+  return s;
+} /* of 'getrepo' */
+
+char *gethash(void)
+{
+  static char *s=GIT_HASH;
+  return s;
+} /* of 'gethash' */
diff --git a/src/image/monthlyoutput_image.c b/src/image/monthlyoutput_image.c
index 14c2442cd..b583873ae 100644
--- a/src/image/monthlyoutput_image.c
+++ b/src/image/monthlyoutput_image.c
@@ -26,9 +26,9 @@ void monthlyoutput_image(Output *output,
 {
   getoutput(output,TEMP_IMAGE,config)+=(getcelltemp(climate,cell))[month];
   getoutput(output,PREC_IMAGE,config)+=(getcellprec(climate,cell))[month];
-  if(climate->data.sun!=NULL)
+  if(climate->data[0].sun!=NULL)
     getoutput(output,SUN_IMAGE,config)+=(getcellsun(climate,cell))[month];
-  if(climate->data.wet!=NULL)
+  if(climate->data[0].wet!=NULL)
     getoutput(output,WET_IMAGE,config)+=(getcellwet(climate,cell))[month];
 } /* of 'monthlyoutput_image' */
 
diff --git a/src/image/receive_image_climate.c b/src/image/receive_image_climate.c
index f33f3b22b..9f92f3c90 100644
--- a/src/image/receive_image_climate.c
+++ b/src/image/receive_image_climate.c
@@ -32,18 +32,18 @@ Bool receive_image_climate(Climate *climate,    /**< Climate data */
   float *image_data;
 #ifdef IMAGE_CLIM_AVG
   for(i=0;i<climate->file_temp_var.n;i++)
-    climate->data.temp[i]=0; /* setting varibility to 0 */
+    climate->data[0].temp[i]=0; /* setting varibility to 0 */
 #else
-  if(readclimate(&climate->file_temp_var,climate->data.temp,0,climate->file_temp_var.scalar,grid,year,config))
+  if(readclimate(&climate->file_temp_var,climate->data[0].temp,0,climate->file_temp_var.scalar,grid,year,1,config))
   {
     if(isroot(*config))
       fprintf(stderr,"ERROR190: Cannot read temperature variability of year %d receive_image_climate().\n",
               year);
     return TRUE;
   }
-  if(climate->data.temp[0]<-70 || climate->data.temp[0]>70)
+  if(climate->data[0].temp[0]<-70 || climate->data[0].temp[0]>70)
   {
-    fprintf(stderr,"tempvar incorrect %g\n",climate->data.temp[0]);
+    fprintf(stderr,"tempvar incorrect %g\n",climate->data[0].temp[0]);
     fflush(stderr);
   }
 #endif
@@ -70,7 +70,7 @@ Bool receive_image_climate(Climate *climate,    /**< Climate data */
   /* adding IMAGE temperature to absolute temperature variability */
   for(i=0;i<climate->file_temp_var.n;i++)
   {
-    climate->data.temp[i]+=(Real)image_data[i];
+    climate->data[0].temp[i]+=(Real)image_data[i];
 #ifdef DEBUG_IMAGE
     if((i>=1*12&&i<2*12) || (i>=67032*12 && i<67033*12))
     {
@@ -84,18 +84,18 @@ Bool receive_image_climate(Climate *climate,    /**< Climate data */
   /* IMAGE precipitation consists of CRU variability (%) and IMAGE prec */
 #ifdef IMAGE_CLIM_AVG
   for(i=0;i<climate->file_prec_var.n;i++)
-    climate->data.prec[i]=1; /* setting relative varibility to 1 */
+    climate->data[0].prec[i]=1; /* setting relative varibility to 1 */
 #else
-  if(readclimate(&climate->file_prec_var,climate->data.prec,0,climate->file_prec_var.scalar,grid,year,config))
+  if(readclimate(&climate->file_prec_var,climate->data[0].prec,0,climate->file_prec_var.scalar,grid,year,1,config))
   {
     if(isroot(*config))
       fprintf(stderr,"ERROR189: Cannot read precipitation variability of year %d in receive_image_climate().\n",
               year);
     return TRUE;
   }
-  if(climate->data.prec[0]<0 || climate->data.prec[0]>1000)
+  if(climate->data[0].prec[0]<0 || climate->data[0].prec[0]>1000)
   {
-    fprintf(stderr,"ERROR174: precvar incorrect %g\n",climate->data.prec[0]);
+    fprintf(stderr,"ERROR174: precvar incorrect %g\n",climate->data[0].prec[0]);
     fflush(stderr);
   }
 #endif
@@ -116,7 +116,7 @@ Bool receive_image_climate(Climate *climate,    /**< Climate data */
   for(i=0;i<climate->file_prec_var.n;i++)
   {
     /* IMAGE precipitation data are supplied as mm/day monthly averages */
-    climate->data.prec[i]*=(Real)image_data[i]*ndaymonth[i % NMONTH];
+    climate->data[0].prec[i]*=(Real)image_data[i]*ndaymonth[i % NMONTH];
 #ifdef DEBUG_IMAGE
     if((i>=1*12&&i<2*12) || (i>=67032*12 && i<67033*12))
     {
@@ -144,7 +144,7 @@ Bool receive_image_climate(Climate *climate,    /**< Climate data */
   /* assigning IMAGE cloudiness */
   for(i=0;i<climate->file_cloud.n;i++)
   {
-    climate->data.sun[i]=100-(Real)image_data[i]*100.0;
+    climate->data[0].sun[i]=100-(Real)image_data[i]*100.0;
 #ifdef DEBUG_IMAGE
     if((i>=1*12&&i<2*12) || (i>=67032*12 && i<67033*12))
     {
@@ -174,7 +174,7 @@ Bool receive_image_climate(Climate *climate,    /**< Climate data */
   if(israndomprec(climate))
     for(i=0;i<climate->file_wet.n;i++)
     {
-      climate->data.wet[i]=(Real)image_data[i]*ndaymonth[i % NMONTH];
+      climate->data[0].wet[i]=(Real)image_data[i]*ndaymonth[i % NMONTH];
 #ifdef DEBUG_IMAGE
       if((i>=1*12&&i<2*12) || (i>=67032*12 && i<67033*12))
       {
diff --git a/src/landuse/Makefile b/src/landuse/Makefile
index 8fbbf0048..615a86357 100644
--- a/src/landuse/Makefile
+++ b/src/landuse/Makefile
@@ -40,7 +40,7 @@ OBJS    = cultivate.$O landuse.$O landusechange.$O\
           new_grassland.$O fwrite_grassland.$O fread_grassland.$O\
           fprint_grassland.$O new_biomass_tree.$O fread_biomass_tree.$O\
           fwrite_biomass_tree.$O fprint_biomass_tree.$O init_irrigation.$O\
-          scancftmap.$O\
+          scancftmap.$O ispftinstand.$O\
           fscanmowingdays.$O getnsoil_agr.$O agriculture_tree.$O agriculture_grass.$O\
           daily_agriculture_tree.$O daily_agriculture_grass.$O fscantreedens.$O\
           findstandpft.$O isirrigevent.$O\
diff --git a/src/landuse/calc_nir.c b/src/landuse/calc_nir.c
index d6bbd4e51..dec19265a 100644
--- a/src/landuse/calc_nir.c
+++ b/src/landuse/calc_nir.c
@@ -19,7 +19,7 @@ void calc_nir(Stand *stand,     /**< pointer to non-natural stand */
               Real gp_stand,       /**< potential canopy conductivity */
               Real wet[],          /**< wet array for PFT list */
               Real eeq,            /**< equilibrium evapotranspiration (mm) */
-              Bool others_to_crop
+              const Config *config /**< LPJmL configuration */
              )
 {
   Pft *pft;
@@ -32,7 +32,7 @@ void calc_nir(Stand *stand,     /**< pointer to non-natural stand */
   {
     wr=getwr(&stand->soil,pft->par->rootdist);
 
-    if(stand->type->landusetype==AGRICULTURE || (stand->type->landusetype==OTHERS && others_to_crop))
+    if(stand->type->landusetype==AGRICULTURE || (stand->type->landusetype==OTHERS && config->others_to_crop))
     {
       supply=pft->par->emax*wr*(1-exp(-0.04*((Pftcrop *)pft->data)->ind.root.carbon));
       demand=(gp_stand>0 && pft->phen>0 && fpar(pft)>0) ? eeq*param.ALPHAM/(1+(param.GM*param.ALPHAM)/(gp_stand/pft->phen*fpar(pft))) : 0;
@@ -42,7 +42,7 @@ void calc_nir(Stand *stand,     /**< pointer to non-natural stand */
       supply=pft->par->emax*wr*pft->phen;
       demand=(gp_stand>0) ? eeq*param.ALPHAM/(1+(param.GM*param.ALPHAM)/gp_stand) : 0;
     }
-    if(!strcmp(pft->par->name,"rice"))
+    if(pft->par->id==config->rice_pft)
     {
       demand=satwater(&stand->soil)-rootwater(&stand->soil);
       nir=demand;
@@ -85,14 +85,15 @@ void calc_nir(Stand *stand,     /**< pointer to non-natural stand */
 #endif
     }
     /* avoid large irrigation amounts for dist if nir is zero */
-    if(nir<1) dist=0;
+    if(nir<1)
+      dist=0;
     if(nir>data->net_irrig_amount) /* for pft loop */
       data->net_irrig_amount=nir;
     if(dist>data->dist_irrig_amount)
       data->dist_irrig_amount=dist;
 
 #ifdef DEBUG2
-      if(!strcmp(pft->par->name,"rice"))
+    if(pft->par->id==config->rice_pft)
       fprintf(stdout,"nir: %g dist: %g supply: %g demand: %g net_irrig_amount: %g dist_irrig_amount: %g\n",nir,dist,supply,demand,data->net_irrig_amount,data->dist_irrig_amount);
 #endif
   } /* of foreachpft() */
diff --git a/src/landuse/cultivate.c b/src/landuse/cultivate.c
index 17b6bc2ce..37403c127 100644
--- a/src/landuse/cultivate.c
+++ b/src/landuse/cultivate.c
@@ -55,6 +55,7 @@ Stocks cultivate(Cell *cell,           /**< cell pointer */
 
 #ifdef IMAGE
   int nagr,s;
+  Stand *stand;
 #endif
   vern_date20=cell->ml.cropdates[cft].vern_date20;
   landfrac=(isother) ? cell->ml.landfrac[irrigation].grass[0] : cell->ml.landfrac[irrigation].crop[cft];
@@ -106,7 +107,7 @@ Stocks cultivate(Cell *cell,           /**< cell pointer */
   data=cropstand->data;
   data->irrigation= (config->irrig_scenario==ALL_IRRIGATION) || irrigation;
   set_irrigsystem(cropstand,cft,npft,ncft,config);
-  if(cft==RICE)
+  if(cft==config->rice_pft-npft)
   {
     cropstand->slope_mean=0;
     cropstand->Hag_Beta=min(1,(0.09*log(cropstand->slope_mean+0.1)+0.22)/0.43);
@@ -115,7 +116,7 @@ Stocks cultivate(Cell *cell,           /**< cell pointer */
   pft=addpft(cropstand,config->pftpar+npft+cft,year,day,config);
   phen_variety(pft,vern_date20,cell->coord.lat,day,wtype,npft,ncft,config);
 #ifdef DEBUG3
-  if(cft==RICE)
+  if(cft==config->rice_pft-npft)
     fprintf(stdout,"cultivate A D D P F T year: %d day: %d bminc: %g cft: %d irrig: %d standfrac: %g landfrac: %g setasidfrac: %g iswetland: %d \n",year,day,pft->bm_inc.carbon,cft,irrigation,cropstand->frac,landfrac,setasidestand->frac,setasidestand->soil.iswetland);
 #endif
   bm_inc.carbon=pft->bm_inc.carbon*cropstand->frac;
diff --git a/src/landuse/daily_agriculture.c b/src/landuse/daily_agriculture.c
index 22e638e9d..2a8ff25b7 100644
--- a/src/landuse/daily_agriculture.c
+++ b/src/landuse/daily_agriculture.c
@@ -118,7 +118,8 @@ Real daily_agriculture(Stand *stand,                /**< [inout] stand pointer *
   {
     index=(stand->type->landusetype==OTHERS) ? data->irrigation*nirrig+rothers(ncft) : pft->par->id-npft+data->irrigation*nirrig;
     crop=pft->data;
-    if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
+    if(pft->par->id==config->rice_pft)
+      isrice=TRUE;
     /* kill crop at frost events */
     /* trigger 2nd fertilization */
     /* GGCMI phase 3 rule: apply second dosis at fphu=0.25*/
@@ -204,16 +205,16 @@ Real daily_agriculture(Stand *stand,                /**< [inout] stand pointer *
       delpft(&stand->pftlist,p);
       /* adjust index */
       p--;
-//      if(!strcmp(pft->par->name,"rice") && stand->growing_days<300)
+//      if(pft->par->id==config->rice_pft && stand->growing_days<300)
 //      {
 //    	  flux_estab=cultivate(stand->cell,data->irrigation,day,FALSE,stand,
-//    	                     npft,ncft,RICE,year,config);
+//    	                     npft,ncft,config->rice_pft-npft,year,config);
 //    	    if(data->irrigation)
-//    	      c=ncft+RICE;
+//    	      c=ncft+config->rice_pft-npft;
 //    	    if(!config->double_harvest)
 //    	      getoutputindex(&stand->cell->output,SDATE,c,config)=day;
 //    	    if(config->sdate_option==FIXED_SDATE)
-//    	    	stand->cell->ml.sdate_fixed[RICE]=day;
+//    	    	stand->cell->ml.sdate_fixed[config->rice_pft-npft]=day;
 //         getoutput(&stand->cell->output,FLUX_ESTABC,config)+=flux_estab.carbon;
 //         getoutput(&stand->cell->output,FLUX_ESTABN,config)+=flux_estab.nitrogen;
 //         stand->cell->balance.flux_estab.nitrogen+=flux_estab.nitrogen;
@@ -432,7 +433,7 @@ Real daily_agriculture(Stand *stand,                /**< [inout] stand pointer *
       p--;
     } /* of if(negbm) */
 #if DEBUG2
-  if(stand->type->landusetype!=KILL && !strcmp(pft->par->name,"rice"))
+  if(stand->type->landusetype!=KILL && pft->par->id==config->rice_pft)
   {
     fprintf(stdout,"\n year:%d day:%d isrice: %d bm_inc:%g inun_stress: %g\n",year,day,isrice,pft->bm_inc.carbon,pft->inun_stress);
     fprintf(stdout,"\n irrig_amount:%g irrig_stor:%g irrig_apply: %g satwater:%g rootwater:%g net_irrig_amount:%g\n",
@@ -455,7 +456,7 @@ Real daily_agriculture(Stand *stand,                /**< [inout] stand pointer *
 
   /* calculate net irrigation requirements (NIR) for next days irrigation */
   if((data->irrigation||isrice) && stand->pftlist.n>0) /* second element to avoid irrigation on just harvested fields */
-    calc_nir(stand,data,gp_stand,wet,eeq,config->others_to_crop);
+    calc_nir(stand,data,gp_stand,wet,eeq,config);
 
   getoutput(output,TRANSP,config)+=transp;
   stand->cell->balance.atransp+=transp;
diff --git a/src/landuse/daily_agriculture_grass.c b/src/landuse/daily_agriculture_grass.c
index 5309429d7..6b9d1d5d1 100644
--- a/src/landuse/daily_agriculture_grass.c
+++ b/src/landuse/daily_agriculture_grass.c
@@ -307,7 +307,7 @@ Real daily_agriculture_grass(Stand *stand,                /**< stand pointer */
   }
 
   if (data->irrigation && stand->pftlist.n > 0) /*second element to avoid irrigation on just harvested fields */
-    calc_nir(stand,data,gp_stand, wet, eeq,config->others_to_crop);
+    calc_nir(stand,data,gp_stand, wet, eeq,config);
   transp=0;
   forrootsoillayer(l)
   {
diff --git a/src/landuse/daily_agriculture_tree.c b/src/landuse/daily_agriculture_tree.c
index 32eb2e818..8834e4c45 100644
--- a/src/landuse/daily_agriculture_tree.c
+++ b/src/landuse/daily_agriculture_tree.c
@@ -417,7 +417,7 @@ Real daily_agriculture_tree(Stand *stand,                /**< stand pointer */
     // return TRUE;
   }
   if(data->irrigation.irrigation && stand->pftlist.n>0) /*second element to avoid irrigation on just harvested fields */
-    calc_nir(stand,&data->irrigation,gp_stand,wet,eeq,config->others_to_crop);
+    calc_nir(stand,&data->irrigation,gp_stand,wet,eeq,config);
   free(wet);
 
   return runoff;
diff --git a/src/landuse/daily_biomass_grass.c b/src/landuse/daily_biomass_grass.c
index b9b4aed87..bddc9fda2 100644
--- a/src/landuse/daily_biomass_grass.c
+++ b/src/landuse/daily_biomass_grass.c
@@ -345,7 +345,7 @@ Real daily_biomass_grass(Stand *stand,                /**< stand pointer */
   } /* of if(isphen) */
 
   if(data->irrigation && stand->pftlist.n>0) /*second element to avoid irrigation on just harvested fields */
-    calc_nir(stand,data,gp_stand,wet,eeq,config->others_to_crop);
+    calc_nir(stand,data,gp_stand,wet,eeq,config);
   transp=0;
   forrootsoillayer(l)
   {
diff --git a/src/landuse/daily_biomass_tree.c b/src/landuse/daily_biomass_tree.c
index 5cd00b5a1..503b387cb 100644
--- a/src/landuse/daily_biomass_tree.c
+++ b/src/landuse/daily_biomass_tree.c
@@ -213,7 +213,7 @@ Real daily_biomass_tree(Stand *stand,                /**< stand pointer */
                &frac_g_evap,config->rw_manage);
 
   if(data->irrigation.irrigation && stand->pftlist.n>0) /*second element to avoid irrigation on just harvested fields */
-    calc_nir(stand,&data->irrigation,gp_stand,wet,eeq,config->others_to_crop);
+    calc_nir(stand,&data->irrigation,gp_stand,wet,eeq,config);
   transp=0;
   forrootsoillayer(l)
   {
diff --git a/src/landuse/daily_grassland.c b/src/landuse/daily_grassland.c
index 2a7f855e0..58861fd0a 100644
--- a/src/landuse/daily_grassland.c
+++ b/src/landuse/daily_grassland.c
@@ -514,7 +514,7 @@ Real daily_grassland(Stand *stand,                /**< stand pointer */
   }
 
   if(data->irrigation.irrigation && stand->pftlist.n>0) /*second element to avoid irrigation on just harvested fields */
-    calc_nir(stand,&data->irrigation,gp_stand,wet,eeq,config->others_to_crop);
+    calc_nir(stand,&data->irrigation,gp_stand,wet,eeq,config);
 
   getoutput(output,TRANSP,config)+=transp;
   stand->cell->balance.atransp+=transp;
diff --git a/src/landuse/daily_woodplantation.c b/src/landuse/daily_woodplantation.c
index 70ebdc8ea..af12d3b72 100644
--- a/src/landuse/daily_woodplantation.c
+++ b/src/landuse/daily_woodplantation.c
@@ -214,7 +214,7 @@ Real daily_woodplantation(Stand *stand,       /**< stand pointer */
                &frac_g_evap,config->rw_manage);
 
   if (data->irrigation.irrigation && stand->pftlist.n>0) /*second element to avoid irrigation on just harvested fields */
-    calc_nir(stand, &data->irrigation,gp_stand, wet, eeq,config->others_to_crop);
+    calc_nir(stand, &data->irrigation,gp_stand, wet, eeq,config);
   transp=0;
   forrootsoillayer(l)
   {
diff --git a/src/landuse/distribute_water.c b/src/landuse/distribute_water.c
index 322736366..ffa644620 100644
--- a/src/landuse/distribute_water.c
+++ b/src/landuse/distribute_water.c
@@ -35,7 +35,8 @@ void distribute_water(Cell *cell,            /**< pointer to LPJ cell */
                       const Config *config   /**< LPJmL configuration */
                      )
 {
-  int s,p,nirrig,isrice;
+  int s,nirrig;
+  Bool isrice;
   Real conv_loss,irrig_stand;
   Real frac_irrig_amount,frac_unsustainable;
   Stand *stand;
@@ -44,7 +45,6 @@ void distribute_water(Cell *cell,            /**< pointer to LPJ cell */
   Pftcrop *crop;
   conv_loss=0.0;
   nirrig=getnirrig(ncft,config);
-  isrice=FALSE;
 #ifdef IMAGE
   /* actual irrigation requirement */
   if(config->irrig_scenario==LIM_IRRIGATION && cell->discharge.aquifer==0)
@@ -92,9 +92,7 @@ void distribute_water(Cell *cell,            /**< pointer to LPJ cell */
       data=stand->data;
       data->irrig_event=FALSE;
       data->irrig_amount=0;
-      isrice=FALSE;
-      foreachpft(pft,p,&stand->pftlist)
-             if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
+      isrice=ispftinstand(&stand->pftlist,config->rice_pft);
 
       if((data->irrigation||isrice) && config->irrig_scenario!=NO_IRRIGATION)
       {
diff --git a/src/landuse/fprintcountrypar.c b/src/landuse/fprintcountrypar.c
index b581cbb88..f4526e862 100644
--- a/src/landuse/fprintcountrypar.c
+++ b/src/landuse/fprintcountrypar.c
@@ -24,8 +24,6 @@ void fprintcountrypar(FILE *file,          /**< pointer to text file */
   if(countrypar[0].laimax_cft!=NULL)
     for(i=0;i<ncft;i++)
       fprintf(file," %2d",i+1);
-  else
-    fputs(" cereal maize",file);
   for(i=0;i<config->nagtree;i++)
     fprintf(file," %15s",config->pftpar[i+npft-config->nagtree].name);
   fputs(" Irrigsys\n",file);
@@ -33,8 +31,6 @@ void fprintcountrypar(FILE *file,          /**< pointer to text file */
   if(countrypar[0].laimax_cft!=NULL)
     for(i=0;i<ncft;i++)
       fputs(" --",file);
-  else
-    fputs(" ------ -----",file);
   for(i=0;i<config->nagtree;i++)
     fputs(" ---------------",file);
   fputs(" --------\n",file);
@@ -52,8 +48,6 @@ void fprintcountrypar(FILE *file,          /**< pointer to text file */
   if(countrypar[0].laimax_cft!=NULL)
     for(i=0;i<ncft;i++)
       fputs(" --",file);
-  else
-    fputs(" ------ -----",file);
   for(i=0;i<config->nagtree;i++)
     fputs(" ---------------",file);
   fputs(" --------\n",file);
diff --git a/src/landuse/irrig_amount.c b/src/landuse/irrig_amount.c
index 2d6792087..0b196e06f 100644
--- a/src/landuse/irrig_amount.c
+++ b/src/landuse/irrig_amount.c
@@ -22,13 +22,12 @@ void irrig_amount(Stand *stand,        /**< pointer to non-natural stand */
                   const Config *config /**< LPJmL configuration */
                  )
 {
-  int nirrig,isrice,p;
+  int nirrig;
+  Bool isrice;
   Pft *pft;
   Real conv_loss,irrig_stand;
   Pftcrop *crop;
-  isrice=FALSE;
-  foreachpft(pft, p, &stand->pftlist)
-   if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
+  isrice=ispftinstand(&stand->pftlist,config->rice_pft);
   /* determine if today irrigation dependent on threshold */
   data->irrig_event=FALSE;
   data->irrig_amount=0;
diff --git a/src/lpj/cflux_sum.c b/src/landuse/ispftinstand.c
similarity index 50%
rename from src/lpj/cflux_sum.c
rename to src/landuse/ispftinstand.c
index e3046bda7..4bff5a11e 100644
--- a/src/lpj/cflux_sum.c
+++ b/src/landuse/ispftinstand.c
@@ -1,11 +1,9 @@
 /**************************************************************************************/
 /**                                                                                \n**/
-/**                    c  f  l  u  x  _  s  u  m  .  c                             \n**/
+/**                i  s  p  f  t  i  n  s  t  a  n  d  .  c                        \n**/
 /**                                                                                \n**/
 /**     C implementation of LPJmL                                                  \n**/
 /**                                                                                \n**/
-/**     Function calculates total carbon flux.                                     \n**/
-/**                                                                                \n**/
 /** (C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file    \n**/
 /** authors, and contributors see AUTHORS file                                     \n**/
 /** This file is part of LPJmL and licensed under GNU AGPL Version 3               \n**/
@@ -16,26 +14,14 @@
 
 #include "lpj.h"
 
-Real cflux_sum(const Cell grid[],   /**< array of grid cells */
-               const Config *config /**< LPJ configuration */
-              )                     /** \return total carbon flux (gC) */
+Bool ispftinstand(const Pftlist *pftlist, /**< array of PFTs */
+                  int pft_id              /**< PFT index to find */
+                 )                        /**< return TRUE if PFT was found */
 {
-  int cell;
-  Real sum,sum_total;
-  sum=sum_total=0;
-  for(cell=0;cell<config->ngridcell;cell++)
-    sum+=(grid[cell].balance.anpp-grid[cell].balance.arh-grid[cell].output.fire.carbon+grid[cell].output.flux_estab.carbon
-          -grid[cell].output.flux_harvest.carbon-grid[cell].balance.biomass_yield.carbon)*grid[cell].coord.area;
-#ifdef USE_MPI
-  /*
-   * Use global reduce operation in order to sum carbon fluxes of all
-   * tasks
-   */
-  MPI_Reduce(&sum,&sum_total,1,
-             (sizeof(Real)==sizeof(double)) ? MPI_DOUBLE : MPI_FLOAT,
-             MPI_SUM,0,config->comm);
-  return sum_total;
-#else
-  return sum;
-#endif
-} /* of 'cflux_sum' */
+  const Pft *pft;
+  int p;
+  foreachpft(pft,p,pftlist)
+    if(pft->par->id==pft_id)
+      return TRUE;
+  return FALSE;
+} /* of 'ispftinstand' */
diff --git a/src/landuse/killstand.c b/src/landuse/killstand.c
index 0f6c5f623..ffc751699 100644
--- a/src/landuse/killstand.c
+++ b/src/landuse/killstand.c
@@ -47,7 +47,7 @@ void killstand(Cell *cell,          /**< cell pointer */
       else
         irrig=FALSE;
       if(stand->frac>0)
-        check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+        check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
       if(setaside(cell,stand,with_tillage,intercrop,npft,ncft,irrig,stand->soil.iswetland,year,config))
       {
         delstand(cell->standlist,s);
@@ -55,5 +55,5 @@ void killstand(Cell *cell,          /**< cell pointer */
       }
     }
   }
-  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 } /* of 'killstand' */
diff --git a/src/landuse/landuse.c b/src/landuse/landuse.c
index 07ba64926..75888732e 100644
--- a/src/landuse/landuse.c
+++ b/src/landuse/landuse.c
@@ -268,6 +268,7 @@ Bool getlanduse(Landuse landuse,     /**< Pointer to landuse data */
                 Cell grid[],         /**< LPJ cell array */
                 int year,            /**< year (AD) */
                 int actual_year,     /**< year (AD) but not the static in case of CONST_LANDUSE */
+                int npft,            /**< number of natural PFTs */
                 int ncft,            /**< number of crop PFTs */
                 const Config *config /**< LPJ configuration */
                )                     /** \return TRUE on error */
@@ -453,7 +454,7 @@ Bool getlanduse(Landuse landuse,     /**< Pointer to landuse data */
               {
                 grid[cell].ml.landfrac[i].crop[config->landusemap[j]]+=data[count++];
                 grid[cell].ml.irrig_system->crop[config->landusemap[j]]=p;
-                grid[cell].ml.irrig_system->crop[RICE]=SURF;                               //TODO this should be a flag
+                grid[cell].ml.irrig_system->crop[config->rice_pft-npft]=SURF;                               //TODO this should be a flag
               }
               else if(config->landusemap[j]<ncft+NGRASS)
               {
diff --git a/src/landuse/landusechange.c b/src/landuse/landusechange.c
index 28c2cfc2c..5bf8f956d 100644
--- a/src/landuse/landusechange.c
+++ b/src/landuse/landusechange.c
@@ -133,7 +133,7 @@ void deforest(Cell *cell,          /**< pointer to cell */
         /* stand was already tilled, so put FALSE to tillage argument */
         if(setaside(cell,getstand(cell->standlist,pos),FALSE,intercrop,npft,ncft,irrig,iswetland,year,config))
           delstand(cell->standlist,pos);
-        check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+        check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
       }
     }
@@ -184,7 +184,7 @@ void deforest(Cell *cell,          /**< pointer to cell */
       difffrac_wetland=difffrac_old-difffrac;
 
   }
-  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
   cell->hydrotopes.wetland_area-=difffrac_wetland;
   cell->hydrotopes.wetland_area_runmean-=difffrac_wetland;
 
@@ -1375,7 +1375,6 @@ void landusechange(Cell *cell,          /**< pointer to cell */
 {
   Real difffrac,difffrac2,movefrac,difffrac_rice;
   Stand *stand, *tempstand, *irrigstand;
-  Pft *pft;
   Bool irrigation,isrice;
   Irrigation *data;
   Cultivation_type cultivation_type;
@@ -1420,12 +1419,11 @@ void landusechange(Cell *cell,          /**< pointer to cell */
   fluxes_prod.carbon=(cell->balance.deforest_emissions.carbon+cell->balance.prod_turnover.fast.carbon+cell->balance.prod_turnover.slow.carbon+cell->balance.trad_biofuel.carbon);
   fluxes_prod.nitrogen=(cell->balance.deforest_emissions.nitrogen+cell->balance.prod_turnover.fast.nitrogen+cell->balance.prod_turnover.slow.nitrogen+cell->balance.trad_biofuel.nitrogen);
 #endif
-  isrice=FALSE;
    if(cell->ml.dam)
     landusechange_for_reservoir(cell,npft,ncft,intercrop,year,config);
   /* test if land needs to be reallocated between setaside stands */
-  difffrac=crop_sum_frac(cell->ml.landfrac,ncft,config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,FALSE)-cell->ml.cropfrac_rf-cell->ml.landfrac[0].crop[RICE]; //cropfrac is without wetland setaside
-  difffrac2=crop_sum_frac(cell->ml.landfrac,ncft,config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,TRUE)-cell->ml.cropfrac_ir-cell->ml.landfrac[1].crop[RICE];
+  difffrac=crop_sum_frac(cell->ml.landfrac,ncft,config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,FALSE)-cell->ml.cropfrac_rf-cell->ml.landfrac[0].crop[config->rice_pft-npft]; //cropfrac is without wetland setaside
+  difffrac2=crop_sum_frac(cell->ml.landfrac,ncft,config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,TRUE)-cell->ml.cropfrac_ir-cell->ml.landfrac[1].crop[config->rice_pft-npft];
   if(difffrac*difffrac2<-epsilon*epsilon) /* if one increases while the other decreases */
   {
     s=findlandusetype(cell->standlist,SETASIDE_RF);
@@ -1485,14 +1483,12 @@ void landusechange(Cell *cell,          /**< pointer to cell */
     if(stand->type->landusetype!=NATURAL && stand->type->landusetype!=WETLAND && stand->type->landusetype!=KILL)
     {
       data=stand->data;
-      foreachpft(pft, p, &stand->pftlist)
-        if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
-      if(isrice==TRUE||stand->type->landusetype==SETASIDE_WETLAND)
+      isrice=ispftinstand(&stand->pftlist,config->rice_pft);
+      if(isrice || stand->type->landusetype==SETASIDE_WETLAND)
         sum_wl+=stand->frac;
       else
         sum[data->irrigation]+=stand->frac;
     }
-    isrice=FALSE;
 
     //if(year>1989) fprintf(stdout,"stand': %s frac: %g\n",stand->type->name, stand->frac);
   }
@@ -1521,7 +1517,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
       -((cell->balance.deforest_emissions.nitrogen+cell->balance.prod_turnover.fast.nitrogen+cell->balance.prod_turnover.slow.nitrogen+cell->balance.trad_biofuel.nitrogen)-fluxes_prod.nitrogen);
   if(fabs(start.carbon-end.carbon+balance.carbon)>0.001)
     fail(INVALID_CARBON_BALANCE_ERR,FAIL_ON_BALANCE,FALSE,"Invalid carbon balance in %s after moving setaside year=%d: C_ERROR=%g start : %g end : %g balance.carbon: %g difffrac: %g difffrac2: %g rice_rainfed: %g rice_irr: %g wl: %g \n",
-         __FUNCTION__,year,start.carbon-end.carbon+balance.carbon,start.carbon,end.carbon,balance.carbon,difffrac,difffrac2,cell->ml.landfrac[0].crop[RICE],cell->ml.landfrac[1].crop[RICE],cell->ml.cropfrac_wl);
+         __FUNCTION__,year,start.carbon-end.carbon+balance.carbon,start.carbon,end.carbon,balance.carbon,difffrac,difffrac2,cell->ml.landfrac[0].crop[config->rice_pft-npft],cell->ml.landfrac[1].crop[config->rice_pft-npft],cell->ml.cropfrac_wl);
   if (fabs(start_w - end_w)>0.001)
     fail(INVALID_WATER_BALANCE_ERR,FAIL_ON_BALANCE,FALSE, "Invalid water balance in %s after moving setaside: year=%d: W_ERROR=%g start : %g end : %g\n",
          __FUNCTION__,year, start_w - end_w, start_w, end_w);
@@ -1537,7 +1533,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
    }
 #endif
 
-  difffrac_rice=cell->ml.landfrac[1].crop[RICE]+cell->ml.landfrac[0].crop[RICE]-sum_wl;
+  difffrac_rice=cell->ml.landfrac[1].crop[config->rice_pft-npft]+cell->ml.landfrac[0].crop[config->rice_pft-npft]-sum_wl;
 
   for(i=0;i<2;i++)
   {
@@ -1545,7 +1541,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
     cropfrac= i==0 ? cell->ml.cropfrac_rf : cell->ml.cropfrac_ir;
     grassfrac=cell->ml.landfrac[i].grass[0]+cell->ml.landfrac[i].grass[1]; /* pasture + others */
 
-    difffrac=(crop_sum_frac(cell->ml.landfrac,ncft,config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,i)-cell->ml.landfrac[i].crop[RICE])-cropfrac;; /*  added the resfrac, see function AND replaced to BEFORE next three lines */
+    difffrac=(crop_sum_frac(cell->ml.landfrac,ncft,config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,i)-cell->ml.landfrac[i].crop[config->rice_pft-npft])-cropfrac;; /*  added the resfrac, see function AND replaced to BEFORE next three lines */
 
 
     // FIRST CONVERTION OF WETLANDS BECAUSE RICE SHOULD BE PREFERRED
@@ -1562,7 +1558,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
     else if(difffrac>=epsilon && cell->lakefrac+cell->ml.reservoirfrac+cell->ml.cropfrac_rf+cell->ml.cropfrac_ir+cell->ml.cropfrac_wl<(1-epsilon))
       deforest(cell,difffrac,intercrop,npft,FALSE,i,FALSE,ncft,year,minnatfrac_luc,config);  /*deforestation*/
 
-    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
 
 #ifdef DEBUG4
@@ -1571,7 +1567,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
       fprintf(stderr,"LANDUSECHANGE difffrac_crops: %g cropfrac_rf: %g cropfrac_ir: %g cropfrac_wl: %g difffrac_rice: %g grassfrac: %g irrgation:%d "
           "cropsum: %g land_ricefrac: %g cropfrac: %g sumwl: %g sum[%d]: %g \n",
           difffrac,cell->ml.cropfrac_rf,cell->ml.cropfrac_ir,cell->ml.cropfrac_wl,difffrac_rice,grassfrac, i,crop_sum_frac(cell->ml.landfrac,ncft,
-              config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,i),cell->ml.landfrac[i].crop[RICE],cropfrac,sum_wl,i,sum[i]);
+              config->nagtree,cell->ml.reservoirfrac+cell->lakefrac,i),cell->ml.landfrac[i].crop[config->rice_pft-npft],cropfrac,sum_wl,i,sum[i]);
    }
 #endif
     /* pasture */
@@ -1602,7 +1598,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
         difffrac,grassfrac,s);
 #endif
     }
-    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
 #ifdef DEBUG4
     foreachstand(stand,s,cell->standlist)
@@ -1643,7 +1639,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
     foreachstand(stand,s,cell->standlist)
        if(year>1989) fprintf(stdout,"stand': %s frac: %g\n",stand->type->name, stand->frac);
 #endif
-    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
    /* Biomass plantations */
     cultivation_type=BIOMASS_TREE_PLANTATION;
     irrigation=i;
@@ -1733,13 +1729,13 @@ void landusechange(Cell *cell,          /**< pointer to cell */
                     irrigation,cultivation_type,0,ncft,year,config);
     }
   }
-  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
   foreachstand(stand,s,cell->standlist)
     if(stand->type->landusetype==GRASSLAND || stand->type->landusetype==BIOMASS_GRASS || stand->type->landusetype==BIOMASS_TREE || stand->type->landusetype==AGRICULTURE_TREE || stand->type->landusetype==AGRICULTURE_GRASS || stand->type->landusetype==WOODPLANTATION || (!config->others_to_crop && stand->type->landusetype==OTHERS)) /* do not update for crops, must be done in sowing functions */
       set_irrigsystem(stand,0,npft,ncft,config); /* no CFT index needed for non-agricultural stands */
 #ifdef SAFE
-  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 #endif
   sum_wl=sum[0]=sum[1]=0;
   foreachstand(stand,s,cell->standlist)
@@ -1747,15 +1743,13 @@ void landusechange(Cell *cell,          /**< pointer to cell */
     if(stand->type->landusetype!=NATURAL && stand->type->landusetype!=WETLAND && stand->type->landusetype!=KILL)
     {
       data=stand->data;
-      foreachpft(pft, p, &stand->pftlist)
-        if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
-      if(isrice==TRUE||stand->type->landusetype==SETASIDE_WETLAND)
+      isrice=ispftinstand(&stand->pftlist,config->rice_pft);
+      if(isrice||stand->type->landusetype==SETASIDE_WETLAND)
         sum_wl+=stand->frac;
       else
         sum[data->irrigation]+=stand->frac;
 
     }
-    isrice=FALSE;
 //    if(stand->soil.iswetland)
 //      forrootsoillayer(l)
 //      {
@@ -1789,7 +1783,7 @@ void landusechange(Cell *cell,          /**< pointer to cell */
       cell->ml.image_data->timber_frac=0.0;
     }
   /* check that sum of fractions is 1.0 */
-  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
   /* check if there is more than 1 natural stand */
   nnat = 0;
diff --git a/src/landuse/sowingcft.c b/src/landuse/sowingcft.c
index 08e8091e2..2b115f436 100644
--- a/src/landuse/sowingcft.c
+++ b/src/landuse/sowingcft.c
@@ -145,7 +145,7 @@ void sowingcft(Stocks *flux_estab,  /**< establishment flux */
   if(config->sdate_option==FIXED_SDATE)
     cell->ml.sdate_fixed[cft+irrig*ncft]=day;
 
-  if(cft==RICE)
+  if(cft==config->rice_pft-npft)
     s=findlandusetype(cell->standlist,SETASIDE_WETLAND);
   if(s==NOT_FOUND)
     s=findlandusetype(cell->standlist,(irrig) ? SETASIDE_IR : SETASIDE_RF);
diff --git a/src/landuse/withdrawal_demand.c b/src/landuse/withdrawal_demand.c
index 3d0c86ff2..205428a91 100644
--- a/src/landuse/withdrawal_demand.c
+++ b/src/landuse/withdrawal_demand.c
@@ -32,12 +32,11 @@ void withdrawal_demand(Cell *grid,          /**< LPJ grid */
                        const Config *config /**< LPJ configuration */
                       )
 {
-  int cell,i,s,p,isrice;
+  int cell,i,s;
   Real *in,*out;
   Irrigation *data;
   Stand *stand;
-  Pft *pft;
-  isrice=FALSE;
+  Bool isrice;
 
   in=(Real *)pnet_input(config->irrig_neighbour);
   out=(Real *)pnet_output(config->irrig_neighbour);
@@ -58,9 +57,7 @@ void withdrawal_demand(Cell *grid,          /**< LPJ grid */
            stand->type->landusetype==AGRICULTURE_TREE ||
            stand->type->landusetype==WOODPLANTATION)
         {
-          isrice=FALSE;
-          foreachpft(pft, p, &stand->pftlist)
-           if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
+          isrice=ispftinstand(&stand->pftlist,config->rice_pft);
           data=stand->data;
           if((data->irrigation||isrice) && config->irrig_scenario!=NO_IRRIGATION)
           {
diff --git a/src/lpj/Makefile b/src/lpj/Makefile
index 4b9b0f05e..93861d616 100644
--- a/src/lpj/Makefile
+++ b/src/lpj/Makefile
@@ -45,13 +45,14 @@ OBJS    = update_daily.$O update_annual.$O init_annual.$O\
           fprintfiles.$O roughnesslength.$O closeoutput_yearly.$O\
           getnculttype.$O getextension.$O albedo_stand.$O phenology_gsi.$O\
           fscanphenparam.$O landcover.$O standstocks.$O nitrogen_stress.$O\
-          f_lai.$O getsize.$O  wetland.$O copypft.$O plant_gas_transport.$O\
-          fprintoutputvar.$O check_glaciated.$O fwriteoutput_ch4.$O\
+          f_lai.$O getsize.$O fprintoutputvar.$O checkuniqoutput.$O\
           getngrassnat.$O fscancnratio.$O initoutputdata.$O\
           fprintcsvflux.$O extflow.$O getmintimestep.$O isannual_output.$O\
           npp_contr_biol_n_fixation.$O fprintoutputjson.$O writearea.$O\
           fscancultivationtypes.$O fscanlandcovermap.$O getroute.$O\
-          fscanerrorlimit.$O createconfig.$O
+          fscanerrorlimit.$O createconfig.$O\
+          wetland.$O copypft.$O plant_gas_transport.$O\
+          check_glaciated.$O fwriteoutput_ch4.$O
 
 INC     = ../../include
 LIBDIR  = ../../lib
diff --git a/src/lpj/check_fluxes.c b/src/lpj/check_fluxes.c
index 558e4af41..a093faee1 100644
--- a/src/lpj/check_fluxes.c
+++ b/src/lpj/check_fluxes.c
@@ -28,9 +28,10 @@ void check_fluxes(Cell *cell,          /**< cell pointer */
   Stand *stand;
   String line;
   int s,i,startyear;
-
-//  int p;
-//  Pft *pft;
+#if defined IMAGE && defined COUPLED
+  int p;
+  Pft *pft;
+#endif
   /* carbon balance check */
   awater_flux = cell->balance.awater_flux;
   fraction=0;
@@ -111,9 +112,9 @@ void check_fluxes(Cell *cell,          /**< cell pointer */
          year,cellid+config->startgrid,sprintcoord(line,&cell->coord),balance.carbon,cell->balance.anpp-cell->balance.arh,
          cell->balance.fire.carbon,
          cell->balance.flux_estab.carbon,cell->balance.flux_harvest.carbon,delta_tot.carbon,
-         cell->balance.deforest_emissions.carbon,cell->balance.prod_turnover,cell->balance.trad_biofuel.carbon,
+         cell->balance.deforest_emissions.carbon,cell->balance.prod_turnover.fast.carbon,cell->balance.trad_biofuel.carbon,
          cell->ml.product.slow.carbon,cell->ml.product.fast.carbon,cell->balance.timber_harvest.carbon,
-         cell->ml.image_data->timber_f,cell->ml.image_data->fburnt,cell->balance.influx.carbon,fraction);
+         cell->ml.image_data->timber_f.fast,cell->ml.image_data->fburnt,cell->balance.influx.carbon,fraction);
 #else
 #ifdef NO_FAIL_BALANCE
     fprintf(stderr,"ERROR004: "
diff --git a/src/lpj/check_stand_fracs.c b/src/lpj/check_stand_fracs.c
index d499a8aa5..664172b54 100644
--- a/src/lpj/check_stand_fracs.c
+++ b/src/lpj/check_stand_fracs.c
@@ -24,17 +24,16 @@
 
 void check_stand_fracs2(const Cell *cell,    /**< pointer to cell */
                         Real lakefrac,       /**< lake fraction (0..1) */
+                        int ncft,            /**< number of crop PFTs */
                         const char *routine, /**< function name called from */
                         int linenr           /**< line number called from */
                        )
 {
-  int s,ncft,j,p;
-  Real frac_sum,frac_sum2;
+  int s,p;
+  Real frac_sum;
   const Stand *stand,*checkstand;
   const Pft* pft;
   String line;
-  ncft=12;
-  frac_sum2=0;
   frac_sum=lakefrac;
   foreachstand(stand,s,cell->standlist)
   {
@@ -59,12 +58,15 @@ void check_stand_fracs2(const Cell *cell,    /**< pointer to cell */
     fail(STAND_FRAC_SUM_ERR,TRUE,TRUE,"Sum of stand fractions differs from 1 by %g, frac_sum %g, lakefrac: %g, cell (%s), reservoirfrac %g from routine %s() in line %d.\n",
          fabs(frac_sum-1),frac_sum, lakefrac,sprintcoord(line,&cell->coord),cell->ml.reservoirfrac,routine,linenr);
 #else
+    Real frac_sum2;
+    int j;
     for(j=0;j<ncft;j++)
       fprintf(stderr,"landfrac_rainfed: %g landfrac_irr: %g\n", cell->ml.landfrac[0].crop[j],cell->ml.landfrac[1].crop[j]);
     fprintf(stderr,"grassfrac_rainfed: %g grassfrac_irr: %g\n",(cell->ml.landfrac[0].grass[0]+cell->ml.landfrac[0].grass[1]),
         (cell->ml.landfrac[1].grass[0]+cell->ml.landfrac[1].grass[1]));
     fprintf(stderr,"ml.cropfrac_rf: %g ml.cropfrac_ir: %g  ml.cropfrac_wl: %g \n",
         cell->ml.cropfrac_rf,cell->ml.cropfrac_ir,cell->ml.cropfrac_wl);
+    frac_sum2=0;
     foreachstand(stand,s,cell->standlist)
     {
       frac_sum2+=stand->frac;
diff --git a/src/lpj/checkuniqoutput.c b/src/lpj/checkuniqoutput.c
new file mode 100644
index 000000000..b6e21360c
--- /dev/null
+++ b/src/lpj/checkuniqoutput.c
@@ -0,0 +1,63 @@
+/**************************************************************************************/
+/**                                                                                \n**/
+/**              c  h  e  c  k  u  n i  q  o  u  t  p  u  t  .  c                  \n**/
+/**                                                                                \n**/
+/**     C implementation of LPJmL                                                  \n**/
+/**                                                                                \n**/
+/**     Checks whether output filenames has been used more than once               \n**/
+/**     Only NetCDF files can share filenames                                      \n**/
+/**                                                                                \n**/
+/** (C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file    \n**/
+/** authors, and contributors see AUTHORS file                                     \n**/
+/** This file is part of LPJmL and licensed under GNU AGPL Version 3               \n**/
+/** or later. See LICENSE file or go to http://www.gnu.org/licenses/               \n**/
+/** Contact: https://github.com/PIK-LPJmL/LPJmL                                    \n**/
+/**                                                                                \n**/
+/**************************************************************************************/
+
+#include "lpj.h"
+
+Bool checkuniqoutput(int npft,            /**< number of natural PFTs */
+                     int ncft,            /**< number of crop PFTs */
+                     const Config *config /**< LPJmL configuration */
+                )                         /** \return TRUE on error */
+{
+  int i,j;
+  for(i=0;i<config->n_out;i++)
+  {
+    if(config->outputvars[i].filename.fmt!=SOCK)
+    {
+      /* check whether filename has already been used */
+      for(j=i-1;j>=0;j--)
+        if(config->outputvars[j].filename.fmt!=SOCK && !strcmp(config->outputvars[j].filename.name,config->outputvars[i].filename.name))
+        {
+          if(config->outputvars[i].filename.fmt!=CDF || config->outputvars[j].filename.fmt!=CDF)
+          {
+            if(isroot(*config))
+              fprintf(stderr,"ERROR265: Filename is identical for output '%s' and '%s' and file type is not NetCDF.\n",
+                      config->outnames[config->outputvars[i].id].name,
+                      config->outnames[config->outputvars[j].id].name);
+            return TRUE;
+          }
+          else if(outputsize(config->outputvars[i].id,npft,ncft,config)>1 ||
+                  outputsize(config->outputvars[j].id,npft,ncft,config)>1)
+          {
+            if(isroot(*config))
+              fprintf(stderr,"ERROR265: Filename is identical for output '%s' and '%s' and number of bands>1.\n",
+                      config->outnames[config->outputvars[i].id].name,
+                      config->outnames[config->outputvars[j].id].name);
+            return TRUE;
+          }
+          else if(getnyear(config->outnames,config->outputvars[i].id)!=getnyear(config->outnames,config->outputvars[j].id))
+          {
+            if(isroot(*config))
+              fprintf(stderr,"ERROR265: Filename is identical for output '%s' and '%s' and time steps differ.\n",
+                      config->outnames[config->outputvars[i].id].name,
+                      config->outnames[config->outputvars[j].id].name);
+            return TRUE;
+          }
+        }
+    }
+  }
+  return FALSE;
+} /* of 'checkuniqoutput' */
diff --git a/src/lpj/copyright.c b/src/lpj/copyright.c
index 7cad2d2a7..1210c9e9c 100644
--- a/src/lpj/copyright.c
+++ b/src/lpj/copyright.c
@@ -19,8 +19,8 @@
 void copyright(const char *progname /**< program name */
               )
 {
-  String os,title;
-  const char *t[17];
+  String os,title,hash;
+  const char *t[18];
   /* large letters created by figlet */
   t[0]=" _     ____     _           _        __          ___  ";
   t[1]="| |   |  _ \\   | |_ __ ___ | |      / /_        / _ \\ ";
@@ -28,8 +28,8 @@ void copyright(const char *progname /**< program name */
   t[3]="| |___|  __/ |_| | | | | | | |___  | (_) |  _  | |_| |";
   t[4]="|_____|_|   \\___/|_| |_| |_|_____|  \\___/  (_)  \\___/ ";
   t[5]="";
-  snprintf(title,78-10,"%s C Version " LPJ_VERSION " (%s)",progname,
-           getbuilddate());
+  snprintf(title,78-10,"%s C Version %s (%s)",progname,
+           getversion(),getbuilddate());
   t[6]=title;
 #ifdef USE_MPI
   snprintf(os,78-10,"Compiled for %s with MPI"
@@ -46,13 +46,15 @@ void copyright(const char *progname /**< program name */
 #endif
   t[7]="Dynamic global vegetation model with natural and managed land";
   t[8]=os;
+  snprintf(hash,78-10,"GIT hash: %s",gethash());
   t[9]="(C) Potsdam Institute for Climate Impact Research (PIK),";
   t[10]="see COPYRIGHT file";
   t[11]="Authors, and contributors see AUTHORS file";
   t[12]="This version of LPJmL is licensed under GNU AGPL Version 3 or later";
   t[13]="See LICENSE file or go to http://www.gnu.org/licenses/";
   t[14]="or invoke lpjml -l to print license";
-  t[15]="Contact: https://github.com/PIK-LPJmL/LPJmL";
-  t[16]="";
-  banner(t,17,78);
+  t[15]=getrepo();
+  t[16]=hash;
+  t[17]="";
+  banner(t,18,78);
 } /* of 'copyright' */
diff --git a/src/lpj/createconfig.c b/src/lpj/createconfig.c
index 63628b9e6..b99fe9c17 100644
--- a/src/lpj/createconfig.c
+++ b/src/lpj/createconfig.c
@@ -19,16 +19,19 @@
 void createconfig(const Config *config)
 {
   char *cmd;
-  int rc;
+  int len,rc;
   if(config->json_filename!=NULL)
   {
-    cmd=malloc(strlen(config->cmd)+strlen(config->json_filename)+6);
+    len=snprintf(NULL,0,"%s -DGIT_REPO=\\\"%s\\\" -DGIT_HASH=\\\"%s\\\" -P >%s",
+                 config->cmd,getrepo(),gethash(),config->json_filename);
+    cmd=malloc(len+1);
     if(cmd==NULL)
     {
       printallocerr("cmd");
       return;
     }
-    cmd=strcat(strcat(strcpy(cmd,config->cmd)," -P >"),config->json_filename);
+    sprintf(cmd,"%s -DGIT_REPO=\\\"%s\\\" -DGIT_HASH=\\\"%s\\\" -P >%s",
+            config->cmd,getrepo(),gethash(),config->json_filename);
     if((rc=system(cmd)))
       fprintf(stderr,"ERROR263: Cannot write '%s', rc=%d.\n",
               config->json_filename,rc);
diff --git a/src/lpj/filesexist.c b/src/lpj/filesexist.c
index 174c05c34..ff042bd3c 100644
--- a/src/lpj/filesexist.c
+++ b/src/lpj/filesexist.c
@@ -114,7 +114,7 @@ static int checkfile(const Config *config,const char *name,const Filename *filen
   {
     if(config->start_coupling<=config->firstyear-config->nspinup)
       return 0;
-    fprintf(stderr,"ERROR149: No filename specified for %s data required for socket connection before coupling year %d, first simulatiomn year=%d.\n",
+    fprintf(stderr,"ERROR149: No filename specified for %s data required for socket connection before coupling year %d, first simulation year=%d.\n",
             name,config->start_coupling,config->firstyear-config->nspinup);
     return 1;
   }
@@ -207,7 +207,7 @@ static int checklanduse(const Config *config)
   {
     if(config->start_coupling<=config->firstyear-config->nspinup)
       return 0;
-    fprintf(stderr,"ERROR149: No filename specified for landuse data required for socket connection before coupling year %d, first simulatiomn year=%d.\n",
+    fprintf(stderr,"ERROR149: No filename specified for landuse data required for socket connection before coupling year %d, first simulation year=%d.\n",
             config->start_coupling,config->firstyear-config->nspinup);
     return 1;
   }
@@ -484,6 +484,14 @@ Bool filesexist(Config config, /**< LPJmL configuration */
     bad+=checkdatafile(&config,&config.wateruse_filename,"wateruse","dm3/yr",LPJ_INT,1);
   bad+=checkclmfile(&config,"temp",&config.temp_filename,"celsius",LPJ_SHORT,TRUE);
   bad+=checkclmfile(&config,"precipitation",&config.prec_filename,"kg/m2/day",LPJ_SHORT,TRUE);
+  if(config.isanomaly)
+  {
+    bad+=checkclmfile(&config,"temp anomaly",&config.delta_temp_filename,"celsius",LPJ_SHORT,FALSE);
+    bad+=checkclmfile(&config,"precipitation anomaly",&config.delta_prec_filename,"kg/m2/day",LPJ_SHORT,TRUE);
+    bad+=checkclmfile(&config,"lwnet anomaly",&config.delta_lwnet_filename,"W/m2",LPJ_SHORT,TRUE);
+    bad+=checkclmfile(&config,"swdown anomaly",&config.delta_swdown_filename,"W/m2",LPJ_SHORT,TRUE);
+    bad+=checkclmfile(&config,"icefrac",&config.icefrac_filename,NULL,LPJ_SHORT,TRUE);
+  }
 #ifdef IMAGE
   if (config.wateruse_wd_filename.name != NULL)
     bad += checkdatafile(&config, &config.wateruse_wd_filename,"wateruse_wd","dm3/yr",LPJ_INT,1);
diff --git a/src/lpj/flux_sum.c b/src/lpj/flux_sum.c
index 3a9dd7679..69cc426d3 100644
--- a/src/lpj/flux_sum.c
+++ b/src/lpj/flux_sum.c
@@ -25,8 +25,7 @@ Real flux_sum(Flux *flux_global,   /**< global carbon and water fluxes */
   int s, p, l;
   Stand *stand;
   Pft *pft;
-  //Flux flux={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
-  Flux flux={};   //TODO reicht das?
+  Flux flux={};
   for(cell=0;cell<config->ngridcell;cell++)
   {
     if(!grid[cell].skip)
diff --git a/src/lpj/fopenoutput.c b/src/lpj/fopenoutput.c
index c672d2715..c89224440 100644
--- a/src/lpj/fopenoutput.c
+++ b/src/lpj/fopenoutput.c
@@ -227,7 +227,7 @@ Outputfile *fopenoutput(const Cell grid[],   /**< LPJ grid */
   output->n=n;
   output->index=output->index_all=NULL; 
   for(i=0;i<n;i++)
-    output->files[i].isopen=output->files[i].issocket=FALSE;
+    output->files[i].isopen=output->files[i].issocket=output->files[i].oneyear=FALSE;
 #ifdef USE_MPI
   output->counts=newvec(int,config->ntask);
   check(output->counts);
diff --git a/src/lpj/fprintconfig.c b/src/lpj/fprintconfig.c
index a869b7303..e9e6aaefc 100644
--- a/src/lpj/fprintconfig.c
+++ b/src/lpj/fprintconfig.c
@@ -509,10 +509,10 @@ void fprintconfig(FILE *file,          /**< File pointer to text output file */
     len=printsim(file,len,&count,"prescribed livestock density");
   if(config->reservoir)
     len=printsim(file,len,&count,"dam reservoirs");
-  if(config->groundwater_irrig==GROUNDWATER_IRRIG)
+  if(config->groundwater_irrig)
     len=printsim(file,len,&count,"groundwater irrigation");
 #ifdef IMAGE
-  if(config->aquifer_irrig==AQUIFER_IRRIG)
+  if(config->aquifer_irrig)
     len=printsim(file,len,&count,"aquifer irrigation");
 #endif
   if(config->wateruse)
diff --git a/src/lpj/fprintfiles.c b/src/lpj/fprintfiles.c
index 365a5aede..8776e462f 100644
--- a/src/lpj/fprintfiles.c
+++ b/src/lpj/fprintfiles.c
@@ -85,6 +85,8 @@ void fprintfiles(FILE *file,          /**< pointer to text output file */
     fprintfilename(file,&config->icefrac_filename,TRUE);
     fprintfilename(file,&config->delta_temp_filename,TRUE);
     fprintfilename(file,&config->delta_prec_filename,TRUE);
+    fprintfilename(file,&config->delta_lwnet_filename,TRUE);
+    fprintfilename(file,&config->delta_swdown_filename,TRUE);
   }
 #if defined IMAGE && defined COUPLED
   if(config->sim_id==LPJML_IMAGE)
diff --git a/src/lpj/fprintoutputjson.c b/src/lpj/fprintoutputjson.c
index 327185113..803d0e44d 100644
--- a/src/lpj/fprintoutputjson.c
+++ b/src/lpj/fprintoutputjson.c
@@ -127,20 +127,17 @@ Bool fprintoutputjson(int index,           /**< index in outputvars array */
   }
   fprintf(file,"{\n");
   fprintf(file,"  \"sim_name\" : \"%s\",\n",config->sim_name);
-  fprintf(file,"  \"source\" : \"LPJmL C Version " LPJ_VERSION"\",\n");
+  fprintf(file,"  \"source\" : \"LPJmL C Version %s\",\n",getversion());
   time(&t);
   fprintf(file,"  \"history\" : \"%s: %s\",\n",strdate(&t),config->arglist);
-  if(config->n_global)
-  {
-    fprintf(file,"  \"global_attrs\" : {");
+  fprintf(file,"  \"global_attrs\" :\n  {\n");
+  fprintf(file,"    \"GIT_repo\" : \"%s\",\n",getrepo());
+  fprintf(file,"    \"GIT_hash\" : \"%s\"",gethash());
   for(p=0;p<config->n_global;p++)
   {
-      fprintf(file,"\"%s\" : \"%s\"",config->global_attrs[p].name,config->global_attrs[p].value);
-      if(p<config->n_global-1)
-        fprintf(file,", ");
-    }
-    fprintf(file,"},\n");
+    fprintf(file,",\n    \"%s\" : \"%s\"",config->global_attrs[p].name,config->global_attrs[p].value);
   }
+  fprintf(file,"\n  },\n");
   fprintf(file,"  \"name\" : \"%s\",\n",config->outnames[id].name);
   fprintf(file,"  \"variable\" : \"%s\",\n",config->outnames[id].var);
   fprintf(file,"  \"firstcell\" : %d,\n",config->firstgrid);
@@ -152,7 +149,7 @@ Bool fprintoutputjson(int index,           /**< index in outputvars array */
   nbands=outputsize(id,
                     config->npft[GRASS]+config->npft[TREE],
                     config->npft[CROP],config);
-  fprintf(file,"  \"nbands\" : %d,\n",id==GRID ? 2 : nbands);
+  fprintf(file,"  \"nbands\" : %d,\n",(id==GRID) ? ((config->outputvars[GRID].filename.fmt==CDF) ? 1 : 2) : nbands);
   if(nbands>1)
   {
    if(issoil(id))
diff --git a/src/lpj/fprintparam.c b/src/lpj/fprintparam.c
index 3a85ae490..67c807c5a 100644
--- a/src/lpj/fprintparam.c
+++ b/src/lpj/fprintparam.c
@@ -153,7 +153,7 @@ void fprintparam(FILE *file,    /**< pointer to text file */
   }
   fputs("Soil parameter\n",file);
   fprintsoilpar(file,config);
-  fprinthydropar(file);
+  fprinthydropar(file,&config->hydropar);
   fputs("PFT parameter\n",file);
   if(config->withlanduse!=NO_LANDUSE)
   {
diff --git a/src/lpj/fscanconfig.c b/src/lpj/fscanconfig.c
index 2ed0d829e..88b3ac258 100644
--- a/src/lpj/fscanconfig.c
+++ b/src/lpj/fscanconfig.c
@@ -328,7 +328,7 @@ Bool fscanconfig(Config *config,    /**< LPJ configuration */
   fscanbool(file,&config->groundwater_irrig,"groundwater_irrigation", !config->pedantic,verbose);
 
 #ifdef IMAGE
-  config->aquifer_irrig = NO_AQUIFER_IRRIG;
+  config->aquifer_irrig = FALSE;
 #endif
   fscanbool2(file,&config->permafrost,"permafrost");
   config->johansen = TRUE;
@@ -587,7 +587,7 @@ Bool fscanconfig(Config *config,    /**< LPJ configuration */
       fputs("ERROR230: Cannot read soil parameter 'soilpar'.\n",stderr);
     return TRUE;
   }
-  if (fscanhydropar(file,verbose))
+  if (fscanhydropar(file,&config->hydropar,verbose))
   {
     if(verbose)
       fputs("ERROR230: Cannot read hydrotope parameter.\n",stderr);
diff --git a/src/lpj/fscanoutput.c b/src/lpj/fscanoutput.c
index f18287891..370781aed 100644
--- a/src/lpj/fscanoutput.c
+++ b/src/lpj/fscanoutput.c
@@ -209,11 +209,14 @@ Bool fscanoutput(LPJfile *file,  /**< pointer to LPJ file */
     return TRUE;
   }
   config->absyear=FALSE;
+  if(!config->with_days)
+  {
     if(fscanbool(file,&config->absyear,"absyear",!config->pedantic,verbosity))
     {
       free(default_suffix);
       return TRUE;
     }
+  }
 #endif
   config->flush_output=FALSE;
   if(fscanbool(file,&config->flush_output,"flush_output",!config->pedantic,verbosity))
@@ -470,5 +473,7 @@ Bool fscanoutput(LPJfile *file,  /**< pointer to LPJ file */
   }
   free(default_suffix);
   config->n_out=count;
+  if(checkuniqoutput(npft,ncft,config))
+    return TRUE;
   return FALSE;
 } /* of 'fscanoutput' */
diff --git a/src/lpj/fscanpftpar.c b/src/lpj/fscanpftpar.c
index 09c712a15..7d2ef47ac 100644
--- a/src/lpj/fscanpftpar.c
+++ b/src/lpj/fscanpftpar.c
@@ -190,7 +190,6 @@ Bool fscanpftpar(LPJfile *file,       /**< pointer to LPJ file */
     }
     pft->name=strdup(s); /* store PFT name */
     checkptr(pft->name);
-    npft++;
     if(fscankeywords(item,&pft->type,"type",config->pfttypes,config->ntypes,FALSE,verb))
     {
       if(verb)
@@ -270,6 +269,8 @@ Bool fscanpftpar(LPJfile *file,       /**< pointer to LPJ file */
         break;
       case ANNUAL_CROP:
         iscrop=TRUE;
+        if(!strcmp(pft->name,"rice"))
+          config->rice_pft=npft;
         break;
       case WP:
         iswp=TRUE;
@@ -439,6 +440,7 @@ Bool fscanpftpar(LPJfile *file,       /**< pointer to LPJ file */
     /* Now scan PFT-specific parameters and set specific functions */
     if(scanfcn[pft->type].fcn(item,pft,config))
       return TRUE;
+    npft++;
   }
   return FALSE;
 } /* of 'fscanpftpar' */
diff --git a/src/lpj/help.c b/src/lpj/help.c
index 0140042a4..ef9786c4c 100644
--- a/src/lpj/help.c
+++ b/src/lpj/help.c
@@ -26,7 +26,8 @@
 #else
 #define IMAGE_OPT ""
 #endif
-#define USAGE "\nUsage: %s [-h] [-l] [-v] [-vv] [-pedantic] [-ofiles] [-param] [-nopp] [-pp cmd] " FPE_OPT "\n" IMAGE_OPT\
+#define USAGE "\nUsage: %s [-h] [-l] [-v] [-repo] [-hash] [-vv] [-pedantic] [-ofiles]\n"\
+                "       [-param] [-nopp] [-pp cmd] " FPE_OPT "\n" IMAGE_OPT\
                 "       [-couple host[:port]] [-wait time]\n"\
                 "       [-outpath dir] [-inpath dir] [-restartpath dir]\n"\
                 "       [[-Dmacro[=value]] [-Idir] ...] filename\n"
@@ -44,8 +45,8 @@ void help(const char *progname /**< program filename */
     file=stdout;
   }
   fprintf(file,"    ");
-  count=fprintf(file,"%s C Version " LPJ_VERSION " (%s) Help",
-                progname,getbuilddate());
+  count=fprintf(file,"%s C Version %s (%s) Help",
+                progname,getversion(),getbuilddate());
   fprintf(file,"\n    ");
   frepeatch(file,'=',count);
   fprintf(file,"\n\nDynamic global vegetation model with managed land\n");
@@ -57,6 +58,8 @@ void help(const char *progname /**< program filename */
           "-h,--help           print this help text\n"
           "-l,--license        print license file\n"
           "-v,--version        print version, compiler and compile flags\n"
+          "-repo               print GIT repository\n"
+          "-hash               print GIT hash\n"
           "-vv                 verbosely print the actual values during reading of the\n"
           "                    configuration files\n"
           "-pedantic           stops on warnings\n"
diff --git a/src/lpj/initoutput.c b/src/lpj/initoutput.c
index 7d3794cae..e3bf46fa5 100644
--- a/src/lpj/initoutput.c
+++ b/src/lpj/initoutput.c
@@ -18,6 +18,8 @@
 
 #define checkptr(ptr) if(ptr==NULL) { printallocerr(#ptr); return TRUE;}
 
+#define isopen2(output,index)  (isopen(output,index) || output->files[index].oneyear)
+
 Bool initoutput(Outputfile *outputfile, /**< Output data */
                 Cell grid[],            /**< LPJ grid */
                 int npft,               /**< number of natural PFTs */
@@ -36,7 +38,7 @@ Bool initoutput(Outputfile *outputfile, /**< Output data */
     config->outputsize[i]=outputsize(i,npft,ncft,config);
     if(config->outputsize[i]>maxsize)
       maxsize=config->outputsize[i];
-    if(isopen(outputfile,i))
+    if(isopen2(outputfile,i))
       totalsize+=config->outputsize[i];
     else
       isall=FALSE;
@@ -53,9 +55,9 @@ Bool initoutput(Outputfile *outputfile, /**< Output data */
   }
   config->outputsize[PFT_GCGP_COUNT]=config->outputsize[PFT_GCGP];
   config->outputsize[NDAY_MONTH]=config->outputsize[CFT_SWC];
-  if(isopen(outputfile,PFT_GCGP))
+  if(isopen2(outputfile,PFT_GCGP))
     totalsize+=config->outputsize[PFT_GCGP];
-  if(isopen(outputfile,CFT_SWC))
+  if(isopen2(outputfile,CFT_SWC))
     totalsize+=config->outputsize[CFT_SWC];
   if(!isall)
   {
@@ -68,7 +70,7 @@ Bool initoutput(Outputfile *outputfile, /**< Output data */
   /* calculate indices into output storage */
   for(i=FPC;i<NOUT;i++)
   {
-    if(isopen(outputfile,i))
+    if(isopen2(outputfile,i))
     {
       config->outputmap[i]=index;
       index+=config->outputsize[i];
@@ -86,14 +88,14 @@ Bool initoutput(Outputfile *outputfile, /**< Output data */
     else
       config->outputmap[i]=0; /* no output used, point to trash */
   }
-  if(isopen(outputfile,PFT_GCGP))
+  if(isopen2(outputfile,PFT_GCGP))
   {
     config->outputmap[PFT_GCGP_COUNT]=index;
     index+=config->outputsize[PFT_GCGP];
   }
   else
     config->outputmap[PFT_GCGP_COUNT]=0;
-  if(isopen(outputfile,CFT_SWC))
+  if(isopen2(outputfile,CFT_SWC))
   {
     config->outputmap[NDAY_MONTH]=index;
     index+=config->outputsize[CFT_SWC];
diff --git a/src/lpj/iterate.c b/src/lpj/iterate.c
index 93998f81a..b5a59fba4 100644
--- a/src/lpj/iterate.c
+++ b/src/lpj/iterate.c
@@ -53,12 +53,11 @@ int iterate(Outputfile *output, /**< Output file data */
 {
   Real co2, ch4, pch4,cflux_total;
   Flux flux;
-  int year,landuse_year,wateruse_year,startyear,firstspinupyear,spinup_year,climate_year,year_co2,index,data_index,rnd_year,depos_year;
+  int year,landuse_year,startyear,firstspinupyear,spinup_year,climate_year,year_co2,index,data_index,rnd_year,depos_year;
   Bool rc;
   Climatedata store,data_save;
-
-#if defined IMAGE && defined COUPLED
-  Real finish;
+#ifndef COUPLED
+  int wateruse_year;
 #endif
   if (config->isanomaly)
     data_index = (config->delta_year>1) ? 3 : 1;
@@ -229,7 +228,8 @@ int iterate(Outputfile *output, /**< Output file data */
           if(getclimate(input.climate,grid,0,year,config))
           {
             fputs("ERROR104: Simulation stopped in getclimate().\n",stderr);
-            fflush(stderr);             break; /* leave time loop */
+            fflush(stderr);
+            break; /* leave time loop */
           }
           if (readicefrac(input.icefrac,grid,0,year,config))
           {
@@ -332,7 +332,7 @@ int iterate(Outputfile *output, /**< Output file data */
       else
 #endif
       /* read landuse pattern from file */
-      rc=getlanduse(input.landuse,grid,landuse_year,year,ncft,config);
+      rc=getlanduse(input.landuse,grid,landuse_year,year,npft,ncft,config);
       if(iserror(rc,config))
       {
         if(isroot(*config))
diff --git a/src/lpj/newgrid.c b/src/lpj/newgrid.c
index 0b17342c8..d17722b95 100644
--- a/src/lpj/newgrid.c
+++ b/src/lpj/newgrid.c
@@ -433,7 +433,7 @@ static Cell *newgrid2(Config *config,          /* Pointer to LPJ configuration *
       if(!config->ischeckpoint && config->new_seed)
         setseed(grid[i].seed,config->seed_start+(i+config->startgrid)*36363);
       if(!grid[i].skip)
-        check_stand_fracs(grid+i,grid[i].lakefrac+grid[i].ml.reservoirfrac);
+        check_stand_fracs(grid+i,grid[i].lakefrac+grid[i].ml.reservoirfrac,ncft);
       else
         (*count)++;
     }
diff --git a/src/lpj/outputnames.c b/src/lpj/outputnames.c
index 8abb66ceb..a00462b84 100644
--- a/src/lpj/outputnames.c
+++ b/src/lpj/outputnames.c
@@ -23,6 +23,7 @@ void outputnames(Outputfile *outfile, /**< output file array */
 {
   int i,j;
   for(i=0;i<config->n_out;i++)
+  {
     if(config->outputvars[i].filename.fmt==CDF)
     {
       outfile->files[config->outputvars[i].id].fp.cdf.state=ONEFILE;
@@ -44,19 +45,8 @@ void outputnames(Outputfile *outfile, /**< output file array */
               outfile->files[config->outputvars[i].id].fp.cdf.root=outfile->files[config->outputvars[j].id].fp.cdf.root;
             }
           }
-          else if(isroot(*config))
-            fprintf(stderr,"WARNING023: Filename is identical for %s and %s.\n",
-                    config->outnames[config->outputvars[i].id].name,
-                    config->outnames[config->outputvars[j].id].name);
           break;
         }
     }
-    else if(isroot(*config) && config->outputvars[i].filename.fmt!=SOCK)
-    {
-      for(j=i-1;j>=0;j--)
-        if(config->outputvars[j].filename.fmt!=SOCK && !strcmp(config->outputvars[j].filename.name,config->outputvars[i].filename.name))
-          fprintf(stderr,"WARNING023: Filename is identical for %s and %s.\n",
-                  config->outnames[config->outputvars[i].id].name,
-                  config->outnames[config->outputvars[j].id].name);
   }
 } /* of 'outputnames' */
diff --git a/src/lpj/plant_gas_transport.c b/src/lpj/plant_gas_transport.c
index 1cb0ef8d8..a355d6731 100644
--- a/src/lpj/plant_gas_transport.c
+++ b/src/lpj/plant_gas_transport.c
@@ -133,7 +133,7 @@ void plant_gas_transport(Stand *stand,        /**< pointer to soil data */
             }
             CH4_plant_all+=CH4_plant;
           }
-          if((!strcmp(pft->par->name,"rice")) && CH4_plant>0)
+          if(pft->par->id==config->rice_pft && CH4_plant>0)
             CH4_rice+=CH4_plant;
           /*OXYGEN*/
           Conc_new = 0;
diff --git a/src/lpj/readconfig.c b/src/lpj/readconfig.c
index 6b82f0ddb..1b0722625 100644
--- a/src/lpj/readconfig.c
+++ b/src/lpj/readconfig.c
@@ -70,10 +70,10 @@ Bool readconfig(Config *config,        /**< LPJ configuration */
       closeconfig(lpjfile);
       return TRUE;
     }
-    if(strncmp(s,LPJ_VERSION,strlen(s)))
+    if(strncmp(s,getversion(),strlen(s)))
     {
       if(verbosity)
-        fprintf(stderr,"WARNING025: LPJ version '%s' does not match '" LPJ_VERSION "'.\n",s);
+        fprintf(stderr,"WARNING025: LPJ version '%s' does not match '%s'.\n",s,getversion());
       if(config->pedantic)
       {
         closeconfig(lpjfile);
diff --git a/src/lpj/update_annual.c b/src/lpj/update_annual.c
index f1c9cf88c..7d93570d0 100644
--- a/src/lpj/update_annual.c
+++ b/src/lpj/update_annual.c
@@ -149,7 +149,7 @@ void update_annual(Cell *cell,          /**< Pointer to cell */
   cell->hydrotopes.wetland_wtable_mean /= NMONTH;
   cell->hydrotopes.wtable_mean /= NMONTH;
   if(cell->lakefrac<1)
-    update_wetland(cell, npft + ncft,year,config);
+    update_wetland(cell, npft + ncft,ncft,year,config);
 #ifdef CHECK_BALANCE
   end.carbon=end.nitrogen = end_w=0;
   end_w+=cell->balance.excess_water;
diff --git a/src/lpj/update_daily.c b/src/lpj/update_daily.c
index aade7096e..7d1115b5c 100644
--- a/src/lpj/update_daily.c
+++ b/src/lpj/update_daily.c
@@ -37,13 +37,14 @@ void update_daily(Cell *cell,            /**< cell pointer           */
                   const Config *config   /**< LPJmL configuration */
                  )
 {
-  int s,p,isrice;
+  int s,p;
+  Bool isrice;
   Pft *pft;
   Real melt=0,eeq,par,daylength,beta,gw_outflux;
   Real CH4_em=0;
   Real melt_all,runoff,snowrunoff,epsilon_gas,soilmoist,V;
 #ifdef IMAGE
-  Real fout_gw; // local variable for groundwater outflow (baseflow)
+  //Real fout_gw; // local variable for groundwater outflow (baseflow)
 #endif
   Real gtemp_air;  /* value of air temperature response function */
   Real gtemp_soil[NSOILLAYER]; /* value of soil temperature response function */
@@ -63,7 +64,6 @@ void update_daily(Cell *cell,            /**< cell pointer           */
   Real agrfrac,fpc_total_stand;
   Real litsum_old_nv[2]={0,0},litsum_new_nv[2]={0,0};
   Real litsum_old_agr[2]={0,0},litsum_new_agr[2]={0,0};
-  isrice=FALSE;
   runoff=snowrunoff=melt_all=0;
   Irrigation *data;
 
@@ -99,9 +99,7 @@ void update_daily(Cell *cell,            /**< cell pointer           */
        stand->type->landusetype==AGRICULTURE || stand->type->landusetype==AGRICULTURE_GRASS || stand->type->landusetype==AGRICULTURE_TREE ||
        stand->type->landusetype==BIOMASS_TREE || stand->type->landusetype==BIOMASS_GRASS || stand->type->landusetype==WOODPLANTATION)
     {
-    isrice=FALSE;
-      foreachpft(pft, p, &stand->pftlist)
-       if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
+      isrice=ispftinstand(&stand->pftlist,config->rice_pft);
       data = stand->data;
       if((data->irrigation||isrice) && config->irrig_scenario!=NO_IRRIGATION) irrigstore+=data->irrig_stor;
     }
@@ -221,7 +219,7 @@ void update_daily(Cell *cell,            /**< cell pointer           */
     {
       foreachpft(pft, p, &stand->pftlist)
       {
-        if(!strcmp(pft->par->name,"rice") || stand->soil.iswetland)
+        if(pft->par->id==config->rice_pft || stand->soil.iswetland)
         {
           getoutput(&stand->cell->output,CH4_RICE_EM,config)+=CH4_em;
           stand->cell->balance.aCH4_rice+=CH4_em*stand->frac;
@@ -249,7 +247,7 @@ void update_daily(Cell *cell,            /**< cell pointer           */
     {
       foreachpft(pft, p, &stand->pftlist)
       {
-        if(!strcmp(pft->par->name,"rice") || stand->soil.iswetland)
+        if(pft->par->id==config->rice_pft || stand->soil.iswetland)
         {
           getoutput(&stand->cell->output,CH4_RICE_EM,config)+=ebul;
           stand->cell->balance.aCH4_rice+=ebul*stand->frac;
@@ -298,7 +296,7 @@ void update_daily(Cell *cell,            /**< cell pointer           */
     {
       foreachpft(pft, p, &stand->pftlist)
       {
-        if(!strcmp(pft->par->name,"rice") || stand->soil.iswetland)
+        if(pft->par->id==config->rice_pft || stand->soil.iswetland)
         {
           getoutput(&stand->cell->output,CH4_RICE_EM,config)+=CH4_em;
           stand->cell->balance.aCH4_rice+=CH4_em*stand->frac;
@@ -497,9 +495,7 @@ void update_daily(Cell *cell,            /**< cell pointer           */
        stand->type->landusetype==BIOMASS_TREE || stand->type->landusetype==BIOMASS_GRASS || stand->type->landusetype==WOODPLANTATION)
     {
       data = stand->data;
-      isrice=FALSE;
-      foreachpft(pft, p, &stand->pftlist)
-       if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
+      isrice=ispftinstand(&stand->pftlist,config->rice_pft);
       if((data->irrigation||isrice) && config->irrig_scenario!=NO_IRRIGATION)
       {
         getoutput(&cell->output,IRRIG_STOR,config)+=data->irrig_stor*stand->frac*cell->coord.area;
@@ -639,7 +635,7 @@ void update_daily(Cell *cell,            /**< cell pointer           */
   soilpar_output(cell,agrfrac,config);
   killstand(cell,npft, ncft,cell->ml.with_tillage,intercrop,year,config);
 #ifdef SAFE
-  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 #endif
   /* Establishment fluxes are area weighted in subroutines */
   getoutput(&cell->output,FLUX_ESTABC,config)+=flux_estab.carbon;
@@ -660,11 +656,10 @@ void update_daily(Cell *cell,            /**< cell pointer           */
        stand->type->landusetype==AGRICULTURE || stand->type->landusetype==AGRICULTURE_GRASS || stand->type->landusetype==AGRICULTURE_TREE ||
        stand->type->landusetype==BIOMASS_TREE || stand->type->landusetype==BIOMASS_GRASS || stand->type->landusetype==WOODPLANTATION)
      {
-      isrice=FALSE;
-      foreachpft(pft, p, &stand->pftlist)
-        if(!strcmp(pft->par->name,"rice")) isrice=TRUE;
+       isrice=ispftinstand(&stand->pftlist,config->rice_pft);
        data = stand->data;
-       if((data->irrigation||isrice) && config->irrig_scenario!=NO_IRRIGATION) irrigstore_end+=data->irrig_stor;
+       if((data->irrigation||isrice) && config->irrig_scenario!=NO_IRRIGATION)
+         irrigstore_end+=data->irrig_stor;
      }
     if(stand->type->landusetype!=KILL)
     {
diff --git a/src/lpj_climber4.c b/src/lpj_climber4.c
index ddecde24a..476bbcee3 100644
--- a/src/lpj_climber4.c
+++ b/src/lpj_climber4.c
@@ -35,7 +35,6 @@
  */
 
 #include <time.h>
-#include <math.h>
 #include <assert.h>
 #include "lpj.h"
 #include "grass.h"
@@ -48,12 +47,13 @@
 #include "agriculture.h"
 #include "agriculture_tree.h"
 #include "agriculture_grass.h"
+#include "wetland.h"
 
 #include "cpl.h"
 
-#ifndef DAILY_ESTABLISHMENT
-#error for coupling with FMS/MOM4/Climber-4 , DAILY_ESTABLISHMENT must be #defined
-#endif
+//#ifndef DAILY_ESTABLISHMENT
+//#error for coupling with FMS/MOM4/Climber-4 , DAILY_ESTABLISHMENT must be #defined
+//#endif
 
 #define NTYPES 3 /*< number of plant functional types: grass, tree, crop, bioenergy */
 #define NSTANDTYPES 15 /*< number of stand types / land use types as defined in landuse.h */
@@ -70,12 +70,9 @@ static int npft;           /*< Number of natural PFT's */
 static int ncft;           /*< Number of crop PFT's */
 
 /// from iterate()
-static Real co2,cflux_total;
+static Real co2,ch4,pch4,cflux_total;
 static Flux flux;
 static int year, landuse_year, wateruse_year;
-#ifdef STORECLIMATE
-static Climatedata store,data_save;
-#endif
 
 static double glon_min, glon_max, glat_min, glat_max;
 
@@ -85,9 +82,6 @@ static MPI_Comm comm;         ///< MPI communicator for the atmosphere domain
 static int pe, root_pe, npes; ///< our own MPI rank, root MPI rank, total number of atmosphere ranks
 
 static Cpl *cpl;              ///< mapping between LPJ grid cell list and FMS rectangular domain decomposition
-static Cpl *cpl_runoff;       ///< mapping between LPJ runoff2ocean targets and FMS rectangular domain decomposition
-static int nrunoff2ocean = 0; ///< number of cells from which runoff goes into the ocean
-static int *runoff2oceancells; ///< vector of indices of those cells from which runoff goes into the ocean
 
 static int dt_fast; /*< fast time step [sec] */
 
@@ -119,10 +113,6 @@ static Real *mevap_lake_yesterday = NULL, /* from lakes */
 // in its river routing map (cell.discharge.next == -1).
 // Here we store for each such cell the index of the target ocean cell,
 // where its runoff enters the ocean.
-static struct Runoff_map {
-  int from_i, from_j; // just for debugging / visualisation
-  int to; // destination index in regular grid on LPJ resolution
-} *runoff_map = NULL;
 
 // The DDM30 data set used as source for LPJ runoff does not have data for antarctica.
 // Thus use runoff from land_lad for that region, if use_runoff_antarctica_from_lpj = .false.
@@ -346,7 +336,9 @@ void lpj_init_
   }
 
   if (*use_runoff_antarctica_from_lpj_in) use_runoff_antarctica_from_lpj = 1;
+#ifdef USE_FMSCLOCK
   lpj_update_cpl_clock_id = *lpj_update_cpl_clock_id_in;
+#endif
 
   /*! LPJ must begin all its runs at start of a fresh year ! */
   /*! TODO: check that here. */
@@ -374,19 +366,6 @@ void lpj_init_
     {name_crop,fscanpft_crop}
   };
 
-  standtype[NATURAL]=natural_stand;
-  standtype[SETASIDE_RF]=setaside_rf_stand;
-  standtype[SETASIDE_IR]=setaside_ir_stand;
-  standtype[SETASIDE_WETLAND]=setaside_wetland_stand;
-  standtype[AGRICULTURE]=agriculture_stand;
-  standtype[MANAGEDFOREST]=managedforest_stand;
-  standtype[GRASSLAND]=grassland_stand;
-  standtype[BIOMASS_TREE]=biomass_tree_stand;
-  standtype[BIOMASS_GRASS]=biomass_grass_stand;
-  standtype[AGRICULTURE_TREE]=agriculture_tree_stand;
-  standtype[AGRICULTURE_GRASS]=agriculture_grass_stand;
-  standtype[WOODPLANTATION]=woodplantation_stand;
-  standtype[KILL]=kill_stand;
 
   /*
    * Use default communicator containing all processors. In defining your own
@@ -403,8 +382,7 @@ void lpj_init_
     {
       if(isroot(config))
       {
-        help(progname,
-             (strcmp(progname,"lpj")) ? dflt_conf_filename_ml : dflt_conf_filename);
+        help(progname);
       }
       MPI_Finalize();
       /*return EXIT_SUCCESS*/ exit(0);
@@ -432,19 +410,33 @@ void lpj_init_
    * crops must have last id-number */
   /* Read configuration file */
   rc=readconfig(&config,
-                (strcmp(progname,"lpj")) ? dflt_conf_filename_ml :
-                                           dflt_conf_filename,
                 scanfcn,NTYPES,NOUT,&argc,&argv,lpj_usage);
   failonerror(&config,rc,READ_CONFIG_ERR,"Cannot read configuration");
   if(isroot(config) && argc)
     fprintf(stderr,"WARNING018: Arguments listed after configuration filename, will be ignored.\n");
 
+  standtype[NATURAL]=natural_stand;
+  standtype[WETLAND]=wetland_stand;
+  standtype[SETASIDE_RF]=setaside_rf_stand;
+  standtype[SETASIDE_IR]=setaside_ir_stand;
+  standtype[AGRICULTURE]=agriculture_stand;
+  standtype[MANAGEDFOREST]=managedforest_stand;
+  standtype[GRASSLAND]=grassland_stand;
+  standtype[OTHERS]=others_stand;
+  standtype[BIOMASS_TREE]=biomass_tree_stand;
+  standtype[BIOMASS_GRASS]=biomass_grass_stand;
+  standtype[AGRICULTURE_TREE]=agriculture_tree_stand;
+  standtype[AGRICULTURE_GRASS]=agriculture_grass_stand;
+  standtype[WOODPLANTATION]=woodplantation_stand;
+  standtype[KILL]=kill_stand;
+
   /*! check that the date passed from FMS matches the date from the LPJ configuration */
   /* alternate TODO: set the date from FMS to the LPJ configuration structure */
   if(isroot(config))
     printf("Current FMS date: %04d-%02d-%02d. Current LPJ year: %04d\n",
            *Time_year, *Time_month, *Time_day, config.firstyear);
-  if (isroot(config) && 1 != *Time_month || 1 != *Time_day) {
+  if (isroot(config) && (1 != *Time_month || 1 != *Time_day))
+  {
     printf("Warning: FMS start time is not at begin of new year\n");
     /*fflush(stdout); abort();*/
   }
@@ -464,13 +456,6 @@ void lpj_init_
     abort();
   }
 
-#ifdef IMAGE
-  if(config.sim_id==LPJML_IMAGE)
-  {
-    rc=open_image(&config);
-    failonerror(&config,rc,OPEN_IMAGE_ERR,"Cannot open IMAGE coupler");
-  }
-#endif
   if(isroot(config))
     printconfig(config.npft[GRASS]+config.npft[TREE],
                 config.npft[CROP],&config);
@@ -488,6 +473,8 @@ void lpj_init_
   rc=initinput(&input,grid,config.npft[GRASS]+config.npft[TREE],&config);
   failonerror(&config,rc,INIT_INPUT_ERR,
               "Initialization of input data failed");
+  pch4 = param.pch4*1e-3;
+  ch4 = pch4*1e15*2.123; /* convert ppm to gC */
 
   /* open output files */
   output=fopenoutput(grid,NOUT,&config);
@@ -500,8 +487,6 @@ void lpj_init_
     writearea(output,LAKE_AREA,grid,&config);
   if(isopen(output,COUNTRY) && config.withlanduse)
     writecountrycode(output,COUNTRY,grid,&config);
-  if(isopen(output,REGION) && config.withlanduse)
-    writeregioncode(output,REGION,grid,&config);
   if(isroot(config))
     printf("Simulation begins...\n");
 
@@ -522,22 +507,6 @@ void lpj_init_
 
   // from iterate()
   //Bool rc;
-#ifdef STORECLIMATE
-  if(config.nspinup)
-  {
-    //fprintf(stderr, "Error: The current LPJ configuration specifies %d spinup years, but when coupled to Climber-4, no Spinup is possible\n",
-    //        config.nspinup);
-    //fflush(stderr);
-    //abort();
-
-    /* climate for the first nspinyear years is stored in memory
-       to avoid reading repeatedly from disk */
-    rc = storeclimate(&store,input.climate,grid,input.climate->firstyear,config.nspinyear,&config);
-    failonerror(&config,rc,STORE_CLIMATE_ERR,"Storage of climate failed");
-
-    data_save=input.climate->data;
-  }
-#endif
   if(config.initsoiltemp)
     initsoiltemp(input.climate,grid,&config);
 
@@ -550,8 +519,9 @@ void lpj_init_
    */
 
   //lpj_update_cpl_clock_id = fmsclock_id("LPJ_update_cpl"); already done in lpj_driver.F90 to pull in the fmsclock.o object file
+#ifdef USE_FMSCLOCK
   lpj_laketemp_clock_id = fmsclock_id("LPJ_update_laketemp");
-
+#endif
   /**
    * Create a mapping from Fortran90-lat-lon arrays to LPJ cell indices.
    * The mapping is needed for storing input data from land_lad/FMS into LPJ,
@@ -803,85 +773,6 @@ void lpj_init_
   //18                                                                             511 1313  901 1164  655
   //19                                                                             362 1033   49 1068 2032
 
-
-  // set up CPL mapping for runoff2ocean.
-  // Only those cells are considered where the destination indices are != -1
-  { int *cpl_xlen, *cpl_ylen;
-    int *cpl_ranks;
-    Cpl_coord *runoff_coords;
-    cpl_xlen = newvec(int, layout[0]);
-    for (i = 0; i < layout[0]; i++) {
-      cpl_xlen[i] = nlons;  // all FMS domains have same number of columns
-      //printf("cpl_xlen[%d] %d\n", i, cpl_xlen[i]);
-    }
-    cpl_ylen = newvec(int, layout[1]);
-    for (j = 0; j < layout[1]; j++) {
-      cpl_ylen[j] = nlats; // all FMS domains have same number of rows
-      //printf("cpl_ylen[%d] %d\n", j, cpl_ylen[j]);
-    }
-    //for (i = 0; i < layout[0]; i++) printf("cpl_xlen[%d] %d\n", i, cpl_xlen[i]);
-    //for (j = 0; j < layout[1]; j++) printf("cpl_ylen[%d] %d\n", j, cpl_ylen[j]);
-    cpl_ranks = newvec(int, layout[0]*layout[1]);
-    for (j = 0; j < layout[1]; j++) {
-      for (i = 0; i < layout[0]; i++) {
-        //printf("cpl_ranks [%d,%d] = %d\n", i, j, i+layout[0]*j);
-        cpl_ranks[i+layout[0]*j] = i+layout[0]*j;
-      }
-    }
-    for (i = 0; i < config.ngridcell; i++) {
-      if (grid[i].discharge.runoff2ocean_coord.lon != -1) nrunoff2ocean++;
-    }
-    runoff2oceancells = newvec(int, nrunoff2ocean);
-    runoff_coords = newvec(Cpl_coord, nrunoff2ocean);
-    for (i = 0, j = 0; i < config.ngridcell; i++) {
-      if (grid[i].discharge.runoff2ocean_coord.lon != -1) {
-        int global_i, global_j; // indices of this cell in global land_lad grid
-        runoff2oceancells[j] = i;
-        global_i=grid[i].discharge.runoff2ocean_coord.lon;
-        global_j=grid[i].discharge.runoff2ocean_coord.lat;
-        runoff_coords[j].x = global_i;
-        runoff_coords[j].y = global_j;
-        { // just for debugging
-          int local_i, local_j; // indices of this cell in its local land_lad grid domain
-          int lad_pe_i, lad_pe_j; // 2-D indices of the land_lad domain in the global grid.
-          int lad_pe; // PE number of the land_lad domain
-          lad_pe_i = global_i / nlons; //assert(0 <= lad_pe_i); assert(lad_pe_i < layout[0]);
-          lad_pe_j = global_j / nlats; //assert(0 <= lad_pe_j); assert(lad_pe_j < layout[1]);
-          lad_pe = lad_pe_i + lad_pe_j * layout[0];
-          //assert(0 <= lad_pe);
-          //assert(lad_pe < layout[0]*layout[1]);
-          local_i = global_i - lad_pe_i * nlons;
-          local_j = global_j - lad_pe_j * nlats;
-          printf("runoff2ocean pe %2d cell %5d/%5d lon %7.2f lat %6.2f -> %3d %3d pe %dx%d= %2d at local i/j %3d %3d\n",
-                 pe, i, j, grid[i].coord.lon, grid[i].coord.lat,
-                 global_i, global_j,
-                 lad_pe_i, lad_pe_j, lad_pe,
-                 local_i, local_j);
-        } // just for debugging
-        j++;
-      }
-    }
-    assert(j == nrunoff2ocean);
-    cpl_runoff = cpl_init(runoff_coords, nrunoff2ocean, cpl_xlen, cpl_ylen, cpl_ranks, layout[0], layout[1], comm);
-    free(cpl_ranks); free(cpl_ylen); free(cpl_xlen);
-    free(runoff_coords);
-  }
-  if (!cpl_runoff) { fprintf(stderr, "Error: cpl_init() for runoff failed\n"); exit(1); }
-  printf("cpl_init() for runoff got cpl_size %d\n", cpl_size(cpl_runoff));
-  for (i = 0; i < npes; i++) {
-    printf("  for pe %2d: inlen %5d indisp %5d outlen %5d outdisp %5d\n",
-           i, cpl_runoff->inlen[i], cpl_runoff->indisp[i], cpl_runoff->outlen[i], cpl_runoff->outdisp[i]);
-    for (j = cpl_runoff->indisp[i]; j < cpl_runoff->indisp[i] + cpl_runoff->inlen[i]; j++) {
-      if (j < 0 || j >= nrunoff2ocean) printf("index %d outside src array\n", j);
-    }
-    for (j = cpl_runoff->outdisp[i]; j < cpl_runoff->outdisp[i] + cpl_runoff->outlen[i]; j++) {
-      if (j < 0 || j >= cpl_size(cpl_runoff)) printf("index %d outside dst array\n", j);
-    }
-  }
-
-  fflush(stdout); fflush(stderr);
-  MPI_Barrier(comm);
-
   mevap_yesterday = newvec(Real, config.ngridcell);
   mtransp_yesterday = newvec(Real, config.ngridcell);
   mevap_lake_yesterday = newvec(Real, config.ngridcell);
@@ -1147,7 +1038,9 @@ cpl_fms_to_lpj(const double *from_fms_in, //< input data on 2-D fms compute doma
   double *buf_lpj;
   double *buf_cpl;
 
+#ifdef USE_FMSCLOCK
   fmsclock_begin_(&lpj_update_cpl_clock_id);
+#endif
   buf_lpj = alloca(sizeof(double) * config.ngridcell);
   buf_cpl = alloca(sizeof(double) * cpl_size(cpl));
 
@@ -1167,7 +1060,9 @@ cpl_fms_to_lpj(const double *from_fms_in, //< input data on 2-D fms compute doma
     assert(cpl_src_index(cpl,i) < config.ngridcell);
     to_lpj_out[i] = buf_lpj[cpl_src_index(cpl,i)];
   }
+#ifdef USE_FMSCLOCK
   fmsclock_end_(&lpj_update_cpl_clock_id);
+#endif
 }
 
 /** helper function for conversion from LPJ grid cells to FMS/land_lad domain */
@@ -1179,7 +1074,9 @@ cpl_lpj_to_fms(const double *from_lpj, //< input data, 1-D, for each LPJ grid ce
   double *buf_lpj;
   double *buf_cpl;
 
+#ifdef USE_FMSCLOCK
   fmsclock_begin_(&lpj_update_cpl_clock_id);
+#endif
   buf_lpj = alloca(sizeof(double) * config.ngridcell);
   buf_cpl = alloca(sizeof(double) * cpl_size(cpl));
 
@@ -1200,7 +1097,9 @@ cpl_lpj_to_fms(const double *from_lpj, //< input data, 1-D, for each LPJ grid ce
     to_fms[cpl_xcoord(cpl,i) + cpl_ycoord(cpl,i) * nlons] = buf_cpl[i];
     //printf("cpl_lpj_to_fms: to_fms[%d] = buf_cpl[%d] = %f\n", cpl_xcoord(cpl,i) + cpl_ycoord(cpl,i) * nlons, i);
   }
+#ifdef USE_FMSCLOCK
   fmsclock_end_(&lpj_update_cpl_clock_id);
+#endif
 }
 
 
@@ -1286,14 +1185,9 @@ void lpj_update_
     /* some things must be done at start of a new year only */
     if (happynewyear) { /* from iterate() */
 
-#ifdef IMAGE
-      if(year>=config.start_imagecoupling)
-        co2=receive_image_co2(&config);
-      else
-#endif
       if (input.climate->co2.data) // invoke getco2() when reading from real file, not FMS
       {
-        if(getco2(input.climate,&co2,year)) /* get atmospheric CO2 concentration */
+        if(getco2(input.climate,&co2,year,&config)) /* get atmospheric CO2 concentration */
           fprintf(stderr,"ERROR015: Invalid year %d in getco2().\n",year);
       }
       /* else: use CO2 as given by LPJ coupler - done below in daily loop-over-cells */
@@ -1307,29 +1201,19 @@ void lpj_update_
       //getclimate(input.climate,grid,input.climate->firstyear+(year-config.firstyear+config.nspinup) % config.nspinyear,&config);
 //#endif
       //else
+      if(!config.with_dynamic_ch4  && config.from_restart)
       {
-#ifdef STORECLIMATE
-        if(year==input.climate->firstyear && config.nspinup)
-        {
-          /* restore climate data pointers to initial data */
-          input.climate->data=data_save;
-          freeclimatedata(&store); /* free data not used anymore */
-        }
-#endif
-        /* read climate from files */
-#ifdef IMAGE
-        if(year>=config.start_imagecoupling)
-        {
-          if(receive_image_climate(input.climate,grid,year,&config))
+        if(getch4(input.climate,&ch4,year,&config)) /* get atmospheric CH4 concentration */
         {
-            fprintf(stderr,"ERROR104: Simulation stopped in receive_image_climate().\n");
-            fflush(stderr);
-            /*break;*/ /* leave time loop */ abort();
+          if(isroot(config))
+            fprintf(stderr,"ERROR015: Invalid year %d in getch4().\n",year);
+          abort();
         }
+        pch4=ch4*1e-3; /*convert to ppm*/
       }
-        else
-#endif
-          if(getclimate(input.climate,grid,year,&config))
+      {
+        /* read climate from files */
+          if(getclimate(input.climate,grid,year,1,&config))
           {
             fprintf(stderr,"ERROR104: Simulation stopped in getclimate().\n");
             fflush(stderr);
@@ -1348,20 +1232,8 @@ void lpj_update_
           wateruse_year=config.landuse_year_const;
         else
            wateruse_year=year;
-#ifdef IMAGE
-        if(year>=config.start_imagecoupling)
-        {
-          if (receive_image_data(grid,npft,ncft,&config))
-          {
-            fprintf(stderr,"ERROR104: Simulation stopped in receive_image_data().\n");
-            fflush(stderr);
-            /*break;*/ /* leave time loop */ abort();
-          }
-        }
-        else
-#endif
           /* read landuse pattern from file */
-          if(getlanduse(input.landuse,grid,landuse_year,year,ncft,&config))
+          if(getlanduse(input.landuse,grid,landuse_year,year,npft,ncft,&config))
           {
             fprintf(stderr,"ERROR104: Simulation stopped in getlanduse().\n");
             fflush(stderr);
@@ -1406,11 +1278,10 @@ void lpj_update_
 
     /* perform iteration for one year */
     /* broken up iterateyear_river() to be called on every time step */
-    if(output->method==LPJ_SOCKET || config.river_routing) {
       /*iterateyear_river(output,grid,input,co2,npft,ncft,&config,year);*/
       { /* begin iterateyear_river() */
         static Dailyclimate daily;
-        static Bool intercrop,istimber;
+        static Bool intercrop;
         /* dailyclimate.c: month (0..11) day (1..365) */
         static int /*month,*/ /*dayofmonth,*/ dayofyear;
         int cell,i;
@@ -1418,11 +1289,6 @@ void lpj_update_
 
         if (happynewyear) { /* things from iterateyear_river() to be done at begin of year */
           popdens=0;
-#ifdef IMAGE
-          istimber=(config.start_imagecoupling!=INT_MAX);
-#else
-          istimber=FALSE;
-#endif
           intercrop=getintercrop(input.landuse);
           for(cell=0;cell<config.ngridcell;cell++)
           {
@@ -1437,17 +1303,12 @@ void lpj_update_
                 if(grid[cell].lakefrac<1)
                 {
                   /* calculate landuse change */
-                  if(config.laimax_interpolate!=CONST_LAI_MAX)
-                    laimax_manage(&grid[cell].ml.manage,config.pftpar+npft,npft,ncft,year);
                   if(year>config.firstyear-config.nspinup)
                     landusechange(grid+cell,npft,ncft,intercrop,year,&config);
                   else if(grid[cell].ml.dam)
                     landusechange_for_reservoir(grid+cell,npft,ncft,
                                                 intercrop,year,&config);
                 }
-#ifdef IMAGE
-                setoutput_image(grid+cell,ncft);
-#endif
               }
               initgdd(grid[cell].gdd,npft);
             } /*gridcell skipped*/
@@ -1473,9 +1334,6 @@ void lpj_update_
               mevap_lake_yesterday[cell] = mevap_res_yesterday[cell] = 0.0;
               minterc_yesterday[cell] = 0.0; 
               initclimate_monthly(input.climate,&grid[cell].climbuf,cell,month,grid[cell].seed);
-#ifdef IMAGE
-              monthlyoutput_image(&grid[cell].output,input.climate,cell,month);
-#endif
 
 #ifdef DEBUG
               printf("temp = %.2f prec = %.2f wet = %.2f",
@@ -1569,7 +1427,7 @@ void lpj_update_
 #ifdef DEBUG
               //printf("day=%d cell=%d CO2=%g\n",dayofyear,cell, co2);
 #endif
-              update_daily(grid+cell,co2,popdens,daily,dayofyear,npft,ncft,
+              update_daily(grid+cell,co2,pch4,popdens,daily,dayofyear,npft,ncft,
                            year,month,intercrop,&config);
             }
           }
@@ -1759,7 +1617,7 @@ void lpj_update_
             if(!grid[cell].skip)
             {
               grid[cell].landcover=(config.prescribe_landcover!=NO_LANDCOVER) ? getlandcover(input.landcover,cell) : NULL;
-              update_annual(grid+cell,npft,ncft,popdens,year,TRUE,intercrop,&config);
+              update_annual(grid+cell,npft,ncft,year,TRUE,intercrop,&config);
 #ifdef SAFE
               check_fluxes(grid+cell,year,cell,&config);
 #endif
@@ -1774,26 +1632,26 @@ void lpj_update_
 #endif
               if(config.equilsoil)
               {
-                if((year-(config->firstyear-config->nspinup+param.veg_equil_year-param.equisoil_years))%param.equisoil_interval==0 && 
-                  (year-(config->firstyear-config->nspinup+param.veg_equil_year-param.equisoil_years))/param.equisoil_interval>=0 && 
-                  (year-(config->firstyear-config->nspinup+param.veg_equil_year-param.equisoil_years))/param.equisoil_interval<param.nequilsoil)
+                if((year-(config.firstyear-config.nspinup+param.veg_equil_year-param.equisoil_years))%param.equisoil_interval==0 && 
+                  (year-(config.firstyear-config.nspinup+param.veg_equil_year-param.equisoil_years))/param.equisoil_interval>=0 && 
+                  (year-(config.firstyear-config.nspinup+param.veg_equil_year-param.equisoil_years))/param.equisoil_interval<param.nequilsoil)
                   equilveg(grid+cell,npft+ncft);
 
-                if(year==(config->firstyear-config->nspinup+param.veg_equil_year))
-                  equilsom(grid+cell,npft+ncft,config->pftpar,TRUE);
+                if(year==(config.firstyear-config.nspinup+param.veg_equil_year))
+                  equilsom(grid+cell,npft+ncft,config.pftpar,TRUE);
         
-                if((year-(config->firstyear-config->nspinup+param.veg_equil_year))%param.equisoil_interval==0 && 
-                  (year-(config->firstyear-config->nspinup+param.veg_equil_year))/param.equisoil_interval>0 && 
-                  (year-(config->firstyear-config->nspinup+param.veg_equil_year))/param.equisoil_interval<param.nequilsoil)
-                  equilsom(grid+cell,npft+ncft,config->pftpar,FALSE);
+                if((year-(config.firstyear-config.nspinup+param.veg_equil_year))%param.equisoil_interval==0 && 
+                  (year-(config.firstyear-config.nspinup+param.veg_equil_year))/param.equisoil_interval>0 && 
+                  (year-(config.firstyear-config.nspinup+param.veg_equil_year))/param.equisoil_interval<param.nequilsoil)
+                  equilsom(grid+cell,npft+ncft,config.pftpar,FALSE);
 
                 if(param.equisoil_fadeout>0)
                 {
-                  if(year==(config->firstyear-config->nspinup+param.veg_equil_year+param.equisoil_interval*param.nequilsoil))
+                  if(year==(config.firstyear-config.nspinup+param.veg_equil_year+param.equisoil_interval*param.nequilsoil))
                     equilveg(grid+cell,npft+ncft);
 
-                  if(year==(config->firstyear-config->nspinup+param.veg_equil_year+param.equisoil_interval*param.nequilsoil+param.equisoil_fadeout))
-                    equilsom(grid+cell,npft+ncft,config->pftpar,FALSE);
+                  if(year==(config.firstyear-config.nspinup+param.veg_equil_year+param.equisoil_interval*param.nequilsoil+param.equisoil_fadeout))
+                    equilsom(grid+cell,npft+ncft,config.pftpar,FALSE);
                 }
               }
 
@@ -1815,12 +1673,6 @@ void lpj_update_
 
         } /* if (silvester) */ /* end iterateyear_river() */
       } /* end iterateyear_river */
-    } else {
-      /* iteration without river routing */
-      /*iterateyear(output,grid,input,co2,npft,ncft,&config,year);*/
-      fprintf(stderr, "Oops, river routing was not enabled in the LPJ configuration\n");
-      exit(1);
-    }
 
     if (silvester) { /* from iterate() */
       if(year>=config.outputyear)
@@ -1830,32 +1682,26 @@ void lpj_update_
       cflux_total=flux_sum(&flux,grid,&config);
       if(config.rank==0)
       {
+        if (config.with_dynamic_ch4)
+        {
+          ch4 += flux.CH4_emissions - flux.CH4_sink + flux.CH4_fire - 1 / tau_CH4*ch4;
+          pch4 = ch4*1e-15 / 2.123;
+        }
         /* output of total carbon flux and water on stdout on root task */
         printflux(flux,cflux_total,year,&config);
-        if(output->method==LPJ_SOCKET && output->socket!=NULL &&
-           year>=config.outputyear)
-          output_flux(output,flux);
+        if(isopen(output,GLOBALFLUX))
+          fprintcsvflux(output->files[GLOBALFLUX].fp.file,flux,cflux_total,
+                        config.outnames[GLOBALFLUX].scale,year,&config);
+        if(output->files[GLOBALFLUX].issocket)
+          send_flux_coupler(&flux,config.outnames[GLOBALFLUX].scale,year,&config);
         fflush(stdout); /* force output to console */
 #ifdef SAFE
         check_balance(flux,year,&config);
 #endif
       }
-#ifdef IMAGE
-      if(year>=config.start_imagecoupling)
-      {
-        /* send data to IMAGE */
-#ifdef DEBUG_IMAGE
-        if(config.rank==0)
-        {
-          printf("sending data to image? year %d startimagecoupling %d\n",
-                 year,config.start_imagecoupling);
-          fflush(stdout);
-        }
-#endif
-        if(send_image_data(&config,grid,input.climate,npft))
-          fail(SEND_IMAGE_ERR,FALSE,FALSE,
-               "Problem with writing maps for transfer to IMAGE");
-      }
+#ifdef USE_MPI
+      if (config.with_dynamic_ch4)
+        MPI_Bcast(&pch4, sizeof(Real), MPI_BYTE, 0, comm);
 #endif
       if(iswriterestart(&config) && year==config.restartyear)
         fwriterestart(grid,npft,ncft,year,config.write_restart_filename,FALSE,&config); /* write restart file */
@@ -1865,14 +1711,6 @@ void lpj_update_
 
   } /* of 'for(year=...)' */
 
-#ifdef STORECLIMATE
-  if(config.nspinup && (config.lastyear<input.climate->firstyear || year<input.climate->firstyear))
-  {
-    /* restore climate data pointers to initial data */
-    input.climate->data=data_save;
-    freeclimatedata(&store); /* free data not used anymore */
-  }
-#endif
   return /*year*/;
 }
 
@@ -1896,10 +1734,6 @@ void lpj_end_() {
            config.total
            );
   }
-#ifdef IMAGE
-  if(config.sim_id==LPJML_IMAGE)
-    close_image(&config);
-#endif
   freeconfig(&config);
   cpl_free(cpl);
 
diff --git a/src/lpjml.c b/src/lpjml.c
index b04f205c4..7a755097d 100644
--- a/src/lpjml.c
+++ b/src/lpjml.c
@@ -148,6 +148,24 @@ int main(int argc,char **argv)
         printflags(progname);
 #ifdef USE_MPI
       MPI_Finalize();
+#endif
+      return EXIT_SUCCESS;
+    }
+    else if(!strcmp(argv[1],"-hash")) /* check for hash option */
+    {
+      if(isroot(config))
+        puts(gethash());
+#ifdef USE_MPI
+      MPI_Finalize();
+#endif
+      return EXIT_SUCCESS;
+    }
+    else if(!strcmp(argv[1],"-repo")) /* check for repo option */
+    {
+      if(isroot(config))
+        puts(getrepo());
+#ifdef USE_MPI
+      MPI_Finalize();
 #endif
       return EXIT_SUCCESS;
     }
diff --git a/src/netcdf/Makefile b/src/netcdf/Makefile
index e68729081..b085dfb6d 100644
--- a/src/netcdf/Makefile
+++ b/src/netcdf/Makefile
@@ -26,7 +26,8 @@ OBJS    = create_netcdf.$O close_netcdf.$O write_float_netcdf.$O\
           getvar_netcdf.$O readintdata_netcdf.$O readshortdata_netcdf.$O\
           write_int_netcdf.$O mpi_openclimate_netcdf.$O open_netcdf.$O\
           openfile_netcdf.$O flush_netcdf.$O readmap_netcdf.$O\
-          checkcoord.$O getattr_netcdf.$O getvarname_netcdf.$O
+          checkcoord.$O getattr_netcdf.$O getvarname_netcdf.$O setlatlon.$O\
+          settimeaxis.$O
 
 INC     = ../../include
 LIBDIR  = ../../lib
diff --git a/src/netcdf/create_netcdf.c b/src/netcdf/create_netcdf.c
index 2618ddcb0..c8b969836 100644
--- a/src/netcdf/create_netcdf.c
+++ b/src/netcdf/create_netcdf.c
@@ -23,7 +23,7 @@
 static nc_type nctype[]={NC_BYTE,NC_SHORT,NC_INT,NC_FLOAT,NC_DOUBLE};
 #endif
 
-#define error(rc) if(rc) {if(cdf->state==ONEFILE || cdf->state==CLOSE) {free(lon);free(lat);free(year);}fprintf(stderr,"ERROR427: Cannot write '%s': %s.\n",filename,nc_strerror(rc)); nc_close(cdf->ncid); return TRUE;}
+#define error(rc) if(rc) {if(cdf->state==ONEFILE || cdf->state==CLOSE) {free(lon);free(lon_bnds);free(lat);free(lat_bnds);free(year);free(bnds);}fprintf(stderr,"ERROR427: Cannot write '%s': %s.\n",filename,nc_strerror(rc)); nc_close(cdf->ncid); return TRUE;}
 
 Bool create_netcdf(Netcdf *cdf,
                    const char *filename,     /**< filename of NetCDF file */
@@ -43,11 +43,14 @@ Bool create_netcdf(Netcdf *cdf,
 #ifdef USE_NETCDF
   char *s;
   time_t t;
-  int i,j,rc,nyear,imiss=MISSING_VALUE_INT,len;
+  int i,rc,nyear,imiss=MISSING_VALUE_INT,len;
+  int bnds_dim_id;
+  int dimids[2];
   short smiss=MISSING_VALUE_SHORT;
-  double *lon=NULL,*lat=NULL;
+  double *lon=NULL,*lat=NULL,*lon_bnds,*lat_bnds;
   float miss=config->missing_value;
   double *year=NULL;
+  double *bnds=NULL;
   size_t chunk[3];
   int dim[3];
   if(array==NULL || name==NULL || filename==NULL)
@@ -66,6 +69,9 @@ Bool create_netcdf(Netcdf *cdf,
      cdf->time_var_id=cdf->root->time_var_id;
      cdf->lat_var_id=cdf->root->lat_var_id;
      cdf->lon_var_id=cdf->root->lon_var_id;
+     cdf->time_bnds_var_id=cdf->root->time_bnds_var_id;
+     cdf->lat_bnds_var_id=cdf->root->lat_bnds_var_id;
+     cdf->lon_bnds_var_id=cdf->root->lon_bnds_var_id;
   }
   if(oneyear)
     nyear=1;
@@ -100,103 +106,26 @@ Bool create_netcdf(Netcdf *cdf,
   }
   if(cdf->state==ONEFILE || cdf->state==CLOSE)
   {
-    lon=newvec(double,array->nlon);
-    if(lon==NULL)
-    {
-      printallocerr("lon");
-      return TRUE;
-    }
-    lat=newvec(double,array->nlat);
-    if(lat==NULL)
-    {
-      printallocerr("lat");
-      free(lon);
+    if(setlatlon(&lat,&lon,&lat_bnds,&lon_bnds,array))
       return TRUE;
-    }
-    for(i=0;i<array->nlon;i++)
-      lon[i]=array->lon_min+i*config->resolution.lon;
-    if(config->rev_lat)
-      for(i=0;i<array->nlat;i++)
-        lat[i]=array->lat_min+(array->nlat-1-i)*config->resolution.lat;
-    else
-      for(i=0;i<array->nlat;i++)
-        lat[i]=array->lat_min+i*config->resolution.lat;
     if(n)
     {
       if(n==1 && oneyear)
         year=NULL;
       else
       {
-        if(n==1)
-          year=newvec(double,nyear/timestep);
-        else
-          year=newvec(double,nyear*n);
-        if(year==NULL)
+        if(settimeaxis(&year,&bnds,nyear,n,timestep,config->outputyear,config->baseyear,oneyear,config->with_days,config->absyear,filename))
         {
-          printallocerr("year");
-          free(lon);
           free(lat);
+          free(lat_bnds);
+          free(lon);
+          free(lon_bnds);
           return TRUE;
         }
       }
     }
     else
       year=NULL;
-    switch(n)
-    {
-      case 0:
-        break;
-      case 1:
-        if(year!=NULL)
-        {
-          if(config->absyear)
-            for(i=0;i<nyear/timestep;i++)
-              year[i]=config->outputyear+i*timestep+timestep/2;
-          else
-            for(i=0;i<nyear/timestep;i++)
-              year[i]=config->outputyear-config->baseyear+i*timestep+timestep/2;
-        }
-        break;
-      case 12:
-        if(config->with_days)
-        {
-          for(i=0;i<nyear;i++)
-            for(j=0;j<12;j++)
-              if(i==0 && j==0)
-              {
-                if(oneyear)
-                  year[0]=ndaymonth[j]-1;
-                else
-                  year[0]=ndaymonth[j]-1+(config->outputyear-config->baseyear)*NDAYYEAR;
-              }
-              else
-                year[i*12+j]=year[i*12+j-1]+ndaymonth[j];
-        }
-        else
-        {
-          if(oneyear)
-            for(i=0;i<12;i++)
-              year[i]=i;
-          else
-            for(i=0;i<nyear*12;i++)
-              year[i]=(config->outputyear-config->baseyear)*NMONTH+i;
-        }
-        break;
-      case NDAYYEAR:
-        if(oneyear)
-          for(i=0;i<n;i++)
-            year[i]=i;
-        else
-          for(i=0;i<nyear*n;i++)
-            year[i]=(config->outputyear-config->baseyear)*NDAYYEAR+i;
-        break;
-      default:
-        fprintf(stderr,"ERROR425: Invalid value=%d for number of data points per year in '%s'.\n",n,filename);
-        free(year);
-        free(lon);
-        free(lat);
-        return TRUE;
-    }
   }
   if(cdf->state==ONEFILE || cdf->state==CREATE)
   {
@@ -208,14 +137,19 @@ Bool create_netcdf(Netcdf *cdf,
       if(cdf->state==ONEFILE)
       {
         free(year);
+        free(bnds);
         free(lon);
+        free(lon_bnds);
         free(lat);
+        free(lat_bnds);
       }
       return TRUE;
     }
     if(config->nofill)
       ncsetfill(cdf->ncid,NC_NOFILL);
-    if(year!=NULL)
+    rc=nc_def_dim(cdf->ncid,BNDS_NAME,2,&bnds_dim_id);
+    error(rc);
+    if(n!=0 && (n>1 || !oneyear))
     {
       if(n==1)
         rc=nc_def_dim(cdf->ncid,TIME_DIM_NAME,nyear/timestep,&cdf->time_dim_id);
@@ -228,6 +162,14 @@ Bool create_netcdf(Netcdf *cdf,
       error(rc);
       rc=nc_put_att_text(cdf->ncid, cdf->time_var_id,"long_name",strlen(TIME_LONG_NAME),TIME_LONG_NAME);
       error(rc);
+      rc=nc_put_att_text(cdf->ncid, cdf->time_var_id,"bounds",strlen(TIME_BNDS_NAME),TIME_BNDS_NAME);
+      error(rc);
+      dimids[0]=cdf->time_dim_id;
+      dimids[1]=bnds_dim_id;
+      rc=nc_def_var(cdf->ncid,TIME_BNDS_NAME,NC_DOUBLE,2,dimids,&cdf->time_bnds_var_id);
+      error(rc);
+      rc=nc_put_att_text(cdf->ncid, cdf->time_bnds_var_id,"long_name",strlen(TIME_BNDS_LONG_NAME),TIME_BNDS_LONG_NAME);
+      error(rc)
     }
     rc=nc_def_dim(cdf->ncid,LAT_DIM_NAME,array->nlat,&cdf->lat_dim_id);
     error(rc);
@@ -236,7 +178,17 @@ Bool create_netcdf(Netcdf *cdf,
     rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"title",
                        strlen(config->sim_name),config->sim_name);
     error(rc);
-    rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"source",strlen("LPJmL C Version " LPJ_VERSION),"LPJmL C Version " LPJ_VERSION);
+    len=snprintf(NULL,0,"LPJmL C Version %s",getversion());
+    s=malloc(len+1);
+    sprintf(s,"LPJmL C Version %s",getversion());
+    rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"source",strlen(s),s);
+    free(s);
+    error(rc);
+    rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"GIT_repo",
+                       strlen(getrepo()),getrepo());
+    error(rc);
+    rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"GIT_hash",
+                       strlen(gethash()),gethash());
     error(rc);
     time(&t);
     len=snprintf(NULL,0,"%s: %s",strdate(&t),config->arglist);
@@ -252,9 +204,17 @@ Bool create_netcdf(Netcdf *cdf,
     }
     rc=nc_def_var(cdf->ncid,LAT_NAME,NC_DOUBLE,1,&cdf->lat_dim_id,&cdf->lat_var_id);
     error(rc);
+    dimids[0]=cdf->lat_dim_id;
+    dimids[1]=bnds_dim_id;
+    rc=nc_def_var(cdf->ncid,LAT_BNDS_NAME,NC_DOUBLE,2,dimids,&cdf->lat_bnds_var_id);
+    error(rc);
     rc=nc_def_var(cdf->ncid,LON_NAME,NC_DOUBLE,1,&cdf->lon_dim_id,&cdf->lon_var_id);
     error(rc);
-    if(year!=NULL)
+    dimids[0]=cdf->lon_dim_id;
+    dimids[1]=bnds_dim_id;
+    rc=nc_def_var(cdf->ncid,LON_BNDS_NAME,NC_DOUBLE,2,dimids,&cdf->lon_bnds_var_id);
+    error(rc);
+    if(n!=0 && (n>1 || !oneyear))
     {
       if(n==1)
       {
@@ -262,9 +222,9 @@ Bool create_netcdf(Netcdf *cdf,
           s=strdup(YEARS_NAME);
         else
         {
-          len=snprintf(NULL,0,"years since %d-1-1 0:0:0",(oneyear) ? actualyear : config->baseyear);
+          len=snprintf(NULL,0,"%s since %d-1-1 0:0:0",(config->with_days) ? "days" : "years",config->baseyear);
           s=malloc(len+1);
-          sprintf(s,"years since %d-1-1 0:0:0",(oneyear) ? actualyear : config->baseyear);
+          sprintf(s,"%s since %d-1-1 0:0:0",(config->with_days) ? "days" : "years",config->baseyear);
         }
       }
       else if(n==12)
@@ -280,34 +240,57 @@ Bool create_netcdf(Netcdf *cdf,
         sprintf(s,"days since %d-1-1 0:0:0",(oneyear) ? actualyear : config->baseyear);
       }
       rc=nc_put_att_text(cdf->ncid,cdf->time_var_id,"units",strlen(s),s);
+      rc=nc_put_att_text(cdf->ncid,cdf->time_bnds_var_id,"units",strlen(s),s);
       free(s);
       error(rc);
       rc=nc_put_att_text(cdf->ncid,cdf->time_var_id,"calendar",strlen(CALENDAR),
                          CALENDAR);
       error(rc);
+      rc=nc_put_att_text(cdf->ncid,cdf->time_bnds_var_id,"calendar",strlen(CALENDAR),
+                         CALENDAR);
+      error(rc);
       rc=nc_put_att_text(cdf->ncid, cdf->time_var_id,"axis",strlen("T"),"T");
       error(rc);
     }
     rc=nc_put_att_text(cdf->ncid,cdf->lon_var_id,"units",strlen("degrees_east"),
                      "degrees_east");
     error(rc);
+    rc=nc_put_att_text(cdf->ncid,cdf->lon_bnds_var_id,"units",strlen("degrees_east"),
+                     "degrees_east");
+    error(rc);
     rc=nc_put_att_text(cdf->ncid, cdf->lon_var_id,"long_name",strlen(LON_LONG_NAME),LON_LONG_NAME);
     error(rc);
+    if(strlen(LON_BNDS_LONG_NAME))
+    {
+      rc=nc_put_att_text(cdf->ncid, cdf->lon_bnds_var_id,"long_name",strlen(LON_BNDS_LONG_NAME),LON_BNDS_LONG_NAME);
+      error(rc);
+    }
     rc=nc_put_att_text(cdf->ncid, cdf->lon_var_id,"standard_name",strlen(LON_STANDARD_NAME),LON_STANDARD_NAME);
     error(rc);
+    rc=nc_put_att_text(cdf->ncid, cdf->lon_var_id,"bounds",strlen(LON_BNDS_NAME),LON_BNDS_NAME);
+    error(rc);
     rc=nc_put_att_text(cdf->ncid, cdf->lon_var_id,"axis",strlen("X"),"X");
     error(rc);
     rc=nc_put_att_text(cdf->ncid,cdf->lat_var_id,"units",strlen("degrees_north"),
                      "degrees_north");
     error(rc);
+    rc=nc_put_att_text(cdf->ncid,cdf->lat_bnds_var_id,"units",strlen("degrees_north"),
+                     "degrees_north");
     rc=nc_put_att_text(cdf->ncid, cdf->lat_var_id,"long_name",strlen(LAT_LONG_NAME),LAT_LONG_NAME);
     error(rc);
+    if(strlen(LAT_BNDS_LONG_NAME))
+    {
+      rc=nc_put_att_text(cdf->ncid, cdf->lat_bnds_var_id,"long_name",strlen(LAT_BNDS_LONG_NAME),LAT_BNDS_LONG_NAME);
+      error(rc);
+    }
     rc=nc_put_att_text(cdf->ncid, cdf->lat_var_id,"standard_name",strlen(LAT_STANDARD_NAME),LAT_STANDARD_NAME);
     error(rc);
+    rc=nc_put_att_text(cdf->ncid, cdf->lat_var_id,"bounds",strlen(LAT_BNDS_NAME),LAT_BNDS_NAME);
+    error(rc);
     rc=nc_put_att_text(cdf->ncid, cdf->lat_var_id,"axis",strlen("Y"),"Y");
     error(rc);
   }
-  if(year!=NULL)
+  if(n!=0 && (n>1 || !oneyear))
   {
     dim[0]=cdf->time_dim_id;
     dim[1]=cdf->lat_dim_id;
@@ -367,8 +350,11 @@ Bool create_netcdf(Netcdf *cdf,
     default:
       fputs("ERROR428: Invalid data type in NetCDF file.\n",stderr);
       free(lat);
+      free(lat_bnds);
       free(lon);
+      free(lon_bnds);
       free(year);
+      free(bnds);
       return TRUE;
 
   }
@@ -381,14 +367,23 @@ Bool create_netcdf(Netcdf *cdf,
     {
       rc=nc_put_var_double(cdf->ncid,cdf->time_var_id,year);
       error(rc);
+      rc=nc_put_var_double(cdf->ncid,cdf->time_bnds_var_id,bnds);
+      error(rc);
     }
     rc=nc_put_var_double(cdf->ncid,cdf->lat_var_id,lat);
     error(rc);
+    rc=nc_put_var_double(cdf->ncid,cdf->lat_bnds_var_id,lat_bnds);
+    error(rc);
     rc=nc_put_var_double(cdf->ncid,cdf->lon_var_id,lon);
     error(rc);
+    rc=nc_put_var_double(cdf->ncid,cdf->lon_bnds_var_id,lon_bnds);
+    error(rc);
     free(lat);
+    free(lat_bnds);
     free(lon);
+    free(lon_bnds);
     free(year);
+    free(bnds);
   }
   return FALSE;
 #else
diff --git a/src/netcdf/create_pft_netcdf.c b/src/netcdf/create_pft_netcdf.c
index 733e3dfbc..f690d2ea7 100644
--- a/src/netcdf/create_pft_netcdf.c
+++ b/src/netcdf/create_pft_netcdf.c
@@ -22,7 +22,7 @@
 static nc_type nctype[]={NC_BYTE,NC_SHORT,NC_INT,NC_FLOAT,NC_DOUBLE};
 #endif
 
-#define error(rc) if(rc) {free(lon);free(lat);free(year);free(layer);free(bnds);free(pftnames); fprintf(stderr,"ERROR427: Cannot write '%s': %s.\n",filename,nc_strerror(rc)); nc_close(cdf->ncid); return TRUE;}
+#define error(rc) if(rc) {free(lon);free(lon_bnds);free(lat);free(lat_bnds);free(year);free(layer);free(bnds);free(time_bnds);free(pftnames); fprintf(stderr,"ERROR427: Cannot write '%s': %s.\n",filename,nc_strerror(rc)); nc_close(cdf->ncid); return TRUE;}
 
 Bool create_pft_netcdf(Netcdf *cdf,
                        const char *filename, /**< filename of NetCDF file */
@@ -45,13 +45,13 @@ Bool create_pft_netcdf(Netcdf *cdf,
 #ifdef USE_NETCDF
   char *s;
   time_t t;
-  int i,j,rc,nyear,imiss=MISSING_VALUE_INT,size,len;
+  int i,rc,nyear,imiss=MISSING_VALUE_INT,size,len;
   short smiss=MISSING_VALUE_SHORT;
-  double *lon=NULL,*lat=NULL;
+  double *lon=NULL,*lat=NULL,*lat_bnds,*lon_bnds;
   float miss=config->missing_value;
-  double *layer,*bnds;
+  double *layer,*bnds,*time_bnds=NULL;
   double *year=NULL;
-  int dim[4],bnds_var_id,bnds_dim_id;
+  int dim[4],bnds_var_id,bnds_dim_id,time_bnds_var_id,lon_bnds_var_id,lat_bnds_var_id;
   char **pftnames=NULL;
   size_t chunk[4];
   int dimids[2];
@@ -95,32 +95,18 @@ Bool create_pft_netcdf(Netcdf *cdf,
     }
     nyear=config->lastyear-config->outputyear+1;
   }
-  lon=newvec(double,array->nlon);
-  if(lon==NULL)
-  {
-    printallocerr("lon");
-    return TRUE;
-  }
-  lat=newvec(double,array->nlat);
-  if(lat==NULL)
-  {
-    free(lon);
-    printallocerr("lat");
+  if(setlatlon(&lat,&lon,&lat_bnds,&lon_bnds,array))
       return TRUE;
-  }
   if(n==1 && oneyear)
     year=NULL;
   else
   {
-    if(n==1)
-      year=newvec(double,nyear/timestep);
-    else
-      year=newvec(double,nyear*n);
-    if(year==NULL)
+    if(settimeaxis(&year,&time_bnds,nyear,n,timestep,config->outputyear,config->baseyear,oneyear,config->with_days,config->absyear,filename))
     {
-      free(lon);
       free(lat);
-      printallocerr("year");
+      free(lat_bnds);
+      free(lon);
+      free(lon_bnds);
       return TRUE;
     }
   }
@@ -131,7 +117,10 @@ Bool create_pft_netcdf(Netcdf *cdf,
     if(layer==NULL)
     {
       free(lon);
+      free(lon_bnds);
       free(lat);
+      free(lat_bnds);
+      free(time_bnds);
       free(year);
       printallocerr("layer");
       return TRUE;
@@ -140,8 +129,11 @@ Bool create_pft_netcdf(Netcdf *cdf,
     if(bnds==NULL)
     {
       free(lon);
+      free(lon_bnds);
       free(lat);
+      free(lat_bnds);
       free(year);
+      free(time_bnds);
       free(layer);
       printallocerr("bnds");
       return TRUE;
@@ -157,78 +149,18 @@ Bool create_pft_netcdf(Netcdf *cdf,
     }
   }
   else bnds=layer=NULL;
-  for(i=0;i<array->nlon;i++)
-    lon[i]=array->lon_min+i*config->resolution.lon;
-  if(config->rev_lat)
-    for(i=0;i<array->nlat;i++)
-      lat[i]=array->lat_min+(array->nlat-1-i)*config->resolution.lat;
-  else
-   for(i=0;i<array->nlat;i++)
-     lat[i]=array->lat_min+i*config->resolution.lat;
-  switch(n)
-  {
-    case 1:
-      if(year!=NULL)
-      {
-        if(config->absyear)
-          for(i=0;i<nyear/timestep;i++)
-            year[i]=config->outputyear+i*timestep+timestep/2;
-        else
-          for(i=0;i<nyear/timestep;i++)
-            year[i]=config->outputyear-config->baseyear+i*timestep+timestep/2;
-      }
-      break;
-    case 12:
-      if(config->with_days)
-      {
-        for(i=0;i<nyear;i++)
-          for(j=0;j<12;j++)
-            if(i==0 && j==0)
-            {
-              if(oneyear)
-                year[0]=ndaymonth[j]-1;
-              else
-                year[0]=ndaymonth[j]-1+(config->outputyear-config->baseyear)*NDAYYEAR;
-            }
-            else
-              year[i*12+j]=year[i*12+j-1]+ndaymonth[j];
-      }
-      else
-      {
-        if(oneyear)
-          for(i=0;i<12;i++)
-            year[i]=i;
-        else
-          for(i=0;i<nyear*12;i++)
-            year[i]=(config->outputyear-config->baseyear)*NMONTH+i;
-      }
-      break;
-    case NDAYYEAR:
-      if(oneyear)
-        for(i=0;i<n;i++)
-          year[i]=i;
-      else
-        for(i=0;i<nyear*n;i++)
-          year[i]=(config->outputyear-config->baseyear)*NDAYYEAR+i;
-      break;
-    default:
-      fprintf(stderr,"ERROR425: Invalid value=%d for number of data points per year in '%s'.\n",n,filename);
-      free(year);
-      free(lon);
-      free(lat);
-      free(layer);
-      free(bnds);
-      return TRUE;
-  }
   rc=nc_create(filename,(config->isnetcdf4) ? NC_CLOBBER|NC_NETCDF4 : NC_CLOBBER,&cdf->ncid);
   if(rc)
   {
     fprintf(stderr,"ERROR426: Cannot create file '%s': %s.\n",
             filename,nc_strerror(rc));
     free(lon);
+    free(lon_bnds);
     free(lat);
+    free(lat_bnds);
     free(year);
     free(layer);
+    free(time_bnds);
     free(bnds);
     return TRUE;
   }
@@ -269,6 +201,8 @@ Bool create_pft_netcdf(Netcdf *cdf,
     chunk[2]=array->nlat;
     chunk[3]=array->nlon;
   }
+  rc=nc_def_dim(cdf->ncid,BNDS_NAME,2,&bnds_dim_id);
+  error(rc);
   if(issoil(index))
   {
     rc=nc_def_var(cdf->ncid,DEPTH_NAME,NC_DOUBLE,1,&pft_dim_id,&pft_var_id);
@@ -279,16 +213,14 @@ Bool create_pft_netcdf(Netcdf *cdf,
     error(rc);
     rc=nc_put_att_text(cdf->ncid,pft_var_id,"long_name",strlen(DEPTH_LONG_NAME),DEPTH_LONG_NAME);
     error(rc);
-    rc=nc_put_att_text(cdf->ncid,pft_var_id,"bounds",strlen(BNDS_NAME),BNDS_NAME);
+    rc=nc_put_att_text(cdf->ncid,pft_var_id,"bounds",strlen(DEPTH_BNDS_NAME),DEPTH_BNDS_NAME);
     error(rc);
     rc=nc_put_att_text(cdf->ncid,pft_var_id,"positive",strlen("down"),"down");
     error(rc);
     rc=nc_put_att_text(cdf->ncid,pft_var_id,"axis",strlen("Z"),"Z");
-    rc=nc_def_dim(cdf->ncid,BNDS_NAME,2,&bnds_dim_id);
-    error(rc);
     dimids[0]=pft_dim_id;
     dimids[1]=bnds_dim_id;
-    rc=nc_def_var(cdf->ncid,BNDS_NAME,NC_DOUBLE,2,dimids,&bnds_var_id);
+    rc=nc_def_var(cdf->ncid,DEPTH_BNDS_NAME,NC_DOUBLE,2,dimids,&bnds_var_id);
     error(rc);
     rc=nc_put_att_text(cdf->ncid,bnds_var_id,"units",strlen("m"),"m");
     error(rc);
@@ -301,8 +233,11 @@ Bool create_pft_netcdf(Netcdf *cdf,
     if(pftnames==NULL)
     {
       free(lat);
+      free(lat_bnds);
       free(lon);
+      free(lon_bnds);
       free(year);
+      free(time_bnds);
       printallocerr("pftnames");
       return TRUE;
     }
@@ -329,15 +264,19 @@ Bool create_pft_netcdf(Netcdf *cdf,
   {
     rc=nc_def_var(cdf->ncid,TIME_NAME,NC_DOUBLE,1,&time_dim_id,&time_var_id);
     error(rc);
+    dimids[0]=time_dim_id;
+    dimids[1]=bnds_dim_id;
+    rc=nc_def_var(cdf->ncid,TIME_BNDS_NAME,NC_DOUBLE,2,dimids,&time_bnds_var_id);
+    error(rc);
     if(n==1)
     {
       if(config->absyear)
         s=strdup(YEARS_NAME);
       else
       {
-        len=snprintf(NULL,0,"years since %d-1-1 0:0:0",config->baseyear);
+        len=snprintf(NULL,0,"%s since %d-1-1 0:0:0",(config->with_days) ? "days" : "years",config->baseyear);
         s=malloc(len+1);
-        sprintf(s,"years since %d-1-1 0:0:0",config->baseyear);
+        sprintf(s,"%s since %d-1-1 0:0:0",(config->with_days) ? "days" : "years",config->baseyear);
       }
     }
     else if(n==12)
@@ -353,15 +292,20 @@ Bool create_pft_netcdf(Netcdf *cdf,
       sprintf(s,"days since %d-1-1 0:0:0",(oneyear) ? actualyear : config->baseyear);
     }
     rc=nc_put_att_text(cdf->ncid,time_var_id,"units",strlen(s),s);
+    rc=nc_put_att_text(cdf->ncid,time_bnds_var_id,"units",strlen(s),s);
     free(s);
     error(rc);
     rc=nc_put_att_text(cdf->ncid,time_var_id,"calendar",strlen(CALENDAR),
                        CALENDAR);
     error(rc);
+    rc=nc_put_att_text(cdf->ncid,time_bnds_var_id,"calendar",strlen(CALENDAR),
+                       CALENDAR);
     rc=nc_put_att_text(cdf->ncid, time_var_id,"standard_name",strlen(TIME_STANDARD_NAME),TIME_STANDARD_NAME);
     error(rc);
     rc=nc_put_att_text(cdf->ncid, time_var_id,"long_name",strlen(TIME_LONG_NAME),TIME_LONG_NAME);
     error(rc);
+    rc=nc_put_att_text(cdf->ncid, time_bnds_var_id,"long_name",strlen(TIME_BNDS_LONG_NAME),TIME_BNDS_LONG_NAME);
+    error(rc);
     rc=nc_put_att_text(cdf->ncid, time_var_id,"axis",strlen("T"),"T");
     error(rc);
   }
@@ -369,24 +313,51 @@ Bool create_pft_netcdf(Netcdf *cdf,
   error(rc); */
   rc=nc_def_var(cdf->ncid,LAT_NAME,NC_DOUBLE,1,&lat_dim_id,&lat_var_id);
   error(rc)
+  dimids[0]=lat_dim_id;
+  dimids[1]=bnds_dim_id;
+  rc=nc_def_var(cdf->ncid,LAT_BNDS_NAME,NC_DOUBLE,2,dimids,&lat_bnds_var_id);
+  error(rc);
   rc=nc_put_att_text(cdf->ncid,lat_var_id,"units",strlen("degrees_north"),
                      "degrees_north");
   error(rc);
+  rc=nc_put_att_text(cdf->ncid,lat_bnds_var_id,"units",strlen("degrees_north"),
+                     "degrees_north");
   rc=nc_put_att_text(cdf->ncid, lat_var_id,"long_name",strlen(LAT_LONG_NAME),LAT_LONG_NAME);
   error(rc);
+  if(strlen(LAT_BNDS_LONG_NAME))
+  {
+    rc=nc_put_att_text(cdf->ncid, lat_bnds_var_id,"long_name",strlen(LAT_BNDS_LONG_NAME),LAT_BNDS_LONG_NAME);
+    error(rc);
+  }
   rc=nc_put_att_text(cdf->ncid, lat_var_id,"standard_name",strlen(LAT_STANDARD_NAME),LAT_STANDARD_NAME);
   error(rc);
+  rc=nc_put_att_text(cdf->ncid, lat_var_id,"bounds",strlen(LAT_BNDS_NAME),LAT_BNDS_NAME);
+  error(rc);
   rc=nc_put_att_text(cdf->ncid, lat_var_id,"axis",strlen("Y"),"Y");
   error(rc);
   rc=nc_def_var(cdf->ncid,LON_NAME,NC_DOUBLE,1,&lon_dim_id,&lon_var_id);
   error(rc);
+  dimids[0]=lon_dim_id;
+  dimids[1]=bnds_dim_id;
+  rc=nc_def_var(cdf->ncid,LON_BNDS_NAME,NC_DOUBLE,2,dimids,&lon_bnds_var_id);
+  error(rc);
   rc=nc_put_att_text(cdf->ncid,lon_var_id,"units",strlen("degrees_east"),
                      "degrees_east");
   error(rc);
+  rc=nc_put_att_text(cdf->ncid,lon_bnds_var_id,"units",strlen("degrees_east"),
+                     "degrees_east");
+  error(rc);
   rc=nc_put_att_text(cdf->ncid, lon_var_id,"long_name",strlen(LON_LONG_NAME),LON_LONG_NAME);
   error(rc);
+  if(strlen(LON_BNDS_LONG_NAME))
+  {
+    rc=nc_put_att_text(cdf->ncid, lon_bnds_var_id,"long_name",strlen(LON_BNDS_LONG_NAME),LON_BNDS_LONG_NAME);
+    error(rc);
+  }
   rc=nc_put_att_text(cdf->ncid, lon_var_id,"standard_name",strlen(LON_STANDARD_NAME),LON_STANDARD_NAME);
   error(rc);
+ rc=nc_put_att_text(cdf->ncid, lon_var_id,"bounds",strlen(LON_BNDS_NAME),LON_BNDS_NAME);
+  error(rc);
   rc=nc_put_att_text(cdf->ncid, lon_var_id,"axis",strlen("X"),"X");
   error(rc);
   rc=nc_def_var(cdf->ncid,name,nctype[type],(year==NULL) ? 3 : 4,dim,&cdf->varid);
@@ -433,8 +404,11 @@ Bool create_pft_netcdf(Netcdf *cdf,
     default:
       fputs("ERROR428: Invalid data type in NetCDF file.\n",stderr);
       free(lat);
+      free(lat_bnds);
       free(lon);
+      free(lon_bnds);
       free(year);
+      free(time_bnds);
       free(layer);
       free(bnds);
       freepftnames(pftnames,index,npft,ncft,config);
@@ -444,8 +418,17 @@ Bool create_pft_netcdf(Netcdf *cdf,
   rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"title",
                      strlen(config->sim_name),config->sim_name);
   error(rc);
-  rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"source",strlen("LPJmL C Version " LPJ_VERSION),
-                     "LPJmL C Version " LPJ_VERSION);
+  len=snprintf(NULL,0,"LPJmL C Version %s",getversion());
+  s=malloc(len+1);
+  sprintf(s,"LPJmL C Version %s",getversion());
+  rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"source",strlen(s),s);
+  free(s);
+  error(rc);
+  rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"GIT_repo",
+                     strlen(getrepo()),getrepo());
+  error(rc);
+  rc=nc_put_att_text(cdf->ncid,NC_GLOBAL,"GIT_hash",
+                     strlen(gethash()),gethash());
   error(rc);
   time(&t);
   len=snprintf(NULL,0,"%s: %s",strdate(&t),config->arglist);
@@ -465,6 +448,8 @@ Bool create_pft_netcdf(Netcdf *cdf,
   {
     rc=nc_put_var_double(cdf->ncid,time_var_id,year);
     error(rc);
+    rc=nc_put_var_double(cdf->ncid,time_bnds_var_id,time_bnds);
+    error(rc);
   }
   if(issoil(index))
   {
@@ -497,12 +482,19 @@ Bool create_pft_netcdf(Netcdf *cdf,
   }
   rc=nc_put_var_double(cdf->ncid,lat_var_id,lat);
   error(rc);
+  rc=nc_put_var_double(cdf->ncid,lat_bnds_var_id,lat_bnds);
+  error(rc);
   rc=nc_put_var_double(cdf->ncid,lon_var_id,lon);
   error(rc);
+  rc=nc_put_var_double(cdf->ncid,lon_bnds_var_id,lon_bnds);
+  error(rc);
   free(layer);
   free(bnds);
+  free(time_bnds);
   free(lat);
+  free(lat_bnds);
   free(lon);
+  free(lon_bnds);
   free(year);
   return FALSE;
 #else
diff --git a/src/netcdf/createcoord.c b/src/netcdf/createcoord.c
index 069e47c14..81960736d 100644
--- a/src/netcdf/createcoord.c
+++ b/src/netcdf/createcoord.c
@@ -145,6 +145,9 @@ Coord_array *createcoord(Outputfile *output,
       }
       array->nlon=(int)((lon_max-array->lon_min)/config->resolution.lon+0.5)+1;
       array->nlat=(int)((lat_max-array->lat_min)/config->resolution.lat+0.5)+1;
+      array->lon_res=config->resolution.lon;
+      array->lat_res=config->resolution.lat;
+      array->rev_lat=config->rev_lat;
       if(config->rev_lat)
         for(cell=0;cell<config->total;cell++)
         {
diff --git a/src/netcdf/createcoord_all.c b/src/netcdf/createcoord_all.c
index 1b8db5c0e..9f7540f1e 100644
--- a/src/netcdf/createcoord_all.c
+++ b/src/netcdf/createcoord_all.c
@@ -150,6 +150,9 @@ Coord_array *createcoord_all(const Cell grid[],const Config *config)
       }
       array->nlon=(int)((lon_max-array->lon_min)/config->resolution.lon+0.5)+1;
       array->nlat=(int)((lat_max-array->lat_min)/config->resolution.lat+0.5)+1;
+      array->lon_res=config->resolution.lon;
+      array->lat_res=config->resolution.lat;
+      array->rev_lat=config->rev_lat;
       if(config->rev_lat)
         for(cell=0;cell<config->nall;cell++)
         {
diff --git a/src/netcdf/createindex.c b/src/netcdf/createindex.c
index 76fcf72a3..fabe2750e 100644
--- a/src/netcdf/createindex.c
+++ b/src/netcdf/createindex.c
@@ -34,6 +34,9 @@ Coord_array *createindex(const Coord *grid, /**< coordinate array of LPJ grid */
     free(array);
     return NULL;
   }
+  array->lon_res=resolution.lon;
+  array->lat_res=resolution.lat;
+  array->rev_lat=revlat;
   if(global)
   {
     array->lon_min=-180+0.5*resolution.lon;
diff --git a/src/netcdf/getlatlon_netcdf.c b/src/netcdf/getlatlon_netcdf.c
index 7dbdc823c..057dcadc2 100644
--- a/src/netcdf/getlatlon_netcdf.c
+++ b/src/netcdf/getlatlon_netcdf.c
@@ -50,13 +50,17 @@ Bool getlatlon_netcdf(Climatefile *file,    /**< Climate data */
   nc_inq_dimname(file->ncid,dimids[index],name);
   rc=nc_inq_varid(file->ncid,name,&var_id);
   if(rc)
+  {
+    rc=nc_inq_varid(file->ncid,LON_NAME,&var_id);
+    if(rc)
     {
       if(isroot(*config))
         fprintf(stderr,"ERROR410: Cannot read %s in '%s': %s.\n",
-              name,filename,nc_strerror(rc));
+                LON_NAME,filename,nc_strerror(rc));
       free(dimids);
       return TRUE;
     }
+  }
   nc_inq_varndims(file->ncid,var_id,&ndims);
   if(ndims!=1)
   {
@@ -105,13 +109,17 @@ Bool getlatlon_netcdf(Climatefile *file,    /**< Climate data */
   nc_inq_dimname(file->ncid,dimids[index-1],name);
   rc=nc_inq_varid(file->ncid,name,&var_id);
   if(rc)
+  {
+    rc=nc_inq_varid(file->ncid,LAT_NAME,&var_id);
+    if(rc)
     {
       if(isroot(*config))
         fprintf(stderr,"ERROR410: Cannot read %s in '%s': %s.\n",
-              name,filename,nc_strerror(rc));
+                LAT_NAME,filename,nc_strerror(rc));
       free(dimids);
       return TRUE;
     }
+  }
   nc_inq_varndims(file->ncid,var_id,&ndims);
   if(ndims!=1)
   {
diff --git a/src/netcdf/getvar_netcdf.c b/src/netcdf/getvar_netcdf.c
index 6944137a7..d28cdbe13 100644
--- a/src/netcdf/getvar_netcdf.c
+++ b/src/netcdf/getvar_netcdf.c
@@ -49,7 +49,7 @@ Bool getvar_netcdf(Climatefile *file,    /**< climate data file */
     for(i=0;i<nvars;i++)
     {
       nc_inq_varname(file->ncid,i,name);
-      if(strcmp(name,LON_NAME) && strcmp(name,LON_STANDARD_NAME) && strcmp(name,LAT_NAME) && strcmp(name,LAT_STANDARD_NAME) && strcmp(name,TIME_NAME) && strcmp(name,PFT_NAME) && strcmp(name,DEPTH_NAME) && strcmp(name,BNDS_NAME))
+      if(strcmp(name,LON_BNDS_NAME) && strcmp(name,LON_STANDARD_NAME) && strcmp(name,LAT_BNDS_NAME) && strcmp(name,LAT_STANDARD_NAME) && strcmp(name,TIME_NAME) && strcmp(name,PFT_NAME) && strcmp(name,DEPTH_NAME) && strcmp(name,DEPTH_BNDS_NAME) && strcmp(name,TIME_BNDS_NAME) && strcmp(name,BNDS_NAME))
       {
         nc_inq_varndims(file->ncid,i,&ndims);
         if(ndims>1)
diff --git a/src/netcdf/openclimate_netcdf.c b/src/netcdf/openclimate_netcdf.c
index 91b7bbfc5..8651840c7 100644
--- a/src/netcdf/openclimate_netcdf.c
+++ b/src/netcdf/openclimate_netcdf.c
@@ -192,27 +192,57 @@ Bool openclimate_netcdf(Climatefile *file,    /**< climate data file */
             file->delta_year=1;
         }
         else if(!strcmp(name,"days"))
+        {
+          if(time_len==1)
+          {
+            file->time_step=YEAR;
+            file->delta_year=1;
+          }
+          else
           {
             if(time[1]-time[0]==1)
+            {
               file->time_step=DAY;
-          else if(time[1]-time[0]==NDAYYEAR)
+              file->delta_year=1;
+            }
+            else if(time[1]-time[0]>=NDAYYEAR)
+            {
               file->time_step=YEAR;
+              file->delta_year=(time[1]-time[0])/NDAYYEAR;
+            }
             else
+            {
+              file->delta_year=1;
               file->time_step=MONTH;
+            }
+          }
           file->firstyear+=time[0]/NDAYYEAR;
         }
         else if(strstr(name,"months")!=NULL)
         {
           if(time_len==1)
+          {
             file->time_step=YEAR;
-          else
+            file->delta_year=1;
+          }
+          else if(time[1]-time[0]==1)
+          {
             file->time_step=MONTH;
-          file->firstyear+=time[0]/12;
+            file->delta_year=1;
+          }
+          else if((time[1]-time[0]) % NMONTH==0)
+          {
+            file->time_step=YEAR;
+            file->delta_year=(time[1]-time[0])/NMONTH;
+          }
+          file->firstyear+=time[0]/NMONTH;
         }
         else if(!strcmp(name,"hours"))
         {
+          file->delta_year=1;
           if(time_len==1)
             file->time_step=YEAR;
+          else
           {
             if(time_len>2)
               time_diff=time[2]-time[1];
@@ -220,7 +250,7 @@ Bool openclimate_netcdf(Climatefile *file,    /**< climate data file */
               time_diff=time[1]-time[0];
             if(time_diff<24)
             {
-              fprintf(stderr,"ERROR437: Sub-daily time step %dh not allowed '%s'.\n",
+              fprintf(stderr,"ERROR437: Sub-daily time step %dh not allowed in '%s'.\n",
                       time_diff,filename);
               free(name);
               free(time);
@@ -335,6 +365,7 @@ Bool openclimate_netcdf(Climatefile *file,    /**< climate data file */
     case MISSING_TIME:
       file->firstyear=0;
       file->nyear=1;
+      file->delta_year=1;
       file->n=config->ngridcell;
       break;
     case SECOND:
diff --git a/src/netcdf/setlatlon.c b/src/netcdf/setlatlon.c
new file mode 100644
index 000000000..7d1ba8ab6
--- /dev/null
+++ b/src/netcdf/setlatlon.c
@@ -0,0 +1,75 @@
+/**************************************************************************************/
+/**                                                                                \n**/
+/**                s  e  t  l  a  t  l  o  n  .  c                                 \n**/
+/**                                                                                \n**/
+/**     Function creates lat/lon vectors for NetCDF output                         \n**/
+/**                                                                                \n**/
+/** (C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file    \n**/
+/** authors, and contributors see AUTHORS file                                     \n**/
+/** This file is part of LPJmL and licensed under GNU AGPL Version 3               \n**/
+/** or later. See LICENSE file or go to http://www.gnu.org/licenses/               \n**/
+/** Contact: https://github.com/PIK-LPJmL/LPJmL                                    \n**/
+/**                                                                                \n**/
+/**************************************************************************************/
+
+#include "lpj.h"
+
+Bool setlatlon(double **lat,            /**< latitude array allocated and set */
+               double **lon,            /**< longitude array allocated and set */
+               double **lat_bnds,       /**< latitude boundary array allocated and set */
+               double **lon_bnds,       /**< longitude boundary array allocated and set */
+               const Coord_array *array /**< coordinate array of LPJ grid */
+              )                         /** \return TRUE on error */
+{
+  int i;
+  *lon=newvec(double,array->nlon);
+  if(*lon==NULL)
+  {
+    printallocerr("lon");
+    return TRUE;
+  }
+  *lon_bnds=newvec(double,2*array->nlon);
+  if(*lon_bnds==NULL)
+  {
+    printallocerr("lon_bnds");
+    free(*lon);
+    return TRUE;
+  }
+  *lat=newvec(double,array->nlat);
+  if(*lat==NULL)
+  {
+    printallocerr("lat");
+    free(*lon);
+    return TRUE;
+  }
+  *lat_bnds=newvec(double,2*array->nlat);
+  if(*lat_bnds==NULL)
+  {
+    printallocerr("lat_bnds");
+    free(*lon);
+    free(*lon_bnds);
+    free(*lat);
+    return TRUE;
+  }
+  for(i=0;i<array->nlon;i++)
+  {
+    (*lon)[i]=array->lon_min+i*array->lon_res;
+    (*lon_bnds)[2*i]=array->lon_min-array->lon_res*0.5+i*array->lon_res;
+    (*lon_bnds)[2*i+1]=array->lon_min+array->lon_res*0.5+i*array->lon_res;
+  }
+  if(array->rev_lat)
+    for(i=0;i<array->nlat;i++)
+    {
+      (*lat)[i]=array->lat_min+(array->nlat-1-i)*array->lat_res;
+      (*lat_bnds)[2*i]=array->lat_min+array->lat_res*0.5+(array->nlat-1-i)*array->lat_res;
+      (*lat_bnds)[2*i+1]=array->lat_min-array->lat_res*0.5+(array->nlat-1-i)*array->lat_res;
+    }
+  else
+    for(i=0;i<array->nlat;i++)
+    {
+      (*lat)[i]=array->lat_min+i*array->lat_res;
+      (*lat_bnds)[2*i]=array->lat_min-array->lat_res*0.5+i*array->lat_res;
+      (*lat_bnds)[2*i+1]=array->lat_min+array->lat_res*0.5+i*array->lat_res;
+    }
+  return FALSE;
+} /* of 'setlatlon' */
diff --git a/src/netcdf/settimeaxis.c b/src/netcdf/settimeaxis.c
new file mode 100644
index 000000000..a81720122
--- /dev/null
+++ b/src/netcdf/settimeaxis.c
@@ -0,0 +1,152 @@
+/**************************************************************************************/
+/**                                                                                \n**/
+/**                   s  e  t  t  i  m  e  a  x  i  s  .  c                        \n**/
+/**                                                                                \n**/
+/**     C implementation of LPJmL                                                  \n**/
+/**                                                                                \n**/
+/**     Function creates time and time boundary vectors for NetCDF files           \n**/
+/**                                                                                \n**/
+/** (C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file    \n**/
+/** authors, and contributors see AUTHORS file                                     \n**/
+/** This file is part of LPJmL and licensed under GNU AGPL Version 3               \n**/
+/** or later. See LICENSE file or go to http://www.gnu.org/licenses/               \n**/
+/** Contact: https://github.com/PIK-LPJmL/LPJmL                                    \n**/
+/**                                                                                \n**/
+/**************************************************************************************/
+
+#include "lpj.h"
+
+Bool settimeaxis(double **time,       /**< allocated and initialized time vector */
+                 double **time_bnds,  /**< allocated and initialized time bnd vector */
+                 int nyear,           /**< number of years */
+                 int nstep,           /**< number of samples per year (1/12/365) */
+                 int timestep,        /**< time step for annual output (yrs) */
+                 int outputyear,      /**< first year of output */
+                 int baseyear,        /**< base year of output */
+                 Bool oneyear,        /**< output is for one year only (TRUE/FALSE) */
+                 Bool with_days,      /**< time axis in units of days (TRUE/FALSE) */
+                 Bool absyear,        /**< absolute years instead of relative years (TRUE/FALSE) */
+                 const char *filename /**< filename of NetCDF file */
+                )                     /** \return TRUE on error */
+{
+  int i,j;
+  *time=*time_bnds=NULL;
+  if(nstep==1)
+  {
+    *time=newvec(double,nyear/timestep);
+    *time_bnds=newvec(double,(nyear/timestep)*2);
+  }
+  else
+  {
+    *time=newvec(double,nyear*nstep);
+    *time_bnds=newvec(double,nyear*nstep*2);
+  }
+  if(*time==NULL || *time_bnds==NULL)
+  {
+    free(*time);
+    free(*time_bnds);
+    printallocerr("time");
+    return TRUE;
+  }
+  switch(nstep)
+  {
+    case 0:
+      break;
+    case 1:
+      if(with_days)
+      {
+        for(i=0;i<nyear/timestep;i++)
+        {
+          (*time)[i]=(outputyear-baseyear+i*timestep)*NDAYYEAR+timestep*NDAYYEAR/2;
+          (*time_bnds)[2*i]=(outputyear-baseyear+i*timestep)*NDAYYEAR;
+          (*time_bnds)[2*i+1]=(outputyear-baseyear+(i+1)*timestep)*NDAYYEAR;
+        }
+      }
+      else
+      {
+        if(absyear)
+          for(i=0;i<nyear/timestep;i++)
+          {
+            (*time)[i]=outputyear+i*timestep+timestep*0.5;
+            (*time_bnds)[2*i]=outputyear+i*timestep;
+            (*time_bnds)[2*i+1]=outputyear+(i+1)*timestep;
+          }
+        else
+          for(i=0;i<nyear/timestep;i++)
+          {
+            (*time)[i]=outputyear-baseyear+i*timestep+timestep*0.5;
+            (*time_bnds)[2*i]=outputyear-baseyear+i*timestep;
+            (*time_bnds)[2*i+1]=outputyear-baseyear+(i+1)*timestep;
+          }
+      }
+      break;
+    case NMONTH:
+      if(with_days)
+      {
+        for(i=0;i<nyear;i++)
+          for(j=0;j<NMONTH;j++)
+            if(i==0 && j==0)
+            {
+              if(oneyear)
+              {
+                (*time)[0]=15;
+                (*time_bnds)[0]=0;
+                (*time_bnds)[1]=ndaymonth[0];
+              }
+              else
+              {
+                (*time)[0]=15+(outputyear-baseyear)*NDAYYEAR;
+                (*time_bnds)[0]=(outputyear-baseyear)*NDAYYEAR;
+                (*time_bnds)[1]=ndaymonth[j]+(outputyear-baseyear)*NDAYYEAR;
+              }
+            }
+            else
+            {
+              (*time)[i*NMONTH+j]=(*time)[i*NMONTH+j-1]+ndaymonth[(j==0) ? 11 : j-1];
+              (*time_bnds)[2*(i*NMONTH+j)]=(*time_bnds)[2*(i*NMONTH+j)-1];
+              (*time_bnds)[2*(i*NMONTH+j)+1]=(*time_bnds)[2*(i*NMONTH+j)]+ndaymonth[j];
+            }
+      }
+      else
+      {
+        if(oneyear)
+          for(i=0;i<NMONTH;i++)
+          {
+            (*time)[i]=i+0.5;
+            (*time_bnds)[2*i]=i;
+            (*time_bnds)[2*i+1]=i+1;
+          }
+        else
+          for(i=0;i<nyear*NMONTH;i++)
+          {
+            (*time)[i]=(*time_bnds)[2*i]=(outputyear-baseyear)*NMONTH+i+0.5;
+            (*time_bnds)[2*i]=(outputyear-baseyear)*NMONTH+i;
+            (*time_bnds)[2*i+1]=(outputyear-baseyear)*NMONTH+i+1;
+          }
+      }
+      break;
+    case NDAYYEAR:
+      if(oneyear)
+        for(i=0;i<nstep;i++)
+        {
+          (*time)[i]=i+0.5;
+          (*time_bnds)[2*i]=i;
+          (*time_bnds)[2*i+1]=i+1;
+        }
+      else
+        for(i=0;i<nyear*nstep;i++)
+        {
+          (*time)[i]=(outputyear-baseyear)*NDAYYEAR+i+0.5;
+          (*time_bnds)[2*i]=(outputyear-baseyear)*NDAYYEAR+i;
+          (*time_bnds)[2*i+1]=(outputyear-baseyear)*NDAYYEAR+i+1;
+        }
+      break;
+    default:
+      fprintf(stderr,"ERROR425: Invalid value=%d for number of data points per year in '%s', must be 1, 12, or 365.\n",
+              nstep,filename);
+      free(*time);
+      free(*time_bnds);
+      return TRUE;
+  } /* of switch(nstep) */
+  return FALSE;
+} /* of 'settimeaxis' */
diff --git a/src/reservoir/landusechange_for_reservoir.c b/src/reservoir/landusechange_for_reservoir.c
index 24b778c8e..7063769af 100644
--- a/src/reservoir/landusechange_for_reservoir.c
+++ b/src/reservoir/landusechange_for_reservoir.c
@@ -223,8 +223,10 @@ void landusechange_for_reservoir(Cell *cell,          /**< pointer to cell */
   Real sum[2],sum_wl;
   Real minnatfrac_res;
   int s,p;
+#ifndef IMAGE
   Real totw_before,totw_after,balanceW;
   Stocks tot_before={0,0},tot_after={0,0},balance,stocks; /* to check the water and c balance in the cells */
+#endif
   Irrigation *data;
 #if defined IMAGE && defined COUPLED
   minnatfrac_res=0.0002;
@@ -250,7 +252,6 @@ void landusechange_for_reservoir(Cell *cell,          /**< pointer to cell */
     totw_before+=(cell->discharge.dmass_lake)/cell->coord.area;
     totw_before+=cell->ml.resdata->dmass/cell->coord.area;
     totw_before+=cell->ml.resdata->dfout_irrigation/cell->coord.area;
-#endif
     /* carbon */
     foreachstand(stand,s,cell->standlist)
     {
@@ -266,6 +267,7 @@ void landusechange_for_reservoir(Cell *cell,          /**< pointer to cell */
     tot_before.nitrogen+=cell->balance.deforest_emissions.nitrogen;
     tot_before.carbon-=cell->balance.flux_estab.carbon;
     tot_before.nitrogen-=cell->balance.flux_estab.nitrogen;
+#endif
     /* cut cut entire natural stand if lakefraction+reservoir fraction equals 1 */
     if(difffrac>=1-cell->lakefrac-minnatfrac_res)
       minnatfrac_res=0.0;
@@ -409,7 +411,7 @@ void landusechange_for_reservoir(Cell *cell,          /**< pointer to cell */
            balance.carbon);
 #endif
     /* check if total fractions add up to 1 again */
-    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+    check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
   }
 } /* end of function */
diff --git a/src/soil/apply_heatconduction_of_a_day.c b/src/soil/apply_heatconduction_of_a_day.c
index 085decb75..1bb86a459 100644
--- a/src/soil/apply_heatconduction_of_a_day.c
+++ b/src/soil/apply_heatconduction_of_a_day.c
@@ -252,26 +252,26 @@ STATIC void timestep_implicit(Real * temp,
                              )
 {
   Real sub[NHEATGRIDP];  /* sub diagonal elements */
-  Real main[NHEATGRIDP]; /* main diagonal elements */
+  Real maind[NHEATGRIDP]; /* main diagonal elements */
   Real sup[NHEATGRIDP];  /* super diagonal elements */
 
   /* --- arrange matrix --- */
-  arrange_matrix(sub, main, sup, h, hcap, lam, dt);
+  arrange_matrix(sub, maind, sup, h, hcap, lam, dt);
 
   /* --- compute right-hand side ---  */
   /* See supplement of master thesis equation (6) */
   Real rhs[NHEATGRIDP];
   int j;
   /* matrix vector product Y * temp */
-  rhs[0] =  temp[1] * (2-main[0]) - temp[2] * sup[0];
+  rhs[0] =  temp[1] * (2-maind[0]) - temp[2] * sup[0];
   for (j=1; j<(NHEATGRIDP-1); ++j)
-    rhs[j] = temp[j+1] * (2-main[j]) - temp[j] * sub[j] - temp[j+2] * sup[j]; // equation (10-12)
-  rhs[NHEATGRIDP-1] = temp[NHEATGRIDP] * (2-main[NHEATGRIDP-1]) - temp[NHEATGRIDP-1] * sub[NHEATGRIDP-1];
+    rhs[j] = temp[j+1] * (2-maind[j]) - temp[j] * sub[j] - temp[j+2] * sup[j]; // equation (10-12)
+  rhs[NHEATGRIDP-1] = temp[NHEATGRIDP] * (2-maind[NHEATGRIDP-1]) - temp[NHEATGRIDP-1] * sub[NHEATGRIDP-1];
   /* add vector L */
   rhs[0] -= 2 * temp[0] * sub[0];
 
   /* --- solve tridiagonal system with the thomas algorithm --- */
-  thomas_algorithm(sub, main, sup, rhs, &temp[1]);
+  thomas_algorithm(sub, maind, sup, rhs, &temp[1]);
 } /* of 'timestep_implicit' */
 
 /* This function arranges the matrix for the implicit timestep.
diff --git a/src/soil/fprinthydropar.c b/src/soil/fprinthydropar.c
index 223b188e5..553425ee5 100644
--- a/src/soil/fprinthydropar.c
+++ b/src/soil/fprinthydropar.c
@@ -16,7 +16,8 @@
 
 #include "lpj.h"
 
-void fprinthydropar(FILE *file  /* pointer to text file */
+void fprinthydropar(FILE *file,              /**< pointer to text file */
+                    const Hydropar *hydropar /**< hydrological parameter */
                    )
 {
   fprintf(file, "wland_min:\t%g\n"
@@ -24,6 +25,6 @@ void fprinthydropar(FILE *file  /* pointer to text file */
           "lat_min:\t%g\n"
           "wtab_thres:\t%g\n"
           "cti_thres:\t%g\n",
-          hydropar.wland_min, hydropar.cti_max, hydropar.lat_min,
-          hydropar.wtab_thres, hydropar.cti_thres);
+          hydropar->wland_min, hydropar->cti_max, hydropar->lat_min,
+          hydropar->wtab_thres, hydropar->cti_thres);
 } /* of 'fprinthydropar' */
diff --git a/src/soil/fprinthydrotope.c b/src/soil/fprinthydrotope.c
index 6fc2cd7bf..13b1ef221 100644
--- a/src/soil/fprinthydrotope.c
+++ b/src/soil/fprinthydrotope.c
@@ -18,13 +18,6 @@
 
 void fprinthydrotope(FILE *file,const  Hydrotope *hydrotopes)
 {
-  fprintf(file, "cti_mean:\t%g\n", hydrotopes->cti_mean);
-  fprintf(file, "cti_chi:\t%g\n", hydrotopes->cti_chi);
-  fprintf(file, "cti_phi:\t%g\n", hydrotopes->cti_phi);
-  fprintf(file, "cti_mu:\t\t%g\n", hydrotopes->cti_mu);
-
-  fprintf(file, "skip_cell:\t%s\n", bool2str(hydrotopes->skip_cell));
-
   fprintf(file, "wtable_mean:\t%g\n", hydrotopes->wtable_mean);
   fprintf(file, "wtable_min:\t%g\n", hydrotopes->wtable_min);
   fprintf(file, "wtable_max:\t%g\n", hydrotopes->wtable_max);
diff --git a/src/soil/freadhydrotope.c b/src/soil/freadhydrotope.c
index 80a319e2f..8c0dcb4d2 100644
--- a/src/soil/freadhydrotope.c
+++ b/src/soil/freadhydrotope.c
@@ -18,12 +18,6 @@
 
 Bool freadhydrotope(FILE *file, Hydrotope *hydrotopes, Bool swap)
 {
-  freadreal(&hydrotopes->cti_mean, 1, swap, file);
-  freadreal(&hydrotopes->cti_chi, 1, swap, file);
-  freadreal(&hydrotopes->cti_phi, 1, swap, file);
-  freadreal(&hydrotopes->cti_mu, 1, swap, file);
-
-  freadint(&hydrotopes->skip_cell, 1, swap, file);
 
   freadreal(&hydrotopes->wtable_mean, 1, swap, file);
   freadreal(&hydrotopes->wtable_min, 1, swap, file);
diff --git a/src/soil/fscanhydropar.c b/src/soil/fscanhydropar.c
index 6751cbae2..49439836b 100644
--- a/src/soil/fscanhydropar.c
+++ b/src/soil/fscanhydropar.c
@@ -20,9 +20,8 @@
 #define fscanhydroreal(isout,file,var,name) \
   if(fscanreal(file,var,name,FALSE,isout)) return TRUE;
 
-Hydropar hydropar;
-
 Bool fscanhydropar(LPJfile *file,      /**< file pointer */
+                   Hydropar *hydropar, /**< hydrologic parameter read */
                    Verbosity verb      /**< generate error output */
                   )                    /**< returns TRUE on error */
 {
@@ -30,10 +29,10 @@ Bool fscanhydropar(LPJfile *file,  /**< file  pointer */
   f=fscanstruct(file,"hydropar",verb);
   if(f==NULL)
     return TRUE;
-  fscanhydroreal(verb,f,&hydropar.wland_min,"wland_min");
-  fscanhydroreal(verb,f,&hydropar.cti_max,"cti_max");
-  fscanhydroreal(verb,f,&hydropar.lat_min,"lat_min");
-  fscanhydroreal(verb,f,&hydropar.wtab_thres,"wtab_thres");
-  fscanhydroreal(verb,f,&hydropar.cti_thres,"cti_thres");
+  fscanhydroreal(verb,f,&hydropar->wland_min,"wland_min");
+  fscanhydroreal(verb,f,&hydropar->cti_max,"cti_max");
+  fscanhydroreal(verb,f,&hydropar->lat_min,"lat_min");
+  fscanhydroreal(verb,f,&hydropar->wtab_thres,"wtab_thres");
+  fscanhydroreal(verb,f,&hydropar->cti_thres,"cti_thres");
   return FALSE;
 } /* of 'fscanhydropar' */
diff --git a/src/soil/fwritehydrotope.c b/src/soil/fwritehydrotope.c
index 200a04030..12a6ebf86 100644
--- a/src/soil/fwritehydrotope.c
+++ b/src/soil/fwritehydrotope.c
@@ -18,13 +18,6 @@
 
 Bool fwritehydrotope(FILE *file,const  Hydrotope *hydrotopes)
 {
-  fwrite(&hydrotopes->cti_mean, sizeof(Real), 1, file);
-  fwrite(&hydrotopes->cti_chi, sizeof(Real), 1, file);
-  fwrite(&hydrotopes->cti_phi, sizeof(Real), 1, file);
-  fwrite(&hydrotopes->cti_mu, sizeof(Real), 1, file);
-
-  fwrite(&hydrotopes->skip_cell, sizeof(Bool), 1, file);
-
   fwrite(&hydrotopes->wtable_mean, sizeof(Real), 1, file);
   fwrite(&hydrotopes->wtable_min, sizeof(Real), 1, file);
   fwrite(&hydrotopes->wtable_max, sizeof(Real), 1, file);
diff --git a/src/soil/infil_perc.c b/src/soil/infil_perc.c
index 2555032e6..7a0473d2f 100644
--- a/src/soil/infil_perc.c
+++ b/src/soil/infil_perc.c
@@ -84,7 +84,7 @@ Real infil_perc(Stand *stand,        /**< Stand pointer */
   Real rsub_top_tot, rsub_top_layer, active_wa, tmp_water;
   //Real sat_lev = 0.9;
   Real prec=infil;
-  Bool isrice=FALSE;
+  Bool isrice;
   Bool enth=TRUE;
   Real dprec=dprec1;
   Real vol_water_enth=0; /* volumetric enthalpy of inflowing or outflowing water J/m^3 */
@@ -114,10 +114,7 @@ Real infil_perc(Stand *stand,        /**< Stand pointer */
           sprintcoord(line,&stand->cell->coord),l,soil->w[l],soil->w_fw[l],stand->type->name,soil->par->name, stand->cell->lateral_water);
     }
 #endif
-
-  foreachpft(pft,p,&stand->pftlist)
-    if(!strcmp(pft->par->name,"rice"))
-      isrice=TRUE;
+  isrice=ispftinstand(&stand->pftlist,config->rice_pft);
   if(stand->type->landusetype==AGRICULTURE || stand->type->landusetype==SETASIDE_RF || stand->type->landusetype==SETASIDE_IR || stand->type->landusetype==SETASIDE_WETLAND || stand->type->landusetype==BIOMASS_GRASS ||
       stand->type->landusetype==BIOMASS_TREE || stand->type->landusetype==GRASSLAND || stand->type->landusetype==OTHERS  ||  stand->type->landusetype==AGRICULTURE_TREE || stand->type->landusetype==AGRICULTURE_GRASS)
     data_irrig=stand->data;
diff --git a/src/soil/inithydro.c b/src/soil/inithydro.c
index 64897b841..685faa6dc 100644
--- a/src/soil/inithydro.c
+++ b/src/soil/inithydro.c
@@ -68,10 +68,10 @@ Bool inithydro(Cell *grid,    /**< LPJ grid */
       return TRUE;
     }
     grid[cell].hydrotopes.skip_cell = TRUE;
-    if (grid[cell].coord.lat > hydropar.lat_min)
+    if (grid[cell].coord.lat > config->hydropar.lat_min)
     {
       grid[cell].hydrotopes.cti_mean = (float)ctidata_in[0] / header.scalar;
-      if (grid[cell].hydrotopes.cti_mean > hydropar.cti_thres)
+      if (grid[cell].hydrotopes.cti_mean > config->hydropar.cti_thres)
       {
         grid[cell].hydrotopes.cti_chi = ((float)ctidata_in[1] / header.scalar*(float)ctidata_in[2] / header.scalar) / 2;
         if (grid[cell].hydrotopes.cti_chi > 0.)
diff --git a/src/soil/update_wetland.c b/src/soil/update_wetland.c
index 97883392f..3f274ac10 100644
--- a/src/soil/update_wetland.c
+++ b/src/soil/update_wetland.c
@@ -22,6 +22,7 @@
 
 void update_wetland(Cell *cell,          /**< pointer to cell */
                     int ntotpft,         /**< total number of PFTs */
+                    int ncft,            /**< number of crop PFTs */
                     int year,            /**< simulation year */
                     const Config *config /**< LPJmL configuration */
 )
@@ -106,7 +107,7 @@ void update_wetland(Cell *cell,          /**< pointer to cell */
     // -----------------------------------------------------------------------------------------------
     //  determine wetland area
     //  min / max cti values
-    cti_min = natstand->soil.par->efold*(hydropar.wland_min - wtable_use) + cell->hydrotopes.cti_mean;   //Gleichung 10 Kleinen etal 2013
+    cti_min = natstand->soil.par->efold*(config->hydropar.wland_min - wtable_use) + cell->hydrotopes.cti_mean;   //Gleichung 10 Kleinen etal 2013
     cti_max = natstand->soil.par->ctimax;
     //cti_min_max = natstand->soil.par->efold*(hydropar.wland_min - cell->hydrotopes.wtable_max) + cell->hydrotopes.cti_mean; /*maximum should be cell->hydrotopes.wetland_wtable_max*/
 
@@ -379,7 +380,7 @@ void update_wetland(Cell *cell,          /**< pointer to cell */
           fail(INVALID_WATER_BALANCE_ERR,FAIL_ON_BALANCE,FALSE, "1 Invalid water balance in %s: %g start:%g  end:%g excess_water:%g\n",
                __FUNCTION__, water_before - water_after, water_before, water_after,cell->balance.excess_water);
 #endif
-        check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+        check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
       }
       // -----------------------------------------------------------------------------------------------
@@ -659,7 +660,7 @@ void update_wetland(Cell *cell,          /**< pointer to cell */
   }
 #endif
 
-  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac);
+  check_stand_fracs(cell,cell->lakefrac+cell->ml.reservoirfrac,ncft);
 
 
 #ifdef CHECK_BALANCE
diff --git a/src/tools/Makefile b/src/tools/Makefile
index 87e07227f..07e56429f 100644
--- a/src/tools/Makefile
+++ b/src/tools/Makefile
@@ -15,6 +15,8 @@
 
 include ../../Makefile.inc
 
+VERSION = $(shell cat ../../VERSION)
+
 OBJS    = swap.$O freadheader.$O coord.$O openinputfile.$O\
           fscanreal.$O fail.$O list.$O headersize.$O\
           bigendian.$O fprintheader.$O sysname.$O queue.$O\
@@ -36,7 +38,7 @@ OBJS    = swap.$O freadheader.$O coord.$O openinputfile.$O\
           getfilefrommeta.$O isint.$O parse_json.$O closeconfig.$O isdir.$O\
           fscanmap.$O fprintjson.$O mrun.$O fscanintarray.$O cmpmap.$O\
           hasanysuffix.$O fprintattrs.$O fscanattrs.$O mergeattrs.$O\
-          freadheaderid.$O newarray.$O
+          freadheaderid.$O newarray.$O getversion.$O
 
 INC     = ../../include
 LIBDIR  = ../../lib
@@ -59,6 +61,9 @@ $(OBJS): $(HDRS)
 printflags.$O: printflags.c
 	$(CC) $(CFLAGS) -DCFLAGS='"$(CFLAGS)"' -I$(INC) -c $*.c
 
+getversion.$O: getversion.c ../../VERSION
+	$(CC) $(CFLAGS) -DLPJ_VERSION=\"$(VERSION)\" -I$(INC) -c $*.c
+
 .c.$O: 
 	$(CC) $(CFLAGS) -I$(INC) $(JSON_INC) -c $*.c
 
diff --git a/src/tools/getversion.c b/src/tools/getversion.c
new file mode 100644
index 000000000..3299b95af
--- /dev/null
+++ b/src/tools/getversion.c
@@ -0,0 +1,24 @@
+/**************************************************************************************/
+/**                                                                                \n**/
+/**                       g  e  t  v  e  r  s  i  o  n  .  c                       \n**/
+/**                                                                                \n**/
+/**     Function gets LPJmL version  as string                                     \n**/
+/**                                                                                \n**/
+/** (C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file    \n**/
+/** authors, and contributors see AUTHORS file                                     \n**/
+/** This file is part of LPJmL and licensed under GNU AGPL Version 3               \n**/
+/** or later. See LICENSE file or go to http://www.gnu.org/licenses/               \n**/
+/** Contact: https://github.com/PIK-LPJmL/LPJmL                                    \n**/
+/**                                                                                \n**/
+/**************************************************************************************/
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include "types.h"
+
+char *getversion(void)
+{
+  static char *s=LPJ_VERSION;
+  return s;
+} /* of 'getversion' */
diff --git a/src/tools/printflags.c b/src/tools/printflags.c
index 69372c119..49dc2b942 100644
--- a/src/tools/printflags.c
+++ b/src/tools/printflags.c
@@ -22,8 +22,10 @@
 void printflags(const char *progname /**< program name */
                )
 {
-  printf("%s C Version " LPJ_VERSION " (%s)\n",progname,
+  printf("%s C Version %s (%s)\n",progname,getversion(),
                getbuilddate());
+  printf("GIT repository:   %s\n",getrepo());
+  printf("GIT hash:         %s\n",gethash());
   printf("Operating system: %s, %s endian\n",sysname(),
          (bigendian()) ? "big" : "little");
   printf("Compiler:         ");
diff --git a/src/utils/asc2clm.c b/src/utils/asc2clm.c
index 75ca94855..60d985ab6 100644
--- a/src/utils/asc2clm.c
+++ b/src/utils/asc2clm.c
@@ -69,7 +69,7 @@ int main(int argc,char **argv)
       {
         printf("   asc2clm (" __DATE__ ") help\n"
                "   ==========================\n\n"
-               "Convert gridded ASCII files to clm data files for LPJmL version " LPJ_VERSION "\n\n"
+               "Convert gridded ASCII files to clm data files for LPJmL version %s\n\n"
                USAGE
                "\nArguments:\n"
                "-h,--help    print this help text\n"
@@ -86,7 +86,7 @@ int main(int argc,char **argv)
                "infile       filename(s) of gridded data file\n"
                "clmfile      filename of clm data file\n\n"
                 "(C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file\n",
-                FIRSTYEAR,LPJ_CLIMATE_VERSION);
+                getversion(),FIRSTYEAR,LPJ_CLIMATE_VERSION);
         return EXIT_SUCCESS;
       }
       else if(!strcmp(argv[i],"-firstyear"))
diff --git a/src/utils/bin2cdf.c b/src/utils/bin2cdf.c
index e90621d3f..d2efe6e44 100644
--- a/src/utils/bin2cdf.c
+++ b/src/utils/bin2cdf.c
@@ -18,9 +18,10 @@
 #include <netcdf.h>
 #include <time.h>
 
-#define error(rc) if(rc) {free(lon);free(lat);free(year);fprintf(stderr,"ERROR427: Cannot write '%s': %s.\n",filename,nc_strerror(rc)); nc_close(cdf->ncid); free(cdf);return NULL;}
+#define error(rc) if(rc) {free(lon);free(lon_bnds);free(lat);free(lat_bnds);free(year);free(time_bnds);fprintf(stderr,"ERROR427: Cannot write '%s': %s.\n",filename,nc_strerror(rc)); nc_close(cdf->ncid); free(cdf);return NULL;}
+#define checkptr(ptr) if(ptr==NULL) { printallocerr(#ptr); free(lon);free(lon_bnds);free(lat);free(lat_bnds);free(year);free(time_bnds); free(layer); free(midlayer); free(bnds); nc_close(cdf->ncid); free(cdf);return NULL;}
 
-#define USAGE "Usage: %s [-h] [-v] [-clm] [-floatgrid] [-doublegrid] [-revlat] [-days]\n       [-absyear] [-firstyear y] [-baseyear y] [-nbands n] [-nstep n]\n       [-cellsize size] [-swap] [[-attr name=value]..] [-global] [-short]\n       [-compress level] [-units u] [-descr d] [-missing_value val] [-metafile]\n       [-map name] [-netcdf4] [varname gridfile] binfile netcdffile\n"
+#define USAGE "Usage: %s [-h] [-v] [-clm] [-floatgrid] [-doublegrid] [-revlat] [-days]\n       [-absyear] [-firstyear y] [-baseyear y] [-nbands n] [-nstep n]\n       [-cellsize size] [-swap] [[-attr name=value]..] [-global] [-short]\n       [-compress level] [-units u] [-descr d] [-missing_value val] [-scale s] [-metafile] [-notime] \n       [-map name] [-netcdf4] [varname gridfile] binfile netcdffile\n"
 
 typedef struct
 {
@@ -49,93 +50,46 @@ static Cdf *create_cdf(const char *filename,
                        Bool ispft,
                        int compress,
                        const Coord_array *array,
-                       Bool revlat,
                        Bool with_days,
                        Bool absyear,
+                       Bool notime,
                        Bool isnetcdf4)
 {
   Cdf *cdf;
-  double *lon,*lat;
-  double *layer=NULL,*bnds=NULL,*midlayer=NULL;
-  double *year;
-  int i,j,rc,dim[4],dim2[2],dimids[2];
+  double *lon,*lat,*lon_bnds,*lat_bnds;
+  double *layer=NULL,*bnds=NULL,*midlayer=NULL,*time_bnds=NULL;
+  double *year=NULL;
+  int i,rc,dim[4],dim2[2],dimids[2],start;
   size_t chunk[4],offset[2],count[2];
   char *s;
   const char *ptr;
   time_t t;
   int time_var_id,lat_var_id,lon_var_id,time_dim_id,lat_dim_id,lon_dim_id,map_dim_id,len_dim_id,bnds_var_id,bnds_dim_id;
+  int time_bnds_var_id;
+  int lon_bnds_var_id,lat_bnds_var_id;
   int pft_dim_id,varid;
   int len;
   cdf=new(Cdf);
-  lon=newvec(double,array->nlon);
-  if(lon==NULL)
+  /* set lon/lat vectors */
+  if(setlatlon(&lat,&lon,&lat_bnds,&lon_bnds,array))
   {
-    printallocerr("lon");
     free(cdf);
     return NULL;
   }
-  lat=newvec(double,array->nlat);
-  if(lat==NULL)
+  if(!notime)
   {
-    printallocerr("lat");
-    free(lon);
-    free(cdf);
-    return NULL;
-  }
-  for(i=0;i<array->nlon;i++)
-    lon[i]=array->lon_min+i*header.cellsize_lon;
-  if(revlat)
-    for(i=0;i<array->nlat;i++)
-      lat[i]=array->lat_min+(array->nlat-1-i)*header.cellsize_lat;
-  else
-    for(i=0;i<array->nlat;i++)
-      lat[i]=array->lat_min+i*header.cellsize_lat;
-  year=newvec(double,header.nyear*header.nstep);
-  if(year==NULL)
+    /* set time vectors */
+    if(settimeaxis(&year,&time_bnds,header.nyear,header.nstep,header.timestep,
+                   header.firstyear,baseyear,FALSE,with_days,absyear,filename))
     {
-    printallocerr("year");
-    free(lon);
       free(lat);
-    free(cdf);
-    return NULL;
-  }
-  switch(header.nstep)
-  {
-    case 1:
-      if(absyear)
-        for(i=0;i<header.nyear;i++)
-          year[i]=header.firstyear+i*header.timestep+header.timestep/2;
-        else
-        for(i=0;i<header.nyear;i++)
-          year[i]=header.firstyear-baseyear+i*header.timestep+header.timestep/2;
-      break;
-    case 12:
-      if(with_days)
-      {
-        for(i=0;i<header.nyear;i++)
-          for(j=0;j<12;j++)
-            if(i==0 && j==0)
-              year[0]=ndaymonth[j]-1+(header.firstyear-baseyear)*NDAYYEAR;
-            else
-              year[i*12+j]=year[i*12+j-1]+ndaymonth[j];
-      }
-      else
-        for(i=0;i<header.nyear*12;i++)
-           year[i]=i+(header.firstyear-baseyear)*12;
-      break;
-    case NDAYYEAR:
-      for(i=0;i<header.nyear*NDAYYEAR;i++)
-        year[i]=i+(header.firstyear-baseyear)*NDAYYEAR;
-      break;
-    default:
-      fprintf(stderr,"ERROR425: Invalid value=%d for number of data points per year, must be 1, 12 or 365.\n",
-              header.nstep);
-      free(year);
+      free(lat_bnds);
       free(lon);
-      free(lat);
+      free(lon_bnds);
       free(cdf);
       return NULL;
     }
+  }
   cdf->index=array;
   rc=nc_create(filename,(isnetcdf4) ? NC_CLOBBER|NC_NETCDF4 : NC_CLOBBER,&cdf->ncid);
   if(rc)
@@ -143,15 +97,27 @@ static Cdf *create_cdf(const char *filename,
     fprintf(stderr,"ERROR426: Cannot create file '%s': %s.\n",
             filename,nc_strerror(rc));
     free(year);
+    free(time_bnds);
     free(lon);
     free(lat);
+    free(lon_bnds);
+    free(lat_bnds);
     free(cdf);
     return NULL;
   }
+  rc=nc_def_dim(cdf->ncid,BNDS_NAME,2,&bnds_dim_id);
+  error(rc);
+  if(!notime)
+  {
     rc=nc_def_dim(cdf->ncid,TIME_DIM_NAME,header.nyear*header.nstep,&time_dim_id);
     error(rc);
+    dimids[0]=time_dim_id;
+    dimids[1]=bnds_dim_id;
+    rc=nc_def_var(cdf->ncid,TIME_BNDS_NAME,NC_DOUBLE,2,dimids,&time_bnds_var_id);
+    error(rc);
     rc=nc_def_var(cdf->ncid,TIME_NAME,NC_DOUBLE,1,&time_dim_id,&time_var_id);
     error(rc);
+  }
   rc=nc_def_dim(cdf->ncid,LAT_DIM_NAME,array->nlat,&lat_dim_id);
   error(rc);
   rc=nc_def_dim(cdf->ncid,LON_DIM_NAME,array->nlon,&lon_dim_id);
@@ -183,9 +149,28 @@ static Cdf *create_cdf(const char *filename,
   }
   rc=nc_def_var(cdf->ncid,LAT_NAME,NC_DOUBLE,1,&lat_dim_id,&lat_var_id);
   error(rc);
+  dimids[0]=lat_dim_id;
+  dimids[1]=bnds_dim_id;
+  rc=nc_def_var(cdf->ncid,LAT_BNDS_NAME,NC_DOUBLE,2,dimids,&lat_bnds_var_id);
+  error(rc);
   rc=nc_def_var(cdf->ncid,LON_NAME,NC_DOUBLE,1,&lon_dim_id,&lon_var_id);
   error(rc);
-  if(header.nstep==1)
+  dimids[0]=lon_dim_id;
+  dimids[1]=bnds_dim_id;
+  rc=nc_def_var(cdf->ncid,LON_BNDS_NAME,NC_DOUBLE,2,dimids,&lon_bnds_var_id);
+  error(rc);
+  if(!notime)
+  {
+    switch(header.nstep)
+    {
+      case 1:
+        if(with_days)
+        {
+          len=snprintf(NULL,0,"days since %d-1-1 0:0:0",baseyear);
+          s=malloc(len+1);
+          sprintf(s,"days since %d-1-1 0:0:0",baseyear);
+        }
+        else
         {
           if(absyear)
             s=strdup(YEARS_NAME);
@@ -196,46 +181,84 @@ static Cdf *create_cdf(const char *filename,
             sprintf(s,"years since %d-1-1 0:0:0",baseyear);
           }
         }
-  else if(header.nstep==12)
-  {
+        break;
+      case NMONTH:
         len=snprintf(NULL,0,"%s since %d-1-1 0:0:0",(with_days) ? "days" : "months",baseyear);
         s=malloc(len+1);
         sprintf(s,"%s since %d-1-1 0:0:0",(with_days) ? "days" : "months",baseyear);
-  }
-  else if(header.nstep==1)
-  {
+        break;
+      case NDAYYEAR:
         len=snprintf(NULL,0,"days since %d-1-1 0:0:0",baseyear);
         s=malloc(len+1);
         sprintf(s,"days since %d-1-1 0:0:0",baseyear);
-  }
+        break;
+      default:
+        fprintf(stderr,"Invalid time step %d in '%s'.\n",header.nstep,filename);
+        free(year);
+        free(time_bnds);
+        free(lon);
+        free(lat);
+        free(lon_bnds);
+        free(lat_bnds);
+        nc_close(cdf->ncid);
+        free(cdf);
+        return NULL;
+    } /* of switch(header.step) */
     rc=nc_put_att_text(cdf->ncid,time_var_id,"units",strlen(s),s);
+    rc=nc_put_att_text(cdf->ncid,time_bnds_var_id,"units",strlen(s),s);
     free(s);
     error(rc);
     rc=nc_put_att_text(cdf->ncid,time_var_id,"calendar",strlen(CALENDAR),
                        CALENDAR);
+    rc=nc_put_att_text(cdf->ncid,time_bnds_var_id,"calendar",strlen(CALENDAR),
+                       CALENDAR);
     error(rc);
     rc=nc_put_att_text(cdf->ncid, time_var_id,"standard_name",strlen(TIME_STANDARD_NAME),TIME_STANDARD_NAME);
     error(rc);
     rc=nc_put_att_text(cdf->ncid, time_var_id,"long_name",strlen(TIME_LONG_NAME),TIME_LONG_NAME);
     error(rc);
+    rc=nc_put_att_text(cdf->ncid, time_var_id,"bounds",strlen(TIME_BNDS_NAME),TIME_BNDS_NAME);
+    error(rc);
+    rc=nc_put_att_text(cdf->ncid, time_bnds_var_id,"long_name",strlen(TIME_BNDS_LONG_NAME),TIME_BNDS_LONG_NAME);
+    error(rc);
     rc=nc_put_att_text(cdf->ncid, time_var_id,"axis",strlen("T"),"T");
     error(rc);
+  }
   rc=nc_put_att_text(cdf->ncid,lon_var_id,"units",strlen("degrees_east"),
                      "degrees_east");
   error(rc);
+  rc=nc_put_att_text(cdf->ncid,lon_bnds_var_id,"units",strlen("degrees_east"),
+                     "degrees_east");
+  error(rc);
   rc=nc_put_att_text(cdf->ncid, lon_var_id,"long_name",strlen(LON_LONG_NAME),LON_LONG_NAME);
   error(rc);
+  if(strlen(LON_BNDS_LONG_NAME))
+  {
+    rc=nc_put_att_text(cdf->ncid, lon_bnds_var_id,"long_name",strlen(LON_BNDS_LONG_NAME),LON_BNDS_LONG_NAME);
+    error(rc);
+  }
   rc=nc_put_att_text(cdf->ncid, lon_var_id,"standard_name",strlen(LON_STANDARD_NAME),LON_STANDARD_NAME);
   error(rc);
+  rc=nc_put_att_text(cdf->ncid, lon_var_id,"bounds",strlen(LON_BNDS_NAME),LON_BNDS_NAME);
+  error(rc);
   rc=nc_put_att_text(cdf->ncid, lon_var_id,"axis",strlen("X"),"X");
   error(rc);
   rc=nc_put_att_text(cdf->ncid,lat_var_id,"units",strlen("degrees_north"),
                      "degrees_north");
   error(rc);
+  rc=nc_put_att_text(cdf->ncid,lat_bnds_var_id,"units",strlen("degrees_north"),
+                     "degrees_north");
   rc=nc_put_att_text(cdf->ncid, lat_var_id,"long_name",strlen(LAT_LONG_NAME),LAT_LONG_NAME);
   error(rc);
+  if(strlen(LAT_BNDS_LONG_NAME))
+  {
+    rc=nc_put_att_text(cdf->ncid, lat_bnds_var_id,"long_name",strlen(LAT_BNDS_LONG_NAME),LAT_BNDS_LONG_NAME);
+    error(rc);
+  }
   rc=nc_put_att_text(cdf->ncid, lat_var_id,"standard_name",strlen(LAT_STANDARD_NAME),LAT_STANDARD_NAME);
   error(rc);
+  rc=nc_put_att_text(cdf->ncid, lat_var_id,"bounds",strlen(LAT_BNDS_NAME),LAT_BNDS_NAME);
+  error(rc);
   rc=nc_put_att_text(cdf->ncid, lat_var_id,"axis",strlen("Y"),"Y");
   error(rc);
   if(map!=NULL)
@@ -263,17 +286,15 @@ static Cdf *create_cdf(const char *filename,
       error(rc);
       rc=nc_put_att_text(cdf->ncid,varid,"long_name",strlen(DEPTH_LONG_NAME),DEPTH_LONG_NAME);
       error(rc);
-      rc=nc_put_att_text(cdf->ncid,varid,"bounds",strlen(BNDS_NAME),BNDS_NAME);
+      rc=nc_put_att_text(cdf->ncid,varid,"bounds",strlen(DEPTH_BNDS_NAME),DEPTH_BNDS_NAME);
       error(rc);
       rc=nc_put_att_text(cdf->ncid,varid,"positive",strlen("down"),"down");
       error(rc);
       rc=nc_put_att_text(cdf->ncid,varid,"axis",strlen("Z"),"Z");
       error(rc);
-      rc=nc_def_dim(cdf->ncid,BNDS_NAME,2,&bnds_dim_id);
-      error(rc);
       dimids[0]=dim2[0];
       dimids[1]=bnds_dim_id;
-      rc=nc_def_var(cdf->ncid,BNDS_NAME,NC_DOUBLE,2,dimids,&bnds_var_id);
+      rc=nc_def_var(cdf->ncid,DEPTH_BNDS_NAME,NC_DOUBLE,2,dimids,&bnds_var_id);
       error(rc);
       rc=nc_put_att_text(cdf->ncid,bnds_var_id,"units",strlen("m"),"m");
       error(rc);
@@ -304,35 +325,48 @@ static Cdf *create_cdf(const char *filename,
     rc=nc_def_dim(cdf->ncid,"npft",header.nbands,&pft_dim_id);
     error(rc);
   }
-  if(ispft)
+  if(!notime)
   {
     dim[0]=time_dim_id;
-    dim[1]=pft_dim_id;
-    dim[2]=lat_dim_id;
-    dim[3]=lon_dim_id;
-    chunk[0]=chunk[1]=1;
-    chunk[2]=array->nlat;
-    chunk[3]=array->nlon;
+    chunk[0]=1;
+    start=1;
   }
   else
+    start=0;
+  if(ispft)
   {
-    dim[0]=time_dim_id;
-    dim[1]=lat_dim_id;
-    dim[2]=lon_dim_id;
-    chunk[0]=1;
-    chunk[1]=array->nlat;
-    chunk[2]=array->nlon;
+    dim[start]=pft_dim_id;
+    dim[start+1]=lat_dim_id;
+    dim[start+2]=lon_dim_id;
+    chunk[start]=1;
+    chunk[start+1]=array->nlat;
+    chunk[start+2]=array->nlon;
+  }
+  else
+  {
+    dim[start]=lat_dim_id;
+    dim[start+1]=lon_dim_id;
+    chunk[start]=array->nlat;
+    chunk[start+1]=array->nlon;
   }
   switch(type)
   {
     case LPJ_FLOAT:
-      rc=nc_def_var(cdf->ncid,name,NC_FLOAT,(ispft) ? 4 : 3,dim,&cdf->varid);
+      rc=nc_def_var(cdf->ncid,name,NC_FLOAT,(ispft) ? 3+start : 2+start,dim,&cdf->varid);
       break;
     case LPJ_SHORT:
-      rc=nc_def_var(cdf->ncid,name,NC_SHORT,(ispft) ? 4 : 3,dim,&cdf->varid);
+      rc=nc_def_var(cdf->ncid,name,NC_SHORT,(ispft) ? 3+start : 2+start,dim,&cdf->varid);
       break;
     default:
       fprintf(stderr,"Invalid datatype %d.\n",type);
+      free(year);
+      free(time_bnds);
+      free(lon);
+      free(lat);
+      free(lon_bnds);
+      free(lat_bnds);
+      nc_close(cdf->ncid);
+      free(cdf);
       return NULL;
   }
   error(rc);
@@ -377,22 +411,31 @@ static Cdf *create_cdf(const char *filename,
   error(rc);
   rc=nc_enddef(cdf->ncid);
   error(rc);
+  if(!notime)
+  {
     rc=nc_put_var_double(cdf->ncid,time_var_id,year);
     error(rc);
+    rc=nc_put_var_double(cdf->ncid,time_bnds_var_id,time_bnds);
+    error(rc);
+  }
   rc=nc_put_var_double(cdf->ncid,lat_var_id,lat);
   error(rc);
+  rc=nc_put_var_double(cdf->ncid,lat_bnds_var_id,lat_bnds);
+  error(rc);
   rc=nc_put_var_double(cdf->ncid,lon_var_id,lon);
   error(rc);
+  rc=nc_put_var_double(cdf->ncid,lon_bnds_var_id,lon_bnds);
+  error(rc);
   if(map!=NULL)
   {
     if(map->isfloat)
     {
       layer=newvec(double,getmapsize(map));
-      check(layer);
+      checkptr(layer);
       midlayer=newvec(double,getmapsize(map));
-      check(midlayer);
+      checkptr(midlayer);
       bnds=newvec(double,2*getmapsize(map));
-      check(bnds);
+      checkptr(bnds);
       for(i=0;i<getmapsize(map);i++)
         layer[i]=*((double *)getmapitem(map,i))/1000;
       bnds[0]=0;
@@ -404,13 +447,13 @@ static Cdf *create_cdf(const char *filename,
         bnds[2*i+1]=layer[i];
         midlayer[i]=0.5*(layer[i-1]+layer[i]);
       }
+      free(layer);
       rc=nc_put_var_double(cdf->ncid,varid,midlayer);
+      free(midlayer);
       error(rc);
       rc=nc_put_var_double(cdf->ncid,bnds_var_id,bnds);
-      error(rc);
-      free(layer);
-      free(midlayer);
       free(bnds);
+      error(rc);
     }
     else
     {
@@ -450,15 +493,18 @@ static Cdf *create_cdf(const char *filename,
     }
   }
   free(lat);
+  free(lat_bnds);
+  free(lon_bnds);
   free(lon);
   free(year);
+  free(time_bnds);
   return cdf;
 } /* of 'create_cdf' */
 
 static Bool write_float_cdf(const Cdf *cdf,const float vec[],int year,
                             int size,Bool ispft,int nband,float miss)
 {
-  int i,rc;
+  int i,rc,start;
   size_t offsets[4],counts[4];
   float *grid;
   grid=newvec(float,cdf->index->nlon*cdf->index->nlat);
@@ -472,27 +518,28 @@ static Bool write_float_cdf(const Cdf *cdf,const float vec[],int year,
   for(i=0;i<size;i++)
     grid[cdf->index->index[i]]=vec[i];
   if(year==NO_TIME)
-    rc=nc_put_var_float(cdf->ncid,cdf->varid,grid);
+    start=0;
   else
   {
     offsets[0]=year;
     counts[0]=1;
+    start=1;
+  }
   if(ispft)
   {
-      counts[1]=1;
-      counts[2]=cdf->index->nlat;
-      counts[3]=cdf->index->nlon;
-      offsets[1]=nband;
-      offsets[2]=offsets[3]=0;
+    counts[start]=1;
+    counts[start+1]=cdf->index->nlat;
+    counts[start+2]=cdf->index->nlon;
+    offsets[start]=nband;
+    offsets[start+1]=offsets[start+2]=0;
   }
   else
   {
-      counts[1]=cdf->index->nlat;
-      counts[2]=cdf->index->nlon;
-      offsets[1]=offsets[2]=0;
+    counts[start]=cdf->index->nlat;
+    counts[start+1]=cdf->index->nlon;
+    offsets[start]=offsets[start+1]=0;
   }
   rc=nc_put_vara_float(cdf->ncid,cdf->varid,offsets,counts,grid);
-  }
   free(grid);
   if(rc!=NC_NOERR)
   {
@@ -506,7 +553,7 @@ static Bool write_float_cdf(const Cdf *cdf,const float vec[],int year,
 static Bool write_short_cdf(const Cdf *cdf,const short vec[],int year,
                             int size,Bool ispft,int nband,short miss)
 {
-  int i,rc;
+  int i,rc,start;
   size_t offsets[4],counts[4];
   short *grid;
   grid=newvec(short,cdf->index->nlon*cdf->index->nlat);
@@ -520,27 +567,28 @@ static Bool write_short_cdf(const Cdf *cdf,const short vec[],int year,
   for(i=0;i<size;i++)
     grid[cdf->index->index[i]]=vec[i];
   if(year==NO_TIME)
-    rc=nc_put_var_short(cdf->ncid,cdf->varid,grid);
+    start=0;
   else
   {
     offsets[0]=year;
     counts[0]=1;
+    start=1;
+  }
   if(ispft)
   {
-      counts[1]=1;
-      counts[2]=cdf->index->nlat;
-      counts[3]=cdf->index->nlon;
-      offsets[1]=nband;
-      offsets[2]=offsets[3]=0;
+    counts[start]=1;
+    counts[start+1]=cdf->index->nlat;
+    counts[start+2]=cdf->index->nlon;
+    offsets[start]=nband;
+    offsets[start+1]=offsets[start+2]=0;
   }
   else
   {
-      counts[1]=cdf->index->nlat;
-      counts[2]=cdf->index->nlon;
-      offsets[1]=offsets[2]=0;
+    counts[start]=cdf->index->nlat;
+    counts[start+1]=cdf->index->nlon;
+    offsets[start]=offsets[start+1]=0;
   }
   rc=nc_put_vara_short(cdf->ncid,cdf->varid,offsets,counts,grid);
-  }
   free(grid);
   if(rc!=NC_NOERR)
   {
@@ -571,8 +619,8 @@ int main(int argc,char **argv)
   Header header;
   float *data=NULL;
   short *data_short=NULL;
-  int i,j,k,ngrid,iarg,compress,version,n_global,n_global2,baseyear;
-  Bool swap,ispft,isshort,isglobal,isclm,ismeta,isbaseyear,revlat,withdays,absyear,isnetcdf4;
+  int i,j,k,ngrid,iarg,compress,version,n_global,n_global2,baseyear,cell;
+  Bool swap,ispft,isshort,isglobal,isclm,ismeta,isbaseyear,revlat,withdays,absyear,isnetcdf4,notime;
   Type gridtype;
   float cellsize,fcoord[2];
   double dcoord[2];
@@ -592,6 +640,7 @@ int main(int argc,char **argv)
   Filename grid_name;
   char *variable,*grid_filename,*path;
   grid_name.fmt=RAW;
+  grid_name.name=NULL;
   units=long_name=NULL;
   compress=0;
   swap=isglobal=absyear=isnetcdf4=FALSE;
@@ -600,6 +649,7 @@ int main(int argc,char **argv)
   header.nbands=1;
   header.nstep=1;
   header.timestep=1;
+  header.scalar=1;
   ispft=FALSE;
   isshort=FALSE;
   gridtype=LPJ_SHORT;
@@ -611,6 +661,7 @@ int main(int argc,char **argv)
   map_name=BAND_NAMES;
   n_global=0;
   missing_value=NULL;
+  notime=FALSE;
   for(iarg=1;iarg<argc;iarg++)
     if(argv[iarg][0]=='-')
     {
@@ -618,7 +669,7 @@ int main(int argc,char **argv)
       {
         printf("   bin2cdf (" __DATE__ ") Help\n"
                "   ==========================\n\n"
-               "Convert binary output into NetCDF files for LPJmL version " LPJ_VERSION "\n\n");
+               "Convert binary output into NetCDF files for LPJmL version %s\n\n",getversion());
         printf(USAGE
                "\nArguments:\n"
                "-h,--help        print this help text\n"
@@ -627,7 +678,7 @@ int main(int argc,char **argv)
                "-floatgrid       set data type of grid file to float, default is short\n"
                "-doublegrid      set data type of grid file to double, default is short\n"
                "-revlat          reverse order of latitudes in NetCDF file\n"
-               "-days            use days as units for monthly output\n"
+               "-days            use days as units for time axis in output\n"
                "-absyear         absolute year instead of relative to base year\n"
                "-netcdf4         file written is in NetCDF4 format\n"
                "-cellsize s      set cell size, default is %g\n"
@@ -644,6 +695,8 @@ int main(int argc,char **argv)
                "-ispft           output is PFT-specific\n"
                "-firstyear f     first year, default is %d\n"
                "-baseyear y      base year of annual time axis, default is firstyear\n"
+               "-scale s         scale output with factor s, default is 1\n"
+               "-notime          omit time axis\n"
                "-metafile        set the input format to JSON metafile instead of raw\n"
                "-map name        name of map in JSON metafile, default is \"band_names\"\n"
                "varname          variable name in NetCDF file\n"
@@ -656,7 +709,7 @@ int main(int argc,char **argv)
       }
       else if(!strcmp(argv[iarg],"-v") || !strcmp(argv[iarg],"--version"))
       {
-        puts(LPJ_VERSION);
+        puts(getversion());
         return EXIT_SUCCESS;
       }
       else if(!strcmp(argv[iarg],"-units"))
@@ -675,6 +728,8 @@ int main(int argc,char **argv)
         gridtype=LPJ_DOUBLE;
       else if(!strcmp(argv[iarg],"-ispft"))
         ispft=TRUE;
+      else if(!strcmp(argv[iarg],"-notime"))
+        notime=TRUE;
       else if(!strcmp(argv[iarg],"-clm"))
         isclm=TRUE;
       else if(!strcmp(argv[iarg],"-metafile"))
@@ -769,6 +824,26 @@ int main(int argc,char **argv)
           return EXIT_FAILURE;
         }
       }
+      else if(!strcmp(argv[iarg],"-scale"))
+      {
+        if(iarg==argc-1)
+        {
+          fprintf(stderr,"Error: Missing argument after option '-scale'.\n"
+                  USAGE,argv[0]);
+          return EXIT_FAILURE;
+        }
+        header.scalar=strtod(argv[++iarg],&endptr);
+        if(*endptr!='\0')
+        {
+          fprintf(stderr,"Error: Invalid number '%s' for option '-scale'.\n",argv[iarg]);
+          return EXIT_FAILURE;
+        }
+        if(header.scalar==0)
+        {
+          fputs("Error: Scaling factor must not be zero.\n",stderr);
+          return EXIT_FAILURE;
+        }
+      }
       else if(!strcmp(argv[iarg],"-nstep"))
       {
         if(iarg==argc-1)
@@ -1123,6 +1198,13 @@ int main(int argc,char **argv)
       }
     }
   }
+  if(isshort && header.scalar!=1)
+    fprintf(stderr,"Scaling factor %g not equal 1 set for short output datatype, set to 1.\n",header.scalar);
+  if(notime && (header.nstep>1 || header.nyear>1))
+  {
+    fprintf(stderr,"Setting not time axis option not allowed for more than one time step.\n");
+    return EXIT_FAILURE;
+  }
   if(!isbaseyear)
     baseyear=header.firstyear;
   index=createindex(grid,ngrid,res,isglobal,revlat);
@@ -1152,7 +1234,7 @@ int main(int argc,char **argv)
     }
   }
 
-  cdf=create_cdf(outname,map,map_name,cmdline,source,history,variable,units,var_standard_name,long_name,miss,miss_short,global_attrs,n_global,(isshort) ? LPJ_SHORT : LPJ_FLOAT,header,baseyear,ispft,compress,index,revlat,withdays,absyear,isnetcdf4);
+  cdf=create_cdf(outname,map,map_name,cmdline,source,history,variable,units,var_standard_name,long_name,miss,miss_short,global_attrs,n_global,(isshort) ? LPJ_SHORT : LPJ_FLOAT,header,baseyear,ispft,compress,index,withdays,absyear,notime,isnetcdf4);
   free(cmdline);
   if(cdf==NULL)
     return EXIT_FAILURE;
@@ -1162,6 +1244,8 @@ int main(int argc,char **argv)
     if(data_short==NULL)
     {
       printallocerr("data");
+      fclose(file);
+      close_cdf(cdf);
       return EXIT_FAILURE;
     }
   }
@@ -1171,6 +1255,8 @@ int main(int argc,char **argv)
     if(data==NULL)
     {
       printallocerr("data");
+      fclose(file);
+      close_cdf(cdf);
       return EXIT_FAILURE;
     }
   }
@@ -1183,24 +1269,40 @@ int main(int argc,char **argv)
           if(freadshort(data_short,ngrid,swap,file)!=ngrid)
           {
             fprintf(stderr,"Error reading data in year %d.\n",i+header.firstyear);
+            free(data_short);
+            fclose(file);
             close_cdf(cdf);
             return EXIT_FAILURE;
           }
-          if(write_short_cdf(cdf,data_short,i*header.nstep+j,ngrid,ispft,k,miss_short))
+          if(write_short_cdf(cdf,data_short,(notime) ? NO_TIME : i*header.nstep+j,ngrid,ispft,k,miss_short))
+          {
+            free(data_short);
+            fclose(file);
+            close_cdf(cdf);
             return EXIT_FAILURE;
           }
+        }
         else
         {
           if(freadfloat(data,ngrid,swap,file)!=ngrid)
           {
             fprintf(stderr,"Error reading data in year %d.\n",i+header.firstyear);
+            free(data);
+            fclose(file);
             close_cdf(cdf);
             return EXIT_FAILURE;
           }
-          if(write_float_cdf(cdf,data,i*header.nstep+j,ngrid,ispft,k,miss))
+          for(cell=0;cell<ngrid;cell++)
+            data[cell]*=header.scalar;
+          if(write_float_cdf(cdf,data,(notime) ? NO_TIME : i*header.nstep+j,ngrid,ispft,k,miss))
+          {
+            free(data);
+            fclose(file);
+            close_cdf(cdf);
             return EXIT_FAILURE;
           }
         }
+      }
   close_cdf(cdf);
   fclose(file);
   if(isshort)
diff --git a/src/utils/cdf2clm.c b/src/utils/cdf2clm.c
index b509ab199..f0a85c416 100644
--- a/src/utils/cdf2clm.c
+++ b/src/utils/cdf2clm.c
@@ -389,7 +389,7 @@ int main(int argc,char **argv)
       {
         printf("   cdf2clm (" __DATE__ ") Help\n"
                "   ==========================\n\n"
-               "Convert NetCDF data into CLM input data for LPJmL version " LPJ_VERSION "\n\n");
+               "Convert NetCDF data into CLM input data for LPJmL version %s\n\n",getversion());
         printf(USAGE
                "\nArguments:\n"
                "-h,--help     print this help text\n"
diff --git a/src/utils/cdf2soil.c b/src/utils/cdf2soil.c
index a1d06903d..e29bacd21 100644
--- a/src/utils/cdf2soil.c
+++ b/src/utils/cdf2soil.c
@@ -110,7 +110,7 @@ int main(int argc,char **argv)
   rc=nc_inq_varid(ncid,var,&var_id);
   if(rc)
   {
-    fprintf(stderr,"ERRO405: No variable '%s' found in '%s'.\n",var,argv[i]);
+    fprintf(stderr,"ERROR405: No variable '%s' found in '%s'.\n",var,argv[i]);
     nc_close(ncid);
     return EXIT_FAILURE;
   }
diff --git a/src/utils/cft2clm.c b/src/utils/cft2clm.c
index b1a85ddaf..7b7c20983 100644
--- a/src/utils/cft2clm.c
+++ b/src/utils/cft2clm.c
@@ -44,7 +44,7 @@ int main(int argc,char **argv)
     {
       if(!strcmp(argv[i],"-h"))
       {
-        printf("%s (" __DATE__ ") - adds header to cftfile for LPJmL version "LPJ_VERSION "\n\n",argv[0]);
+        printf("%s (" __DATE__ ") - adds header to cftfile for LPJmL version %s\n\n",argv[0],getversion());
         printf(USAGE
                "\nArguments:\n"
                "-h           print this help text\n" 
diff --git a/src/utils/cfts26_lu2clm.c b/src/utils/cfts26_lu2clm.c
index 310529a5c..0eaa5966e 100644
--- a/src/utils/cfts26_lu2clm.c
+++ b/src/utils/cfts26_lu2clm.c
@@ -57,7 +57,7 @@ int main(int argc,char **argv)
       if(!strcmp(argv[i],"-h"))
       {
         printf("cfts26_luc2clm (" __DATE__ ") - convert cfts26 and lu5 data files to\n"
-               "       clm data files for LPJmL version " LPJ_VERSION "\n\n");
+               "       clm data files for LPJmL version %s\n\n",getversion());
         printf(USAGE
                "\nArguments:\n"
                "-h               print this help text\n" 
diff --git a/src/utils/clm2cdf.c b/src/utils/clm2cdf.c
index 8b92b6fc7..a6ae62fc1 100644
--- a/src/utils/clm2cdf.c
+++ b/src/utils/clm2cdf.c
@@ -558,7 +558,7 @@ int main(int argc,char **argv)
       {
         printf("   clm2cdf (" __DATE__ ") Help\n"
                "   ==========================\n\n"
-               "Convert CLM input data into NetCDF input data for LPJmL version " LPJ_VERSION "\n\n");
+               "Convert CLM input data into NetCDF input data for LPJmL version %s\n\n",getversion());
         printf(USAGE
                "\nArguments:\n"
                "-h,--help        print this help text\n"
@@ -593,7 +593,7 @@ int main(int argc,char **argv)
       }
       else if(!strcmp(argv[iarg],"-v") || !strcmp(argv[iarg],"--version"))
       {
-        puts(LPJ_VERSION);
+        puts(getversion());
         return EXIT_SUCCESS;
       }
       else if(!strcmp(argv[iarg],"-units"))
@@ -614,7 +614,7 @@ int main(int argc,char **argv)
         israw=TRUE;
       else if(!strcmp(argv[iarg],"-metafile"))
         ismeta=TRUE;
-      else if(!strcmp(argv[iarg],"-netdcdf4"))
+      else if(!strcmp(argv[iarg],"-netcdf4"))
         isnetcdf4=TRUE;
       else if(!strcmp(argv[iarg],"-int"))
       {
diff --git a/src/utils/coupler_demo.c b/src/utils/coupler_demo.c
index a316876d3..66b7a6923 100644
--- a/src/utils/coupler_demo.c
+++ b/src/utils/coupler_demo.c
@@ -157,7 +157,7 @@ int main(int argc,char **argv)
   int nbands;
   int firstgrid;
   Bool swap;
-  String line;
+  String line,line2;
   const char *progname;
   const char *title[4];
   char *filename;
@@ -230,7 +230,8 @@ int main(int argc,char **argv)
   snprintf(line,STRING_LEN,
            "%s (" __DATE__ ")",progname);
   title[0]=line;
-  title[1]="Coupler demo for LPJmL version " LPJ_VERSION;
+  snprintf(line2,STRING_LEN,"Coupler demo for LPJmL version %s",getversion());
+  title[1]=line2;
   title[2]="(c) Potsdam Institute for Climate Impact Research (PIK),";
   title[3]="see COPYRIGHT file";
   banner(title,4,78);
diff --git a/src/utils/cru2clm.c b/src/utils/cru2clm.c
index aa6811781..9151cdfd2 100644
--- a/src/utils/cru2clm.c
+++ b/src/utils/cru2clm.c
@@ -51,7 +51,7 @@ int main(int argc,char **argv)
       if(!strcmp(argv[i],"-h"))
       {
         printf("cru2clm (" __DATE__ ") - convert cru data files to\n"
-               "       clm data files for LPJmL version " LPJ_VERSION "\n\n");
+               "       clm data files for LPJmL version %s\n\n",getversion());
         printf(USAGE
                "\nArguments:\n"
                "-h               print this help text\n" 
diff --git a/src/utils/grid2clm.c b/src/utils/grid2clm.c
index 657c28b6d..46ba5d7ab 100644
--- a/src/utils/grid2clm.c
+++ b/src/utils/grid2clm.c
@@ -43,7 +43,7 @@ int main(int argc,char **argv)
     {
       if(!strcmp(argv[i],"-h"))
       {
-        printf("%s (" __DATE__ ") - adds header to gridfile for LPJmL version " LPJ_VERSION "\n\n",argv[0]);
+        printf("%s (" __DATE__ ") - adds header to gridfile for LPJmL version %s\n\n",argv[0],getversion());
         printf(USAGE
                "\nArguments:\n"
                "-h             print this help text\n" 
diff --git a/src/utils/joingrid.c b/src/utils/joingrid.c
index 6701d0a9a..2905f1e6a 100644
--- a/src/utils/joingrid.c
+++ b/src/utils/joingrid.c
@@ -62,6 +62,11 @@ int main(int argc,char **argv)
     return EXIT_FAILURE;
   version=setversion;
   file=fopen(argv[1],"rb");
+  if(file==NULL)
+  {
+    printfopenerr(argv[1]);
+    return EXIT_FAILURE;
+  }
   if(freadheader(file,&header,&swap,LPJGRID_HEADER,&version,TRUE))
   {
     fprintf(stderr,"Error reading header in '%s'.\n",argv[1]);
diff --git a/src/utils/lpjcheck.c b/src/utils/lpjcheck.c
index eb6201abb..53c0edba6 100644
--- a/src/utils/lpjcheck.c
+++ b/src/utils/lpjcheck.c
@@ -38,7 +38,7 @@ int main(int argc,char **argv)
   Bool isout,check;
   const char *progname;
   const char *title[4];
-  String line;
+  String line,line2;
   FILE *file;
   initconfig(&config);
   isout=check=TRUE;
@@ -53,7 +53,7 @@ int main(int argc,char **argv)
     }
     else if(!strcmp(argv[1],"-v") || !strcmp(argv[1],"--version"))
     {
-      puts(LPJ_VERSION);
+      puts(getversion());
       return EXIT_SUCCESS;
     }
     else if(!strcmp(argv[1],"-h") || !strcmp(argv[1],"--help"))
@@ -66,7 +66,7 @@ int main(int argc,char **argv)
               progname);
       fprintf(file,"\n     ");
       frepeatch(file,'=',rc);
-      fprintf(file,"\n\nChecks syntax of LPJmL version " LPJ_VERSION " configuration (*.cjson) files\n\n");
+      fprintf(file,"\n\nChecks syntax of LPJmL version %s configuration (*.cjson) files\n\n",getversion());
       fprintf(file,USAGE,progname);
       fprintf(file,"\nArguments:\n"
              "-h,--help           print this help text\n"
@@ -102,8 +102,9 @@ int main(int argc,char **argv)
   {
     snprintf(line,78-10,
              "%s (" __DATE__ ")",progname);
+    snprintf(line2,78-10,"Checking configuration file for LPJmL version %s",getversion());
     title[0]=line;
-    title[1]="Checking configuration file for LPJmL version " LPJ_VERSION;
+    title[1]=line2;
     title[2]="(C) Potsdam Institute for Climate Impact Research (PIK),";
     title[3]="see COPYRIGHT file";
     banner(title,4,78);
diff --git a/src/utils/lpjfiles.c b/src/utils/lpjfiles.c
index 90ae07507..5735538e5 100644
--- a/src/utils/lpjfiles.c
+++ b/src/utils/lpjfiles.c
@@ -53,7 +53,7 @@ int main(int argc,char **argv)
               progname);
       fputs("\n     ",file);
       frepeatch(file,'=',rc);
-      fputs("\n\nPrint input/output files of LPJmL version " LPJ_VERSION "\n\n",file);
+      fprintf(file,"\n\nPrint input/output files of LPJmL version %s\n\n",getversion());
       fprintf(file,USAGE,progname);
       fprintf(file,"\nArguments:\n"
              "-h,--help        print this help text\n"
@@ -75,7 +75,7 @@ int main(int argc,char **argv)
     }
     else if(!strcmp(argv[1],"-v") || !strcmp(argv[1],"--version"))
     {
-      puts(LPJ_VERSION);
+      puts(getversion());
       return EXIT_SUCCESS;
     }
   }
diff --git a/src/utils/lpjprint.c b/src/utils/lpjprint.c
index 54f7da030..227fa5e4d 100644
--- a/src/utils/lpjprint.c
+++ b/src/utils/lpjprint.c
@@ -198,7 +198,7 @@ int main(int argc,char **argv)
   char *endptr;
   const char *progname;
   const char *title[4];
-  String line;
+  String line,line2;
   Pfttype scanfcn[NTYPES]=
   {
     {name_grass,fscanpft_grass},
@@ -217,7 +217,7 @@ int main(int argc,char **argv)
                 progname);
       fputs("\n     ",stdout);
       repeatch('=',rc);
-      fputs("\n\nPrint content of restart files for LPJmL " LPJ_VERSION "\n\n",stdout);
+      printf("\n\nPrint content of restart files for LPJmL %s\n\n",getversion());
       printf(USAGE,progname);
       printf("\nArguments:\n"
              "-h,--help        print this help text\n"
@@ -237,14 +237,15 @@ int main(int argc,char **argv)
     }
     else if(!strcmp(argv[1],"-v") || !strcmp(argv[1],"--version"))
     {
-      puts(LPJ_VERSION);
+      puts(getversion());
       return EXIT_SUCCESS;
     }
   }
   snprintf(line,78-10,
            "%s (" __DATE__ ")",progname);
+  snprintf(line2,78-10,"Printing restart file for LPJmL Version %s",getversion());
   title[0]=line;
-  title[1]="Printing restart file for LPJmL Version " LPJ_VERSION;
+  title[1]=line2;
   title[2]="(C) Potsdam Institute for Climate Impact Research (PIK),";
   title[3]="see COPYRIGHT file";
   banner(title,4,78);
diff --git a/src/utils/manage2js.c b/src/utils/manage2js.c
index 24a43e7ac..6ec5e48d1 100644
--- a/src/utils/manage2js.c
+++ b/src/utils/manage2js.c
@@ -2,7 +2,7 @@
 /**                                                                                \n**/
 /**                      m  a  n  a  g  e  2  j  s  .  c                           \n**/
 /**                                                                                \n**/
-/**     Converts management parameter files in *.conf format into JSON format.     \n**/
+/**     Converts management parameter files in *.par format into JSON format.      \n**/
 /**                                                                                \n**/
 /** (C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file    \n**/
 /** authors, and contributors see AUTHORS file                                     \n**/
@@ -162,14 +162,15 @@ static Bool fscanstr(FILE *file, /**< pointer to text file */
 
 int main(int argc,char **argv)
 {
-  int i,j,n,n2;
-  FILE *file,*file2;
+  const char *irrig[]={"no","surface","sprinkler","drip"};
+  int i,j,n,irrig_system;
+  FILE *file;
   char *ptr;
-  String s,s2;
-  if(argc<3)
+  String s;
+  if(argc<2)
   {
     fprintf(stderr,"Error: Missing arguments.\n"
-           "Usage: %s laimax.par manage.par\n",argv[0]);
+           "Usage: %s laimax.par\n",argv[0]);
     return EXIT_FAILURE;
   }
   file=fopen(argv[1],"r");
@@ -185,36 +186,10 @@ int main(int argc,char **argv)
     fprintf(stderr,"Cannot read int in '%s', found '%s'.\n", argv[1],s);
     return EXIT_FAILURE;
   }
-  file2=fopen(argv[2],"r");
-  if(file2==NULL)
-  {
-    fprintf(stderr,"Error opening '%s': %s.\n",argv[2],strerror(errno));
-    return EXIT_FAILURE;
-  }
-  fscanstr2(file2,s);
-  n2=strtol(s,&ptr,10);
-  if(*ptr!='\0')
-  {
-    fprintf(stderr,"Cannot read int in '%s', found '%s'.\n", argv[2],s);
-    return EXIT_FAILURE;
-  }
-  if(n2!=n)
-  {
-    fprintf(stderr,"Number of countries=%d in '%s' not equal number of countries=%d in '%s'.\n",n,argv[1],n2,argv[2]);
-    return EXIT_FAILURE;
-  }
-  printf("\"countrypar\" :\n"
-         "[\n");
+  printf("[\n");
   for(i=0;i<n;i++)
   {
-    fscanstr2(file2,s2);
-    fscanstr2(file2,s);
     fscanstr2(file,s);
-    if(strcmp(s,s2))
-    {
-      fprintf(stderr,"Country '%s' in '%s' not equal country '%s' in '%s'.\n",s,argv[1],s2,argv[2]);
-      return EXIT_FAILURE;
-    }
     printf("  { \"id\" : %s,",s);
     fscanstr2(file,s);
     printf(" \"name\" : \"%s\",",s);
@@ -226,18 +201,25 @@ int main(int argc,char **argv)
       if(j<11)
         printf(",");
     }
-    fscanstr2(file2,s);
-    printf("], \"laimax_tempcer\" : %s,",s);
-    fscanstr2(file2,s);
-    printf(" \"laimax_maize\" : %s,",s);
-    fscanstr2(file2,s);
     fscanstr2(file,s);
-    printf(" \"default_irrig_system\" : %s}",s);
+    irrig_system=strtol(s,&ptr,10);
+    if(*ptr!='\0')
+      printf("] \"default_irrig_system\" : %s}",s);
+    else
+    {
+      if(irrig_system<0 || irrig_system>3)
+      {
+        fprintf(stderr,"Invalid number %d for irrigation system in '%s', must be in [0,3].\n",
+                irrig_system,argv[1]);
+        return EXIT_FAILURE;
+      }
+      printf("] \"default_irrig_system\" : \"%s\"}",irrig[irrig_system]);
+    }
     if(i<n-1)
       printf(",\n");
     else 
       printf("\n");
   }
-  printf("],\n");
+  printf("]\n");
   return EXIT_SUCCESS;
 } /* of 'main' */
diff --git a/src/utils/mathclm.c b/src/utils/mathclm.c
index b6ee9d531..e981efa52 100644
--- a/src/utils/mathclm.c
+++ b/src/utils/mathclm.c
@@ -58,7 +58,7 @@ int main(int argc,char **argv)
     {
       if(!strcmp(argv[1],"-v") || !strcmp(argv[1],"--version"))
       {
-        puts(LPJ_VERSION);
+        puts(getversion());
         return EXIT_SUCCESS;
       }
       else if(!strcmp(argv[iarg],"-longheader"))
diff --git a/src/utils/regridclm.c b/src/utils/regridclm.c
index 88eb28cff..2b7c4fafa 100644
--- a/src/utils/regridclm.c
+++ b/src/utils/regridclm.c
@@ -53,7 +53,7 @@ int main(int argc,char **argv)
     {
       if(!strcmp(argv[1],"-v") || !strcmp(argv[1],"--version"))
       {
-        puts(LPJ_VERSION);
+        puts(getversion());
         return EXIT_SUCCESS;
       }
       if(!strcmp(argv[iarg],"-size4"))
diff --git a/src/utils/txt2clm.c b/src/utils/txt2clm.c
index 526b14305..009ba6d1e 100644
--- a/src/utils/txt2clm.c
+++ b/src/utils/txt2clm.c
@@ -101,7 +101,7 @@ int main(int argc,char **argv)
       {
         printf("   txt2clm (" __DATE__ ") Help\n"
                "   ==========================\n\n"
-               "Convert text files to clm data files for LPJmL version " LPJ_VERSION "\n\n");
+               "Convert text files to clm data files for LPJmL version %s\n\n",getversion());
         printf(USAGE
                "Arguments:\n"
                "-h,--help    print this help text\n"
diff --git a/src/utils/txt2grid.c b/src/utils/txt2grid.c
index 66d472dde..c5632bbab 100644
--- a/src/utils/txt2grid.c
+++ b/src/utils/txt2grid.c
@@ -88,7 +88,7 @@ int main(int argc,char **argv)
       {
         printf("   txt2grid (" __DATE__ ") Help\n"
                "   ===========================\n\n"
-               "Convert text file to clm grid file for LPJmL version " LPJ_VERSION "\n\n"
+               "Convert text file to clm grid file for LPJmL version %s\n\n"
                USAGE
                "\nArguments:\n"
                "-h,--help          print this help text\n"
@@ -104,7 +104,7 @@ int main(int argc,char **argv)
                "gridfile           filename of grid text file\n"
                "clmfile            filename of clm data file\n\n"
                "(C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file\n",
-               fmt,header.cellsize_lon,header.cellsize_lat,header.cellsize_lon);
+               getversion(),fmt,header.cellsize_lon,header.cellsize_lat,header.cellsize_lon);
         return EXIT_SUCCESS;
       }
       if(!strcmp(argv[iarg],"-fmt"))
