#!/bin/bash
#################################################################################
##                                                                             ##
##                  a  l  l  b  i  n  2  c  d  f                               ##
##                                                                             ##
##    bash script to convert all binary raw files to NetCDF files using th     ##
##    JSON metafiles in current directory                                      ##
##                                                                             ##
##    Usage: allbin2cdf [[binpath] [netcdfpath]]                               ##
##                                                                             ##
## (C) Potsdam Institute for Climate Impact Research (PIK), see COPYRIGHT file ##
## authors, and contributors see AUTHORS file                                  ##
## This file is part of LPJmL and licensed under GNU AGPL Version 3            ##
## or later. See LICENSE file or go to http://www.gnu.org/licenses/            ##
## Contact: https://github.com/PIK-LPJmL/LPJmL                                 ##
##                                                                             ##
#################################################################################

binpath="."
count=0
if [ $# -gt 0 ]
then
  binpath=$1
fi
if [ $# -gt 1 ]
then
  netcdfpath=$2
else
  netcdfpath=$binpath
fi
for file in $binpath/*.bin.json
do
  if [ "$file" != "$binpath/grid.bin.json" ]
  then
    echo $file "-->" $netcdfpath/$(basename ${file%.bin.json}).nc
    if bin2cdf -metafile $file $netcdfpath/$(basename ${file%.bin.json}).nc ;
    then
      ((count++))
    fi
  fi
done
exit $count
